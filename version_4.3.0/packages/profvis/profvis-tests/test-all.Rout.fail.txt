
R version 4.3.0 (2023-04-21) -- "Already Tomorrow"
Copyright (C) 2023 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(testthat)
> library(profvis)
> 
> test_check("profvis")
[ FAIL 2 | WARN 1 | SKIP 2 | PASS 16 ]

══ Skipped tests ═══════════════════════════════════════════════════════════════
• On CRAN (2)

══ Failed tests ════════════════════════════════════════════════════════════════
── Error ('test-rprof.R:20:3'): `filter.callframes` filters out intervening frames ──
`!!quo` threw an unexpected error.
Message: Quosures can only be unquoted within a quasiquotation context.

# Bad: list(!!myquosure)

# Good: dplyr::mutate(data, !!myquosure)
Class:   rlang_error/error/condition
Backtrace:
     ▆
  1. └─profvis:::expect_snapshot0(cat_rprof(f(), filter.callframes = TRUE)) at test-rprof.R:20:2
  2.   ├─testthat::expect_snapshot(!!quo, cran = cran) at profvis-tests/testthat/helper-profvis.R:18:2
  3.   │ └─testthat:::verify_exec(quo_get_expr(x), quo_get_env(x), replay)
  4.   │   └─evaluate::evaluate(source, envir = env, new_device = FALSE, output_handler = handler)
  5.   │     └─evaluate:::evaluate_call(...)
  6.   │       ├─evaluate (local) timing_fn(...)
  7.   │       ├─evaluate (local) handle(...)
  8.   │       │ └─base::try(f, silent = TRUE)
  9.   │       │   └─base::tryCatch(...)
 10.   │       │     └─base (local) tryCatchList(expr, classes, parentenv, handlers)
 11.   │       │       └─base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])
 12.   │       │         └─base (local) doTryCatch(return(expr), name, parentenv, handler)
 13.   │       ├─base::withCallingHandlers(...)
 14.   │       ├─base::withVisible(...)
 15.   │       └─evaluate:::eval_with_user_handlers(expr, envir, enclos, user_handlers)
 16.   │         └─base::eval(expr, envir, enclos)
 17.   │           └─base::eval(expr, envir, enclos)
 18.   └─rlang:::Ops.quosure(quo)
 19.     └─rlang::abort(...)
── Error ('test-rprof.R:24:3'): `filter.callframes` filters out intervening frames ──
`!!quo` threw an unexpected error.
Message: Quosures can only be unquoted within a quasiquotation context.

# Bad: list(!!myquosure)

# Good: dplyr::mutate(data, !!myquosure)
Class:   rlang_error/error/condition
Backtrace:
     ▆
  1. └─profvis:::expect_snapshot0(cat_rprof(f(), filter.callframes = TRUE)) at test-rprof.R:24:2
  2.   ├─testthat::expect_snapshot(!!quo, cran = cran) at profvis-tests/testthat/helper-profvis.R:18:2
  3.   │ └─testthat:::verify_exec(quo_get_expr(x), quo_get_env(x), replay)
  4.   │   └─evaluate::evaluate(source, envir = env, new_device = FALSE, output_handler = handler)
  5.   │     └─evaluate:::evaluate_call(...)
  6.   │       ├─evaluate (local) timing_fn(...)
  7.   │       ├─evaluate (local) handle(...)
  8.   │       │ └─base::try(f, silent = TRUE)
  9.   │       │   └─base::tryCatch(...)
 10.   │       │     └─base (local) tryCatchList(expr, classes, parentenv, handlers)
 11.   │       │       └─base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])
 12.   │       │         └─base (local) doTryCatch(return(expr), name, parentenv, handler)
 13.   │       ├─base::withCallingHandlers(...)
 14.   │       ├─base::withVisible(...)
 15.   │       └─evaluate:::eval_with_user_handlers(expr, envir, enclos, user_handlers)
 16.   │         └─base::eval(expr, envir, enclos)
 17.   │           └─base::eval(expr, envir, enclos)
 18.   └─rlang:::Ops.quosure(quo)
 19.     └─rlang::abort(...)

[ FAIL 2 | WARN 1 | SKIP 2 | PASS 16 ]
Error: Test failures
Execution halted
