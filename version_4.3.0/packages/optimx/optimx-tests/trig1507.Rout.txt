
R version 4.3.0 (2023-04-21) -- "Already Tomorrow"
Copyright (C) 2023 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> require(optimx)
Loading required package: optimx
> ## Trig function
> # ref??
> 
> trig.f <- function(x){
+   res <- trig.res(x)
+   f <- sum(res*res)
+ #  cat("FV=",f," at ")
+ #  print(x)
+   f
+ }
> 
> trig.res <- function(x){
+    n <- length(x)
+    i <- 1:n
+    res <- n - sum(cos(x)) + i*(1 - cos(x)) - sin(x) 
+    return(res)
+ }
> 
> trig.jac <- function(x) { # not vectorized. Can it be?
+ ## stop("Not defined")
+    n <- length(x)
+    J<-matrix(0,n,n)
+    for (i in 1:n) {
+       for (j in 1:n) {
+          J[i,j]<-sin(x[j]) # we overwrite J[i,i]
+       }
+       J[i,i] <- (1+i) * sin(x[i])  - cos(x[i])
+    }
+    return(J)
+ }
> 
> 
> trig.g <- function(x) { # unvectorized
+   n<-length(x)
+   res<-trig.res(x)
+   J<-trig.jac(x)
+   g<- as.vector(2.0 * ( t(J) %*% res ))
+   return(g)
+ }
> 
> 
> x<-rep(2,2)
> cat("opm\n")
opm
> opt2<-optimr(x, trig.f, trig.g, method="BFGS")
> opt2
$par
[1]  0.2430642 -5.6705092

$value
[1] 2.380239e-19

$counts
function gradient 
      21       16 

$convergence
[1] 0

$message
NULL

> opt2r<-optimr(x, trig.f, trig.g, method="Rvmmin")
> opt2r
$par
[1]  5.720345e-17 -6.283185e+00

$value
[1] 6.326263e-32

$counts
function gradient 
      24       21 

$convergence
[1] 2

$message
[1] "Rvmminu appears to have converged"

> cat("====================")
====================> x<-rep(2,4)
> cat("optim(BFGS) vs optimr(BFGS)\n")
optim(BFGS) vs optimr(BFGS)
> opt4<-optim(x, trig.f, trig.g, method="BFGS")
> opt4
$par
[1] -113.09734 -100.53096  -94.24778 -219.91149

$value
[1] 1.357941e-27

$counts
function gradient 
      29       21 

$convergence
[1] 0

$message
NULL

> opt4r<-optimr(x, trig.f, trig.g, method="Rvmmin")
> opt4r
$par
[1] -113.09734 -100.53096  -94.24778 -219.91149

$value
[1] 2.089728e-28

$counts
function gradient 
      28       23 

$convergence
[1] 0

$message
[1] "Rvmminu appears to have converged"

> cat("====================")
====================> x<-rep(2,8)
> cat("optim(BFGS) vs Rvmmin\n")
optim(BFGS) vs Rvmmin
> opt8<-optim(x, trig.f, trig.g, method="BFGS")
> opt8
$par
[1] -301.5441 -314.1092 -301.5413 -339.2388 -376.9359 -508.6652 -527.7272
[8] -672.2369

$value
[1] 5.506742e-19

$counts
function gradient 
      81       45 

$convergence
[1] 0

$message
NULL

> opt8r<-optimr(x, trig.f, trig.g, method="Rvmmin")
> opt8r
$par
[1] -301.5420 -314.1070 -301.5390 -339.2362 -376.9332 -508.8774 -527.5676
[8] -672.1203

$value
[1] 2.036768e-27

$counts
function gradient 
     107       84 

$convergence
[1] 0

$message
[1] "Rvmminu appears to have converged"

> 
> 
> 
> 
> 
> ttrig2<-opm(rep(2,2), trig.f, trig.g, method="ALL")
Warning messages:
1: In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Note: snewton needs Hessian function (hess) specified
2: In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Note: snewtonm needs Hessian function specified
3: In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Successful convergence  Restarts for stagnation =0
> summary(ttrig2, order=value)
                       p1            p2         value fevals gevals convergence
hjkb         0.000000e+00  0.000000e+00  0.000000e+00    116     NA           0
hjn          0.000000e+00  0.000000e+00  0.000000e+00     64     NA           0
subplex      2.430642e-01  6.126761e-01  1.232595e-32    352     NA           0
Rvmmin       5.720345e-17 -6.283185e+00  6.326263e-32     24     21           2
nlminb       2.430642e-01  6.126761e-01  9.321994e-28     17     15           0
BFGS         2.430642e-01 -5.670509e+00  2.380239e-19     21     16           0
ucminf       2.430642e-01  6.126761e-01  1.882193e-18     19     19           0
newuoa      -4.920454e-09 -3.687981e-08  1.384332e-15     46     NA           0
bobyqa       2.430643e-01  6.126761e-01  1.728630e-15    105     NA           0
Rcgmin       2.430641e-01  6.126761e-01  2.256817e-15     31     21           0
Rtnmin       2.430643e-01  6.126762e-01  7.122213e-15     31     31           0
nlm          2.179836e-08 -9.125140e-08  8.801988e-15     NA     13           0
L-BFGS-B     2.430644e-01  6.126764e-01  6.766484e-14     21     21           0
CG           8.533533e-08  5.164087e-07  2.739597e-13     29     13           0
spg          2.430642e-01  6.126750e-01  1.553083e-12     25     24           0
lbfgs        2.430658e-01  6.126773e-01  2.178256e-12     NA     NA           0
lbfgsb3c     2.430671e-01  6.126762e-01  2.437421e-12     23     23           0
nmkb         2.418316e-01  6.123581e-01  5.192770e-07     62     NA           0
Nelder-Mead  2.450067e-01  6.125850e-01  1.146791e-06     83     NA           0
snewton                NA            NA 8.988466e+307     NA     NA        9997
snewtonm               NA            NA 8.988466e+307     NA     NA        9997
             kkt1 kkt2 xtime
hjkb         TRUE TRUE 0.001
hjn          TRUE TRUE 0.001
subplex      TRUE TRUE 0.004
Rvmmin       TRUE TRUE 0.002
nlminb       TRUE TRUE 0.001
BFGS         TRUE TRUE 0.000
ucminf       TRUE TRUE 0.000
newuoa       TRUE TRUE 0.004
bobyqa       TRUE TRUE 0.002
Rcgmin       TRUE TRUE 0.001
Rtnmin       TRUE TRUE 0.004
nlm          TRUE TRUE 0.000
L-BFGS-B     TRUE TRUE 0.001
CG           TRUE TRUE 0.001
spg          TRUE TRUE 0.006
lbfgs        TRUE TRUE 0.004
lbfgsb3c     TRUE TRUE 0.065
nmkb         TRUE TRUE 0.005
Nelder-Mead FALSE TRUE 0.001
snewton        NA   NA 0.001
snewtonm       NA   NA 0.000
> 
> ttrig4<-opm(rep(2,4), trig.f, trig.g, method="ALL")
Warning messages:
1: In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Note: snewton needs Hessian function (hess) specified
2: In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Note: snewtonm needs Hessian function specified
3: In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Successful convergence  Restarts for stagnation =0
> summary(ttrig2, order=value)
                       p1            p2         value fevals gevals convergence
hjkb         0.000000e+00  0.000000e+00  0.000000e+00    116     NA           0
hjn          0.000000e+00  0.000000e+00  0.000000e+00     64     NA           0
subplex      2.430642e-01  6.126761e-01  1.232595e-32    352     NA           0
Rvmmin       5.720345e-17 -6.283185e+00  6.326263e-32     24     21           2
nlminb       2.430642e-01  6.126761e-01  9.321994e-28     17     15           0
BFGS         2.430642e-01 -5.670509e+00  2.380239e-19     21     16           0
ucminf       2.430642e-01  6.126761e-01  1.882193e-18     19     19           0
newuoa      -4.920454e-09 -3.687981e-08  1.384332e-15     46     NA           0
bobyqa       2.430643e-01  6.126761e-01  1.728630e-15    105     NA           0
Rcgmin       2.430641e-01  6.126761e-01  2.256817e-15     31     21           0
Rtnmin       2.430643e-01  6.126762e-01  7.122213e-15     31     31           0
nlm          2.179836e-08 -9.125140e-08  8.801988e-15     NA     13           0
L-BFGS-B     2.430644e-01  6.126764e-01  6.766484e-14     21     21           0
CG           8.533533e-08  5.164087e-07  2.739597e-13     29     13           0
spg          2.430642e-01  6.126750e-01  1.553083e-12     25     24           0
lbfgs        2.430658e-01  6.126773e-01  2.178256e-12     NA     NA           0
lbfgsb3c     2.430671e-01  6.126762e-01  2.437421e-12     23     23           0
nmkb         2.418316e-01  6.123581e-01  5.192770e-07     62     NA           0
Nelder-Mead  2.450067e-01  6.125850e-01  1.146791e-06     83     NA           0
snewton                NA            NA 8.988466e+307     NA     NA        9997
snewtonm               NA            NA 8.988466e+307     NA     NA        9997
             kkt1 kkt2 xtime
hjkb         TRUE TRUE 0.001
hjn          TRUE TRUE 0.001
subplex      TRUE TRUE 0.004
Rvmmin       TRUE TRUE 0.002
nlminb       TRUE TRUE 0.001
BFGS         TRUE TRUE 0.000
ucminf       TRUE TRUE 0.000
newuoa       TRUE TRUE 0.004
bobyqa       TRUE TRUE 0.002
Rcgmin       TRUE TRUE 0.001
Rtnmin       TRUE TRUE 0.004
nlm          TRUE TRUE 0.000
L-BFGS-B     TRUE TRUE 0.001
CG           TRUE TRUE 0.001
spg          TRUE TRUE 0.006
lbfgs        TRUE TRUE 0.004
lbfgsb3c     TRUE TRUE 0.065
nmkb         TRUE TRUE 0.005
Nelder-Mead FALSE TRUE 0.001
snewton        NA   NA 0.001
snewtonm       NA   NA 0.000
> 
> ttrig8<-opm(rep(2,8), trig.f, trig.g, method="ALL")
Warning messages:
1: In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Note: snewton needs Hessian function (hess) specified
2: In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Note: snewtonm needs Hessian function specified
3: In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Successful convergence  Restarts for stagnation =0
> summary(ttrig2, order=value)
                       p1            p2         value fevals gevals convergence
hjkb         0.000000e+00  0.000000e+00  0.000000e+00    116     NA           0
hjn          0.000000e+00  0.000000e+00  0.000000e+00     64     NA           0
subplex      2.430642e-01  6.126761e-01  1.232595e-32    352     NA           0
Rvmmin       5.720345e-17 -6.283185e+00  6.326263e-32     24     21           2
nlminb       2.430642e-01  6.126761e-01  9.321994e-28     17     15           0
BFGS         2.430642e-01 -5.670509e+00  2.380239e-19     21     16           0
ucminf       2.430642e-01  6.126761e-01  1.882193e-18     19     19           0
newuoa      -4.920454e-09 -3.687981e-08  1.384332e-15     46     NA           0
bobyqa       2.430643e-01  6.126761e-01  1.728630e-15    105     NA           0
Rcgmin       2.430641e-01  6.126761e-01  2.256817e-15     31     21           0
Rtnmin       2.430643e-01  6.126762e-01  7.122213e-15     31     31           0
nlm          2.179836e-08 -9.125140e-08  8.801988e-15     NA     13           0
L-BFGS-B     2.430644e-01  6.126764e-01  6.766484e-14     21     21           0
CG           8.533533e-08  5.164087e-07  2.739597e-13     29     13           0
spg          2.430642e-01  6.126750e-01  1.553083e-12     25     24           0
lbfgs        2.430658e-01  6.126773e-01  2.178256e-12     NA     NA           0
lbfgsb3c     2.430671e-01  6.126762e-01  2.437421e-12     23     23           0
nmkb         2.418316e-01  6.123581e-01  5.192770e-07     62     NA           0
Nelder-Mead  2.450067e-01  6.125850e-01  1.146791e-06     83     NA           0
snewton                NA            NA 8.988466e+307     NA     NA        9997
snewtonm               NA            NA 8.988466e+307     NA     NA        9997
             kkt1 kkt2 xtime
hjkb         TRUE TRUE 0.001
hjn          TRUE TRUE 0.001
subplex      TRUE TRUE 0.004
Rvmmin       TRUE TRUE 0.002
nlminb       TRUE TRUE 0.001
BFGS         TRUE TRUE 0.000
ucminf       TRUE TRUE 0.000
newuoa       TRUE TRUE 0.004
bobyqa       TRUE TRUE 0.002
Rcgmin       TRUE TRUE 0.001
Rtnmin       TRUE TRUE 0.004
nlm          TRUE TRUE 0.000
L-BFGS-B     TRUE TRUE 0.001
CG           TRUE TRUE 0.001
spg          TRUE TRUE 0.006
lbfgs        TRUE TRUE 0.004
lbfgsb3c     TRUE TRUE 0.065
nmkb         TRUE TRUE 0.005
Nelder-Mead FALSE TRUE 0.001
snewton        NA   NA 0.001
snewtonm       NA   NA 0.000
> 
> 
> ttrig2b <- opm(rep(2,2), trig.f, trig.g, lower=rep(.1,2), upper=rep(pi,2), method="ALL")
trace= 0 
Warning message:
In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Successful convergence  Restarts for stagnation =0
> summary(ttrig2b, order=value)
              p1      p2      value fevals gevals convergence  kkt1 kkt2 xtime
Rvmmin   0.24306 0.61268 4.0059e-32     25     23           2  TRUE TRUE 0.003
nlminb   0.24306 0.61268 1.8533e-19     16     16           0  TRUE TRUE 0.000
Rcgmin   0.24306 0.61268 7.0978e-17     40     23           0  TRUE TRUE 0.002
Rtnmin   0.24306 0.61268 7.1222e-15     31     31           0  TRUE TRUE 0.004
bobyqa   0.24306 0.61268 2.4351e-14     88     NA           0  TRUE TRUE 0.001
hjkb     0.24307 0.61268 4.1181e-12    237     NA           0  TRUE TRUE 0.002
L-BFGS-B 0.10000 0.10000 1.3575e-02      2      2           0 FALSE TRUE 0.000
lbfgsb3c 0.10000 0.10000 1.3575e-02      3      3           0 FALSE TRUE 0.000
nmkb     0.10000 0.10000 1.3575e-02     18     NA           0 FALSE TRUE 0.002
hjn      0.10000 0.10000 1.3575e-02     37     NA           0 FALSE TRUE 0.001
> 
> ttrig4b <- opm(rep(2,4), trig.f, trig.g, lower=rep(.1,4), upper=rep(pi,4), method="ALL")
trace= 0 
Warning message:
In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Successful convergence  Restarts for stagnation =0
> summary(ttrig4b, order=value)
              p1      p2      p3      p4      value fevals gevals convergence
nmkb     0.10010 0.10007 0.10634 0.38292 6.8556e-05    144     NA           0
Rvmmin   0.14549 0.16018 0.42496 0.21685 3.0282e-04     44     33           0
nlminb   0.14549 0.16018 0.42496 0.21685 3.0282e-04     35     28           0
hjn      0.14549 0.16018 0.42496 0.21685 3.0282e-04    438     NA           0
Rtnmin   0.14549 0.16018 0.42495 0.21685 3.0282e-04     35     35           0
Rcgmin   0.14549 0.16018 0.42496 0.21684 3.0282e-04     50     29           0
hjkb     0.14549 0.16018 0.42496 0.21684 3.0282e-04    527     NA           0
bobyqa   0.14548 0.16018 0.42496 0.21683 3.0282e-04    364     NA           0
L-BFGS-B 0.10000 0.10000 0.10000 0.10000 1.8275e-02      2      2           0
lbfgsb3c 0.10000 0.10000 0.10000 0.10000 1.8275e-02      3      3           0
          kkt1  kkt2 xtime
nmkb     FALSE  TRUE 0.007
Rvmmin    TRUE  TRUE 0.004
nlminb    TRUE  TRUE 0.001
hjn       TRUE  TRUE 0.003
Rtnmin    TRUE  TRUE 0.004
Rcgmin    TRUE  TRUE 0.001
hjkb      TRUE  TRUE 0.004
bobyqa    TRUE  TRUE 0.003
L-BFGS-B FALSE FALSE 0.001
lbfgsb3c FALSE FALSE 0.001
> 
> ttrig8b <- opm(rep(2,8), trig.f, trig.g, lower=rep(.1,8), upper=rep(pi,8), method="ALL")
trace= 0 
Warning message:
In optimr(par, fn, gr, hess = hess, method = meth, lower = lower,  :
  Successful convergence  Restarts for stagnation =0
> summary(ttrig8b, order=value)
              p1  p2      p3      p4      p5      p6      p7      p8      value
hjn      0.10000 0.1 0.10000 0.10127 0.27234 0.12861 0.13356 0.12071 0.00076300
Rcgmin   0.10000 0.1 0.10000 0.10127 0.27234 0.12861 0.13356 0.12071 0.00076300
Rtnmin   0.10000 0.1 0.10000 0.10000 0.27722 0.12879 0.13554 0.10000 0.00083848
Rvmmin   0.10000 0.1 0.10000 0.10000 0.11132 0.23010 0.17349 0.13785 0.00094088
nlminb   0.10000 0.1 0.10000 0.10000 0.11132 0.23010 0.17349 0.13785 0.00094088
hjkb     0.10000 0.1 0.10000 0.10000 0.11132 0.23010 0.17349 0.13785 0.00094088
bobyqa   0.10000 0.1 0.10000 0.10000 0.11132 0.23010 0.17349 0.13786 0.00094088
L-BFGS-B 0.10000 0.1 0.10000 0.10000 0.11134 0.23010 0.17350 0.13785 0.00094088
lbfgsb3c 0.10000 0.1 0.10000 0.10000 0.11137 0.22959 0.17416 0.13832 0.00094104
nmkb     0.10003 0.1 0.10051 0.10740 0.10000 0.23461 0.18597 0.10016 0.00117764
         fevals gevals convergence  kkt1 kkt2 xtime
hjn         855     NA           0 FALSE TRUE 0.005
Rcgmin       86     57           0 FALSE TRUE 0.003
Rtnmin       53     53           0 FALSE TRUE 0.007
Rvmmin       59     44           0 FALSE TRUE 0.005
nlminb       33     30           0 FALSE TRUE 0.001
hjkb        727     NA           0 FALSE TRUE 0.006
bobyqa      690     NA           0 FALSE TRUE 0.005
L-BFGS-B     21     21           0 FALSE TRUE 0.001
lbfgsb3c     39     39           0 FALSE TRUE 0.002
nmkb        286     NA           0 FALSE TRUE 0.016
> 
> 
