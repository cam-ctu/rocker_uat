
R version 4.4.2 (2024-10-31) -- "Pile of Leaves"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(testthat)
> library(cctu)

Attaching package: ‘cctu’

The following object is masked from ‘package:base’:

    source

> library(readxl)
> library(magrittr)

Attaching package: ‘magrittr’

The following objects are masked from ‘package:testthat’:

    equals, is_less_than, not

> library(xml2)
> library(dplyr)

Attaching package: ‘dplyr’

The following object is masked from ‘package:testthat’:

    matches

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> test_check("cctu")
'envir' chosen:<environment: 0x55903c76d080>
encoding = "native.enc" chosen
 --> from_file='TRUE'
 lines:function (x, ...)  
--> parsed 1 expressions; now eval(.)ing them:

>>>> eval(expression_nr. 1 )
		 =================

> print("hello world")
[1] "hello world"
curr.fun: symbol print
 .. after ‘expression(print("hello world"))’
. given clean namessafety environment created in  
full environment created in  
data frames removed from  : data 
safety attached containing: data 
Output/Figures/sumby_fig_1.1_1.png created.

 Output/Core/table_1.1.xml created.

Objects removed: X 
safety detached containing: data 
full attached containing: data 
Output/Figures/sumby_fig_1.1.1_1.png created.

 Output/Core/table_1.1.1.xml created.

Objects removed: X 
full detached containing: data 
safety attached containing: data 
Output/Figures/sumby_fig_1.10_1.png created.
Output/Figures/sumby_fig_1.10_2.png created.

Objects removed: args_list clean_up directory dpi footnote format graphics_args height number plot units verbose width 
safety detached containing: data 

 Output/Figures/fig_1.10.png created.
'envir' chosen:<environment: 0x55903c7186c0>
encoding = "native.enc" chosen
 --> from_file='TRUE'
 lines:function (x, ...)  
--> parsed 19 expressions; now eval(.)ing them:

>>>> eval(expression_nr. 1 )
		 =================

> attach_pop(1.1)
safety attached containing: data 
curr.fun: symbol attach_pop
 .. after ‘expression(attach_pop(1.1))’

>>>> eval(expression_nr. 2 )
		 =================

> X <- sumby(endpoint, rx, data = data)
Output/Figures/sumby_fig_1.1_1.png created.
curr.fun: symbol <-
 .. after ‘expression(X <- sumby(endpoint, rx, data = data))’

>>>> eval(expression_nr. 3 )
		 =================

> write_table(X)

 Output/Core/table_1.1.xml created.

Objects removed: fig X 
safety detached containing: data 
curr.fun: symbol write_table
 .. after ‘expression(write_table(X))’

>>>> eval(expression_nr. 4 )
		 =================

> attach_pop("1.1.1", verbose = TRUE)
full attached containing: data 
curr.fun: symbol attach_pop
 .. after ‘expression(attach_pop("1.1.1", verbose = TRUE))’

>>>> eval(expression_nr. 5 )
		 =================

> X <- sumby(endpoint, rx, data = data)
Output/Figures/sumby_fig_1.1.1_1.png created.
curr.fun: symbol <-
 .. after ‘expression(X <- sumby(endpoint, rx, data = data))’

>>>> eval(expression_nr. 6 )
		 =================

> write_table(X, clean_up = FALSE)

 Output/Core/table_1.1.1.xml created.
curr.fun: symbol write_table
 .. after ‘expression(write_table(X, clean_up = FALSE))’

>>>> eval(expression_nr. 7 )
		 =================

> meta_table <- get_meta_table()
curr.fun: symbol <-
 .. after ‘expression(meta_table <- get_meta_table())’

>>>> eval(expression_nr. 8 )
		 =================

> meta_table[2, "subtitle"] <- ""
curr.fun: symbol <-
 .. after ‘expression(meta_table[2, "subtitle"] <- "")’

>>>> eval(expression_nr. 9 )
		 =================

> ntabs <- nrow(meta_table)
curr.fun: symbol <-
 .. after ‘expression(ntabs <- nrow(meta_table))’

>>>> eval(expression_nr. 10 )
		 =================

> meta_table[ntabs + 1, "number"] <- "1.1.2"
curr.fun: symbol <-
 .. after ‘expression(meta_table[ntabs + 1, "number"] <- "1.1.2")’

>>>> eval(expression_nr. 11 )
		 =================

> meta_table[ntabs + 1, "population"] <- " "
curr.fun: symbol <-
 .. after ‘expression(meta_table[ntabs + 1, "population"] <- " ")’

>>>> eval(expression_nr. 12 )
		 =================

> set_meta_table(meta_table)
curr.fun: symbol set_meta_table
 .. after ‘expression(set_meta_table(meta_table))’

>>>> eval(expression_nr. 13 )
		 =================

> write_table(X, number = "1.1.2")

 Output/Core/table_1.1.2.xml created.

Objects removed: ntabs X 
curr.fun: symbol write_table
 .. after ‘expression(write_table(X, number = "1.1.2"))’

>>>> eval(expression_nr. 14 )
		 =================

> attach_pop("1.10")
full detached.
safety attached containing: data 
curr.fun: symbol attach_pop
 .. after ‘expression(attach_pop("1.10"))’

>>>> eval(expression_nr. 15 )
		 =================

> sumby(response, rx, data = data)
Output/Figures/sumby_fig_1.10_1.png created.
curr.fun: symbol sumby
     Variable   Statistics A             B             Total         
[1,] "Response" "Fail"     "25/50 (50%)" "25/50 (50%)" "50/100 (50%)"
[2,] ""         "Respond"  "25/50 (50%)" "25/50 (50%)" "50/100 (50%)"
attr(,"fig")
 .. after ‘expression(sumby(response, rx, data = data))’

>>>> eval(expression_nr. 16 )
		 =================

> fig <- sumby(response, rx, data = data) %>% attr("fig")
Output/Figures/sumby_fig_1.10_2.png created.
curr.fun: symbol <-
 .. after ‘expression(fig <- sumby(response, rx, data = data) %>% attr("fig"))’

>>>> eval(expression_nr. 17 )
		 =================

> write_ggplot(fig, format = "png")

Objects removed: args_list clean_up directory dpi footnote format graphics_args height number plot units verbose width 
safety detached containing: data 

 Output/Figures/fig_1.10.png created.
curr.fun: symbol write_ggplot
 .. after ‘expression(write_ggplot(fig, format = "png"))’

>>>> eval(expression_nr. 18 )
		 =================

> attach_pop("2.1")
safety attached containing: data 
curr.fun: symbol attach_pop
 .. after ‘expression(attach_pop("2.1"))’

>>>> eval(expression_nr. 19 )
		 =================

> write_text("There were no deaths")

 Output/Core/text_2.1.xml created.

Objects removed: fig 
safety detached containing: data 
curr.fun: symbol write_text
 .. after ‘expression(write_text("There were no deaths"))’
                                                             parent
1 /__w/rocker_uat/rocker_uat/packages/cctu/cctu-tests/testthat/ROOT
                                                                    child
1 /__w/rocker_uat/rocker_uat/packages/cctu/cctu-tests/testthat/analysis.R
[1] "fig_1.10.png"
[1] "sumby_fig_1.1_1.png"
[1] "sumby_fig_1.1.1_1.png"
[1] "sumby_fig_1.10_1.png"
[1] "sumby_fig_1.10_2.png"
[1] "sumby_fig_99.99.99.99_1.png"
character(0)
 [1] "_snaps"                     "analysis_interactive.R"    
 [3] "analysis.R"                 "analysisB.R"               
 [5] "check_loging.R"             "container.R"               
 [7] "data"                       "fig_1.10.eps"              
 [9] "fig_1.10.png"               "fig_1.10.postscript"       
[11] "fixtures"                   "hello_world.R"             
[13] "helper.R"                   "interactive_sumby.R"       
[15] "nested_run_batch.R"         "ref"                       
[17] "Rplots.pdf"                 "script_to_test_run_batch.R"
[19] "source_myself.R"            "table_1.10.xml"            
[21] "test_1.R"                   "test_attach_pop.R"         
[23] "test_cctu_initiaize.R"      "test_clean_meta_table.R"   
[25] "test_clean_names.R"         "test_create_word_xml.R"    
[27] "test_get_obj.R"             "test_order_dewey.R"        
[29] "test_propercase.R"          "test_rbind_space.R"        
[31] "test_read_data.R"           "test_regression_table.R"   
[33] "test_remove_rows_cols.R"    "test_rm_envir.R"           
[35] "test_run_batch.R"           "test_sumby.R"              
[37] "test_utf8.R"                "test_write_ggplot.R"       
[39] "test_write_table_text.R"    "test-cttab.R"              
[41] "test-format_digits.R"       "test-is_empty.R"           
[43] "test-labels.R"              "test-macro_utils.R"        
[45] "test-merge-data.r"          "test-p_format.R"           
[47] "test-render_stat.R"         "test-to_factor.R"          
[49] "test-utils.R"              
[1] "Maybe set up a Project in Rstudio and a git repository?\nCopy across or install packages in the project library, set .libPaths()?"
[1] "/usr/local/lib/R/site-library/cctu/scripts/main.R"
 [1] "_snaps"                     "analysis_interactive.R"    
 [3] "analysis.R"                 "analysisB.R"               
 [5] "check_loging.R"             "container.R"               
 [7] "data"                       "fig_1.10.eps"              
 [9] "fig_1.10.png"               "fig_1.10.postscript"       
[11] "fixtures"                   "hello_world.R"             
[13] "helper.R"                   "interactive_sumby.R"       
[15] "library"                    "main.R"                    
[17] "nested_run_batch.R"         "Output"                    
[19] "Progs"                      "ref"                       
[21] "Rplots.pdf"                 "script_to_test_run_batch.R"
[23] "source_myself.R"            "table_1.10.xml"            
[25] "test_1.R"                   "test_attach_pop.R"         
[27] "test_cctu_initiaize.R"      "test_clean_meta_table.R"   
[29] "test_clean_names.R"         "test_create_word_xml.R"    
[31] "test_get_obj.R"             "test_order_dewey.R"        
[33] "test_propercase.R"          "test_rbind_space.R"        
[35] "test_read_data.R"           "test_regression_table.R"   
[37] "test_remove_rows_cols.R"    "test_rm_envir.R"           
[39] "test_run_batch.R"           "test_sumby.R"              
[41] "test_utf8.R"                "test_write_ggplot.R"       
[43] "test_write_table_text.R"    "test-cttab.R"              
[45] "test-format_digits.R"       "test-is_empty.R"           
[47] "test-labels.R"              "test-macro_utils.R"        
[49] "test-merge-data.r"          "test-p_format.R"           
[51] "test-render_stat.R"         "test-to_factor.R"          
[53] "test-utils.R"              
 [1] "_snaps"                     "analysis_interactive.R"    
 [3] "analysis.R"                 "analysisB.R"               
 [5] "check_loging.R"             "container.R"               
 [7] "data"                       "fig_1.10.eps"              
 [9] "fig_1.10.png"               "fig_1.10.postscript"       
[11] "fixtures"                   "hello_world.R"             
[13] "helper.R"                   "interactive_sumby.R"       
[15] "nested_run_batch.R"         "nonroot"                   
[17] "Output"                     "ref"                       
[19] "Rplots.pdf"                 "script_to_test_run_batch.R"
[21] "source_myself.R"            "table_1.10.xml"            
[23] "test_1.R"                   "test_attach_pop.R"         
[25] "test_cctu_initiaize.R"      "test_clean_meta_table.R"   
[27] "test_clean_names.R"         "test_create_word_xml.R"    
[29] "test_get_obj.R"             "test_order_dewey.R"        
[31] "test_propercase.R"          "test_rbind_space.R"        
[33] "test_read_data.R"           "test_regression_table.R"   
[35] "test_remove_rows_cols.R"    "test_rm_envir.R"           
[37] "test_run_batch.R"           "test_sumby.R"              
[39] "test_utf8.R"                "test_write_ggplot.R"       
[41] "test_write_table_text.R"    "test-cttab.R"              
[43] "test-format_digits.R"       "test-is_empty.R"           
[45] "test-labels.R"              "test-macro_utils.R"        
[47] "test-merge-data.r"          "test-p_format.R"           
[49] "test-render_stat.R"         "test-to_factor.R"          
[51] "test-utils.R"              
[1] "nonroot"                "nonroot/Output"         "nonroot/Output/Core"   
[4] "nonroot/Output/Figures" "nonroot/Output/Reports"
object created in : dirtydata
object created in : meta
object created in : dirtydata
object created in : meta
[1] "dirtydata.csv"
object created in : dt
object created in : dlu
object created in : clu
output given clean namesobject created in : dt
output given clean namesobject created in : dlu
output given clean namesobject created in : clu
          (Intercept)   rms::rcs(age, 4)age  rms::rcs(age, 4)age' 
          -0.38104013            0.00189902           -0.00533899 
rms::rcs(age, 4)age''           log(height)          log(abdomen) 
           0.01983507           -0.43566037            0.61280658 
newenvir detached.
package:datasets detached.
Output/Figures/sumby_fig_99.99.99.99_1.png created.

R version 4.4.2 (2024-10-31) -- "Pile of Leaves"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> fig_file="/tmp/RtmpAYQpgq/fig_file.pdf"
> #need to define fig_file="...." outside this script
> library(cctu)

Attaching package: ‘cctu’

The following object is masked from ‘package:base’:

    source

> library(magrittr)
> n <- 10
> df <- data.frame(arm=rep(c("A","B"), rep(n,2)),
+                  age = rnorm(2*n, mean=40,sd=10) %>% round(1),
+                  gender = sample(c("Male","Female"),2*n, replace=TRUE)
+ )
> 
  > pdf(file=fig_file)
> sumby(gender, arm, data=df)
Saving 7 x 7 in image
     Variable Statistics A            B            Total        
[1,] "Gender" "Female"   "2/10 (20%)" "4/10 (40%)" "6/20 (30%)" 
[2,] ""       "Male"     "8/10 (80%)" "6/10 (60%)" "14/20 (70%)"
attr(,"fig")
> dev.off()
null device 
          1 
> 
  > 
Output/Figures/sumby_fig_99.99.99.99_2.png created.
Output/Figures/sumby_fig_99.99.99.99_3.png created.
     Variable Statistics  A type        B type        Total        
[1,] "Age"    "n"         "20"          "20"          "40"         
[2,] ""       "Mean (SD)" "37.6 (10.6)" "38.7 (10.8)" "38.1 (10.6)"
[3,] ""       "Median"    "35.75"       "39.3"        "38"         
[4,] ""       "Min, Max"  "17.9, 57.5"  "16.3, 58.2"  "16.3, 58.2" 
attr(,"fig")
[1] "matrix" "array" 
[1] "Variable"   "Statistics" "A type"     "B type"     "Total"     
Output/Figures/sumby_fig_99.99.99.99_4.png created.

 Output/Core/table_1.10.xml created.

Objects removed:  

Objects removed: args_list clean_up directory dpi footnote format graphics_args height number plot units verbose width 

 ./fig_1.10.png created.

 ./fig_1.10.eps created.

 Output/Figures/fig_1.10.png created.

 Output/Figures/fig_1.10.png created.

 Output/Figures/fig_1.10.png created.

Objects removed: fig new_plot X 

 Output/Figures/fig_1.10.png created.

 Output/Core/table_1.10.xml created.

 /tmp/RtmpAYQpgq/table_1.1.xml created.

 /tmp/RtmpAYQpgq/table_1.1.xml created.

 /tmp/RtmpAYQpgq/table_1.1.xml created.

 Output/Core/table_1.1.xml created.

Objects removed: dir1 dir2 dir3 fig X 

 Output/Core/table_1.10.xml created.

Objects removed: filetemp mt_tab X 

 Output/Core/text_1.10.xml created.

Objects removed:  

 ./table_1.10.xml created.

Objects removed:  

 ./table_1.10.xml created.

Objects removed: X 

 ./table_1.10.xml created.

Objects removed: X 

 ./table_1.10.xml created.

Objects removed: X 
safety environment created in  
data frames removed from  : dt 
safety attached containing: dt 
┌───────────────────┬─────────────────┬─────────────────┬─────────────────┐
|                   │     Placebo     │    Research     │      Total      |
├───────────────────┴─────────────────┴─────────────────┴─────────────────┤
|Observation        │       48        │       52        │       100       |
├───────────────────┬─────────────────┬─────────────────┬─────────────────┤
├───────────────────┴─────────────────┴─────────────────┴─────────────────┤
|Age                                                                      |
├───────────────────┬─────────────────┬─────────────────┬─────────────────┤
|  Valid Obs.       │       48        │       52        │       100       |
|  Mean (SD)        │   75.5 (7.86)   │   74.8 (8.04)   │   75.1 (7.93)   |
|  Median [Min, Max]│78.0 [57.0, 88.0]│77.0 [56.0, 88.0]│77.0 [56.0, 88.0]|
├───────────────────┴─────────────────┴─────────────────┴─────────────────┤
|Sex                                                                      |
├───────────────────┬─────────────────┬─────────────────┬─────────────────┤
|  Female           │  26/48 (54.2%)  │  25/52 (48.1%)  │ 51/100 (51.0%)  |
|  Male             │  22/48 (45.8%)  │  27/52 (51.9%)  │ 49/100 (49.0%)  |
├───────────────────┴─────────────────┴─────────────────┴─────────────────┤
|Baseline BMI (kg/m^2)                                                    |
├───────────────────┬─────────────────┬─────────────────┬─────────────────┤
|  Valid Obs.       │        5        │        5        │       10        |
|  Mean (SD)        │   27.8 (3.98)   │   24.5 (3.96)   │   26.2 (4.11)   |
|  Median [Min, Max]│27.9 [23.4, 32.8]│23.0 [21.3, 31.4]│24.2 [21.3, 32.8]|
|  Missing          │                 │    1 (16.7%)    │    1 (9.1%)     |
└───────────────────┴─────────────────┴─────────────────┴─────────────────┘

 /tmp/RtmpAYQpgq/table_1.1.xml created.

Objects removed:  
safety detached containing: dt 
safety attached containing: dt 

 /tmp/RtmpAYQpgq/table_1.1.xml created.
safety detached.
safety attached containing: dt 

 /tmp/RtmpAYQpgq/table_1.10.xml created.

Objects removed:  
safety detached containing: dt 
safety attached containing: dt 

 /tmp/RtmpAYQpgq/table_1.10.xml created.

Objects removed:  
safety detached containing: dt 
safety attached containing: dt 

 /tmp/RtmpAYQpgq/table_1.1.xml created.

Objects removed:  
safety detached containing: dt 
safety attached containing: dt 
[ FAIL 0 | WARN 66 | SKIP 3 | PASS 336 ]

══ Skipped tests (3) ═══════════════════════════════════════════════════════════
• empty test (1): 'test_write_ggplot.R:35:1'
• On CI (1): 'test_write_table_text.R:131:11'
• Skipping (1): 'test_run_batch.R:11:13'

[ FAIL 0 | WARN 66 | SKIP 3 | PASS 336 ]
> 
> #desiderata
> 
> # check of using nonstandard paths for output.
> 
