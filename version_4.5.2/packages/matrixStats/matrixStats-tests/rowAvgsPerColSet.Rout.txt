
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library("matrixStats")
> 
> X <- matrix(rnorm(20 * 6), nrow = 20, ncol = 6)
> rownames(X) <- LETTERS[1:nrow(X)]
> colnames(X) <- letters[1:ncol(X)]
> print(X)
           a          b           c           d           e           f
A  0.4680160  1.3156923  0.88990711  1.50730025  1.47229705 -0.20021461
B  0.2561000 -0.2718639 -1.91757774 -1.01474050 -1.16077170  1.01115391
C -0.1004308 -1.7193645 -0.47525961  0.98638426  0.34620428  1.08972823
D -0.3498660 -0.9047208  0.71373944 -0.73472978  0.02031828  2.63085128
E  0.8159949  0.4073951  0.24020150 -1.08296379 -1.03265282  0.82192104
F  0.2297126 -0.6595353 -1.27245924  0.84922825  0.08626943 -0.06690601
G  0.3002288 -0.2172710 -1.32411165  0.29740275 -1.02208504 -0.37648757
H -0.3852444 -0.9861162 -0.37909418 -1.04019085  0.33053851 -0.88523853
I -0.9733033 -0.7006660 -1.53296281  0.05147512 -0.63699124 -3.24718678
J -0.6469802 -1.4669141  0.61181520 -0.26255476 -0.42975539  1.34217030
K  0.5949657 -2.0732967 -2.40289509  0.83776364  0.18719076 -0.78301085
L -0.2736797 -0.6894187  0.43613325 -0.94649741 -0.57732682 -0.14841242
M -0.8308812 -0.1102925  0.37071720 -0.94010442 -1.25334968 -0.81810815
N -0.2548464  0.7474146  0.27645671 -1.28495114  0.19020580  1.06482919
O  0.7079689 -1.5974247 -1.93334156 -0.08829714  0.78403415 -1.03982217
P -0.1439172 -0.3452143  0.74315217  0.86906700  0.51256507  1.39069004
Q  0.3901109 -1.3517819  0.11978640  0.26597659  0.07004052  0.31852161
R -0.2636305 -1.4409379  0.29191688 -0.58855000 -0.49454349 -1.07610350
S  1.1987594 -1.0117175 -0.62218879  0.21026134  0.82949309 -0.65192085
T -2.9387843 -0.5548508 -0.04004038 -1.29600457  0.57537093  0.89607944
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Apply rowMeans() for 3 sets of 2 columns
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 3L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3
[1,]  1  3  5
[2,]  2  4  6
> 
> Z <- rowAvgsPerColSet(X, S = S)
> print(Z)
            s1          s2           s3
A  0.891854175  1.19860368  0.636041219
B -0.007881946 -1.46615912 -0.074808894
C -0.909897673  0.25556233  0.717966253
D -0.627293401 -0.01049517  1.325584776
E  0.611694958 -0.42138115 -0.105365891
F -0.214911342 -0.21161549  0.009681709
G  0.041478916 -0.51335445 -0.699286304
H -0.685680290 -0.70964251 -0.277350011
I -0.836984665 -0.74074385 -1.942089006
J -1.056947123  0.17463022  0.456207451
K -0.739165496 -0.78256573 -0.297910047
L -0.481549236 -0.25518208 -0.362869621
M -0.470586862 -0.28469361 -1.035728913
N  0.246284089 -0.50424721  0.627517492
O -0.444727903 -1.01081935 -0.127894007
P -0.244565739  0.80610958  0.951627555
Q -0.480835503  0.19288150  0.194281061
R -0.852284174 -0.14831656 -0.785323496
S  0.093520944 -0.20596373  0.088786120
T -1.746817551 -0.66802247  0.735725183
> 
> # Validation
> Z0 <- cbind(s1 = rowMeans(X[, 1:2]), s2 = rowMeans(X[, 3:4]),
+             s3 = rowMeans(X[, 5:6]))
> stopifnot(identical(drop(Z), Z0))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Apply colMeans() for 5 sets of 4 rows
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 5L
> S <- matrix(1:nrow(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3 s4 s5
[1,]  1  5  9 13 17
[2,]  2  6 10 14 18
[3,]  3  7 11 15 19
[4,]  4  8 12 16 20
> 
> Z <- colAvgsPerRowSet(X, S = S)
> print(Z)
            a          b           c           d           e          f
s1  0.0684548 -0.3950642 -0.19729770  0.18605356  0.16951198  1.1328797
s2  0.2401730 -0.3638819 -0.68386589 -0.24413091 -0.40948248 -0.1266778
s3 -0.3247494 -1.2325739 -0.72197736 -0.07995335 -0.36422067 -0.7091099
s4 -0.1304190 -0.3263792 -0.13575387 -0.36107143  0.05836383  0.1493972
s5 -0.4033861 -1.0898220 -0.06263147 -0.35207916  0.24509026 -0.1283558
> 
> # Validation
> Z0 <- rbind(s1 = colMeans(X[1:4, ]), s2 = colMeans(X[5:8, ]),
+             s3 = colMeans(X[9:12, ]), s4 = colMeans(X[13:16, ]),
+             s5 = colMeans(X[17:20, ]))
> stopifnot(identical(drop(Z), Z0))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # When there is only one "complete" set
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 1L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1
[1,]  1
[2,]  2
[3,]  3
[4,]  4
[5,]  5
[6,]  6
> 
> Z <- rowAvgsPerColSet(X, S = S, FUN = rowMeans)
> print(Z)
            s1
A  0.908833024
B -0.516283320
C  0.021210302
D  0.229265402
E  0.028315974
F -0.138948376
G -0.390387279
H -0.557557605
I -1.173272506
J -0.142036484
K -0.606547089
L -0.366533646
M -0.597003128
N  0.123184789
O -0.527813754
P  0.504390465
Q -0.031224315
R -0.595308077
S -0.007885554
T -0.559704947
> 
> Z0 <- rowMeans(X)
> stopifnot(identical(drop(Z), Z0))
> 
> 
> nbr_of_sets <- 1L
> S <- matrix(1:nrow(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
      s1
 [1,]  1
 [2,]  2
 [3,]  3
 [4,]  4
 [5,]  5
 [6,]  6
 [7,]  7
 [8,]  8
 [9,]  9
[10,] 10
[11,] 11
[12,] 12
[13,] 13
[14,] 14
[15,] 15
[16,] 16
[17,] 17
[18,] 18
[19,] 19
[20,] 20
> 
> Z <- colAvgsPerRowSet(X, S = S, FUN = colMeans)
> print(Z)
            a          b          c          d           e          f
s1 -0.1099853 -0.6815442 -0.3603053 -0.1702363 -0.06014742 0.06362668
> 
> Z0 <- colMeans(X)
> stopifnot(identical(drop(Z), Z0))
> 
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Use weights
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 3L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3
[1,]  1  3  5
[2,]  2  4  6
> 
> W <- matrix(runif(length(X)), nrow = nrow(X), ncol = ncol(X))
> Z1 <- rowAvgsPerColSet(X, W = W, S = S, FUN = rowWeightedMeans)
> print(Z1)
            s1          s2           s3
A  0.891854175  1.19860368  0.636041219
B -0.007881946 -1.46615912 -0.074808894
C -0.909897673  0.25556233  0.717966253
D -0.627293401 -0.01049517  1.325584776
E  0.611694958 -0.42138115 -0.105365891
F -0.214911342 -0.21161549  0.009681709
G  0.041478916 -0.51335445 -0.699286304
H -0.685680290 -0.70964251 -0.277350011
I -0.836984665 -0.74074385 -1.942089006
J -1.056947123  0.17463022  0.456207451
K -0.739165496 -0.78256573 -0.297910047
L -0.481549236 -0.25518208 -0.362869621
M -0.470586862 -0.28469361 -1.035728913
N  0.246284089 -0.50424721  0.627517492
O -0.444727903 -1.01081935 -0.127894007
P -0.244565739  0.80610958  0.951627555
Q -0.480835503  0.19288150  0.194281061
R -0.852284174 -0.14831656 -0.785323496
S  0.093520944 -0.20596373  0.088786120
T -1.746817551 -0.66802247  0.735725183
> Z2 <- colAvgsPerRowSet(X, W = W, S = S, FUN = colWeightedMeans)
> print(Z2)
            a          b          c          d          e         f
s1  0.3620580  0.5219142 -0.5138353  0.2462799  0.1557627 0.4054697
s2 -0.2251484 -1.3120427  0.1192399  0.1258272  0.1832613 1.8602898
s3  0.5228537 -0.1260701 -0.5161289 -0.1168678 -0.4731917 0.3775075
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Result should always be a matrix, including when nrow(X) <= 1
> # (https://github.com/HenrikBengtsson/matrixStats/issues/108)
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> X <- matrix(1:3, nrow = 1L, ncol = 3L)
> S <- matrix(1, nrow = 1L, ncol = 1L)
> Z1 <- rowAvgsPerColSet(X, S = S)
> stopifnot(is.matrix(Z1))
> Z2 <- rowAvgsPerColSet(X, S = S, rows = 0)
> stopifnot(is.matrix(Z2))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Works with many, one or zero columns / rows
> # (https://github.com/HenrikBengtsson/matrixStats/issues/172)
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> S <- cbind(1:2, 3:4, 5:6)
> X <- matrix(rnorm(2 * 6), nrow = 6, ncol = 2)
> Z2 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z2_ref <- rbind(colSums2(X[S[,1], ,drop=FALSE]),
+                 colSums2(X[S[,2], ,drop=FALSE]),
+                 colSums2(X[S[,3], ,drop=FALSE]))
> stopifnot(identical(Z2, Z2_ref))
> X <- matrix(rnorm(6), nrow = 6, ncol = 1)
> Z1 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z1_ref <- rbind(colSums2(X[S[,1], ,drop=FALSE]),
+                 colSums2(X[S[,2], ,drop=FALSE]),
+                 colSums2(X[S[,3], ,drop=FALSE]))
> stopifnot(identical(Z1, Z1_ref))
> X <- matrix(numeric(0), nrow = 6, ncol = 0)
> Z0 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z0_ref <- matrix(numeric(0), nrow = ncol(S), ncol = 0)
> stopifnot(identical(Z0, unname(Z0_ref)))
> 
> 
> S <- rbind(1:4, 5:8)
> X <- matrix(rnorm(n = 2 * 8), nrow = 2, ncol = 8)
> Z2 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z2_ref <- cbind(rowMeans2(X[,S[,1],drop=FALSE]),
+                 rowMeans2(X[,S[,2],drop=FALSE]),
+                 rowMeans2(X[,S[,3],drop=FALSE]),
+                 rowMeans2(X[,S[,4],drop=FALSE]))
> stopifnot(identical(Z2, Z2_ref))
> X <- matrix(rnorm(n = 8), nrow = 1, ncol = 8)
> Z1 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z1_ref <- cbind(rowMeans2(X[,S[,1],drop=FALSE]),
+                 rowMeans2(X[,S[,2],drop=FALSE]),
+                 rowMeans2(X[,S[,3],drop=FALSE]),
+                 rowMeans2(X[,S[,4],drop=FALSE]))
> stopifnot(identical(Z1, Z1_ref))
> X <- matrix(numeric(0), nrow = 0, ncol = 8)
> Z0 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z0_ref <- matrix(numeric(0), nrow = 0, ncol = ncol(S))
> stopifnot(identical(Z0, Z0_ref))
> 
