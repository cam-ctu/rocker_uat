
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library("matrixStats")
> 
> X <- matrix(rnorm(20 * 6), nrow = 20, ncol = 6)
> rownames(X) <- LETTERS[1:nrow(X)]
> colnames(X) <- letters[1:ncol(X)]
> print(X)
            a            b           c            d           e           f
A  0.44715357 -0.372341523  0.76945815 -0.572428423  0.31914657  2.18712034
B -0.76335229 -0.009415148 -0.20368048 -1.135005591 -1.77014446  2.61262552
C -1.54580213  0.200545789  0.90905669  0.279737493 -0.99158047 -0.72966142
D -0.90550376  1.399112558 -0.15308933 -2.267273962  0.85691145 -0.88821970
E -0.26871100 -0.166605681 -0.43987492  0.417865055  0.67575992  0.22832890
F  0.35538181 -1.436783601  0.62195459  0.400807499  1.10488640 -0.03957336
G  0.04824008 -0.073177651  0.86035857 -0.911795039 -0.36819479 -0.88058381
H -0.80725445 -0.668220733  0.66916448 -1.003103189  0.28556149 -0.72130164
I  0.20586603  1.028011565  0.17324880  2.145380213  1.58119644 -0.31026355
J -0.47498138  0.557875889 -0.20369960 -0.606058140  0.24084431  0.44417895
K  0.03673804  0.771498808  0.02601458  0.485727211  0.41552708 -0.43893088
L -0.48748620 -0.000897939 -1.57610591  0.176619415 -0.27564778  0.27834839
M -0.20132500 -1.328790636 -0.93085236 -1.260701212  0.87474147  0.08307033
N -0.84455608  2.339537264  0.33212263 -0.720057698 -0.48484260  0.49936400
O  1.00273994 -0.841779707  0.76922988  2.046441689  1.23505266 -1.55549741
P -0.31030472  0.808933241  1.59022650 -0.759203270  0.06405935  0.59482525
Q -0.91550721  0.079835560  0.90683574 -1.407088651  1.50194667  0.94044474
R  0.48533778  0.487023781  0.82589623  0.675559496 -0.27694072  0.57269099
S -1.03572252 -0.824606862 -1.17536315 -0.426791197 -0.35084375 -0.49531370
T -0.87948636  0.147733928  0.67482230  0.008765151  0.50405628  0.28011050
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Apply rowMeans() for 3 sets of 2 columns
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 3L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3
[1,]  1  3  5
[2,]  2  4  6
> 
> Z <- rowAvgsPerColSet(X, S = S)
> print(Z)
           s1          s2           s3
A  0.03740602  0.09851486  1.253133455
B -0.38638372 -0.66934304  0.421240530
C -0.67262817  0.59439709 -0.860620941
D  0.24680440 -1.21018165 -0.015654125
E -0.21765834 -0.01100493  0.452044410
F -0.54070090  0.51138104  0.532656519
G -0.01246878 -0.02571823 -0.624389304
H -0.73773759 -0.16696935 -0.217870072
I  0.61693880  1.15931451  0.635466445
J  0.04144726 -0.40487887  0.342511628
K  0.40411842  0.25587089 -0.011701903
L -0.24419207 -0.69974325  0.001350306
M -0.76505782 -1.09577679  0.478905902
N  0.74749059 -0.19396753  0.007260700
O  0.08048012  1.40783579 -0.160222374
P  0.24931426  0.41551162  0.329442299
Q -0.41783582 -0.25012646  1.221195706
R  0.48618078  0.75072786  0.147875135
S -0.93016469 -0.80107717 -0.423078727
T -0.36587622  0.34179373  0.392083392
> 
> # Validation
> Z0 <- cbind(s1 = rowMeans(X[, 1:2]), s2 = rowMeans(X[, 3:4]),
+             s3 = rowMeans(X[, 5:6]))
> stopifnot(identical(drop(Z), Z0))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Apply colMeans() for 5 sets of 4 rows
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 5L
> S <- matrix(1:nrow(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3 s4 s5
[1,]  1  5  9 13 17
[2,]  2  6 10 14 18
[3,]  3  7 11 15 19
[4,]  4  8 12 16 20
> 
> Z <- colAvgsPerRowSet(X, S = S)
> print(Z)
             a          b          c          d          e            f
s1 -0.69187615  0.3044754  0.3304363 -0.9237426 -0.3964167  0.795466186
s2 -0.16808589 -0.5861969  0.4279007 -0.2740564  0.4245033 -0.353282479
s3 -0.17996588  0.5891221 -0.3951355  0.5504172  0.4904800 -0.006666774
s4 -0.08836147  0.2444750  0.4401817 -0.1733801  0.4222527 -0.094559457
s5 -0.58634458 -0.0275034  0.3080478 -0.2873888  0.3445546  0.324483134
> 
> # Validation
> Z0 <- rbind(s1 = colMeans(X[1:4, ]), s2 = colMeans(X[5:8, ]),
+             s3 = colMeans(X[9:12, ]), s4 = colMeans(X[13:16, ]),
+             s5 = colMeans(X[17:20, ]))
> stopifnot(identical(drop(Z), Z0))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # When there is only one "complete" set
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 1L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1
[1,]  1
[2,]  2
[3,]  3
[4,]  4
[5,]  5
[6,]  6
> 
> Z <- rowAvgsPerColSet(X, S = S, FUN = rowMeans)
> print(Z)
            s1
A  0.463018114
B -0.211495408
C -0.312950673
D -0.326343791
E  0.074460379
F  0.167778889
G -0.220858774
H -0.374192339
I  0.803906583
J -0.006973328
K  0.216095805
L -0.314195004
M -0.460642902
N  0.186927919
O  0.442697844
P  0.331422726
Q  0.184411142
R  0.461594593
S -0.718106864
T  0.122666967
> 
> Z0 <- rowMeans(X)
> stopifnot(identical(drop(Z), Z0))
> 
> 
> nbr_of_sets <- 1L
> S <- matrix(1:nrow(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
      s1
 [1,]  1
 [2,]  2
 [3,]  3
 [4,]  4
 [5,]  5
 [6,]  6
 [7,]  7
 [8,]  8
 [9,]  9
[10,] 10
[11,] 11
[12,] 12
[13,] 13
[14,] 14
[15,] 15
[16,] 16
[17,] 17
[18,] 18
[19,] 19
[20,] 20
> 
> Z <- colAvgsPerRowSet(X, S = S, FUN = colMeans)
> print(Z)
            a         b         c          d         e         f
s1 -0.3429268 0.1048744 0.2222862 -0.2216302 0.2570748 0.1330881
> 
> Z0 <- colMeans(X)
> stopifnot(identical(drop(Z), Z0))
> 
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Use weights
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 3L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3
[1,]  1  3  5
[2,]  2  4  6
> 
> W <- matrix(runif(length(X)), nrow = nrow(X), ncol = ncol(X))
> Z1 <- rowAvgsPerColSet(X, W = W, S = S, FUN = rowWeightedMeans)
> print(Z1)
           s1          s2           s3
A  0.03740602  0.09851486  1.253133455
B -0.38638372 -0.66934304  0.421240530
C -0.67262817  0.59439709 -0.860620941
D  0.24680440 -1.21018165 -0.015654125
E -0.21765834 -0.01100493  0.452044410
F -0.54070090  0.51138104  0.532656519
G -0.01246878 -0.02571823 -0.624389304
H -0.73773759 -0.16696935 -0.217870072
I  0.61693880  1.15931451  0.635466445
J  0.04144726 -0.40487887  0.342511628
K  0.40411842  0.25587089 -0.011701903
L -0.24419207 -0.69974325  0.001350306
M -0.76505782 -1.09577679  0.478905902
N  0.74749059 -0.19396753  0.007260700
O  0.08048012  1.40783579 -0.160222374
P  0.24931426  0.41551162  0.329442299
Q -0.41783582 -0.25012646  1.221195706
R  0.48618078  0.75072786  0.147875135
S -0.93016469 -0.80107717 -0.423078727
T -0.36587622  0.34179373  0.392083392
> Z2 <- colAvgsPerRowSet(X, W = W, S = S, FUN = colWeightedMeans)
> print(Z2)
            a          b          c          d           e           f
s1 -0.1580994 -0.1908783 0.28288884 -0.8537170 -0.72549894  2.39987293
s2 -1.2256529  0.7998292 0.37798368 -0.9937682 -0.06733451 -0.80894056
s3  0.0433354 -0.8016946 0.09103984  0.4093363  0.89032316  0.09437777
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Result should always be a matrix, including when nrow(X) <= 1
> # (https://github.com/HenrikBengtsson/matrixStats/issues/108)
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> X <- matrix(1:3, nrow = 1L, ncol = 3L)
> S <- matrix(1, nrow = 1L, ncol = 1L)
> Z1 <- rowAvgsPerColSet(X, S = S)
> stopifnot(is.matrix(Z1))
> Z2 <- rowAvgsPerColSet(X, S = S, rows = 0)
> stopifnot(is.matrix(Z2))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Works with many, one or zero columns / rows
> # (https://github.com/HenrikBengtsson/matrixStats/issues/172)
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> S <- cbind(1:2, 3:4, 5:6)
> X <- matrix(rnorm(2 * 6), nrow = 6, ncol = 2)
> Z2 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z2_ref <- rbind(colSums2(X[S[,1], ,drop=FALSE]),
+                 colSums2(X[S[,2], ,drop=FALSE]),
+                 colSums2(X[S[,3], ,drop=FALSE]))
> stopifnot(identical(Z2, Z2_ref))
> X <- matrix(rnorm(6), nrow = 6, ncol = 1)
> Z1 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z1_ref <- rbind(colSums2(X[S[,1], ,drop=FALSE]),
+                 colSums2(X[S[,2], ,drop=FALSE]),
+                 colSums2(X[S[,3], ,drop=FALSE]))
> stopifnot(identical(Z1, Z1_ref))
> X <- matrix(numeric(0), nrow = 6, ncol = 0)
> Z0 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z0_ref <- matrix(numeric(0), nrow = ncol(S), ncol = 0)
> stopifnot(identical(Z0, unname(Z0_ref)))
> 
> 
> S <- rbind(1:4, 5:8)
> X <- matrix(rnorm(n = 2 * 8), nrow = 2, ncol = 8)
> Z2 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z2_ref <- cbind(rowMeans2(X[,S[,1],drop=FALSE]),
+                 rowMeans2(X[,S[,2],drop=FALSE]),
+                 rowMeans2(X[,S[,3],drop=FALSE]),
+                 rowMeans2(X[,S[,4],drop=FALSE]))
> stopifnot(identical(Z2, Z2_ref))
> X <- matrix(rnorm(n = 8), nrow = 1, ncol = 8)
> Z1 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z1_ref <- cbind(rowMeans2(X[,S[,1],drop=FALSE]),
+                 rowMeans2(X[,S[,2],drop=FALSE]),
+                 rowMeans2(X[,S[,3],drop=FALSE]),
+                 rowMeans2(X[,S[,4],drop=FALSE]))
> stopifnot(identical(Z1, Z1_ref))
> X <- matrix(numeric(0), nrow = 0, ncol = 8)
> Z0 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z0_ref <- matrix(numeric(0), nrow = 0, ncol = ncol(S))
> stopifnot(identical(Z0, Z0_ref))
> 
