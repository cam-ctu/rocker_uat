
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #! /usr/bin/env Rscript
> ## This runs testme test script inst/testme/test-cloneNode.R
> ## Don't edit - it was autogenerated by inst/testme/deploy.R
> parallelly:::testme("cloneNode")
Test ‘cloneNode’ ...

> library(parallelly)

> message("*** cloneNode() ...")
*** cloneNode() ...

> message("- cloneNode.default ...")
- cloneNode.default ...

> res <- tryCatch(cloneNode(list()), error = identity)

> print(res)
<simpleError in cloneNode.default(list()): Do not know how to clone node of class ‘list’>

> stopifnot(inherits(res, "error"))

> message("- cloneNode.default ... DONE")
- cloneNode.default ... DONE

> message("- cloneNode.RichSOCKnode ...")
- cloneNode.RichSOCKnode ...

> cl <- makeClusterPSOCK(1)

> node <- cl[[1]]

> opts <- options(parallelly.debug = TRUE)

> node_asis <- cloneNode(node, method = "as-is")
[10:25:40.246] cloneNode() for RichSOCKnode ...
[10:25:40.246] |  method: as-is
[10:25:40.247] |  Calling node-creation function with arguments:
[10:25:40.247] |  List of 1
[10:25:40.247] |   $ :List of 35
[10:25:40.247] |    ..$ worker          : chr "localhost"
[10:25:40.247] |    .. ..- attr(*, "localhost")= logi TRUE
[10:25:40.247] |    ..$ master          : chr "localhost"
[10:25:40.247] |    ..$ port            : int 11118
[10:25:40.247] |    ..$ connectTimeout  : num 120
[10:25:40.247] |    ..$ timeout         : num 2592000
[10:25:40.247] |    ..$ rscript         : chr "'/usr/local/lib/R/bin/Rscript'"
[10:25:40.247] |    ..$ homogeneous     : logi TRUE
[10:25:40.247] |    ..$ rscript_args    : chr "--default-packages=datasets,utils,grDevices,graphics,stats,methods -e 'try(suppressWarnings(cat(Sys.getpid(),fi"| __truncated__
[10:25:40.247] |    ..$ rscript_envs    : NULL
[10:25:40.247] |    ..$ rscript_libs    : NULL
[10:25:40.247] |    ..$ rscript_startup : NULL
[10:25:40.247] |    ..$ rscript_sh      : chr [1:2] "sh" "sh"
[10:25:40.247] |    ..$ default_packages: chr [1:6] "datasets" "utils" "grDevices" "graphics" ...
[10:25:40.247] |    ..$ methods         : logi TRUE
[10:25:40.247] |    ..$ socketOptions   : chr "no-delay"
[10:25:40.247] |    ..$ useXDR          : logi FALSE
[10:25:40.247] |    ..$ outfile         : chr "/dev/null"
[10:25:40.247] |    ..$ renice          : int NA
[10:25:40.247] |    ..$ rshcmd          : NULL
[10:25:40.247] |    ..$ user            : chr(0) 
[10:25:40.247] |    ..$ revtunnel       : logi FALSE
[10:25:40.247] |    ..$ rshlogfile      : NULL
[10:25:40.247] |    ..$ rshopts         : chr(0) 
[10:25:40.247] |    ..$ rank            : int 0
[10:25:40.247] |    ..$ manual          : logi FALSE
[10:25:40.247] |    ..$ dryrun          : logi FALSE
[10:25:40.247] |    ..$ quiet           : logi FALSE
[10:25:40.247] |    ..$ setup_strategy  : chr "sequential"
[10:25:40.247] |    ..$ local_cmd       : chr "'/usr/local/lib/R/bin/Rscript' --default-packages=datasets,utils,grDevices,graphics,stats,methods -e 'try(suppr"| __truncated__
[10:25:40.247] |    ..$ rshcmd_label    : NULL
[10:25:40.247] |    ..$ rsh_call        : NULL
[10:25:40.247] |    ..$ cmd             : chr "'/usr/local/lib/R/bin/Rscript' --default-packages=datasets,utils,grDevices,graphics,stats,methods -e 'try(suppr"| __truncated__
[10:25:40.247] |    ..$ localMachine    : logi TRUE
[10:25:40.247] |    ..$ make_fcn        :function (worker = getOption2("parallelly.localhost.hostname", "localhost"), 
[10:25:40.247] |      master = NULL, port, connectTimeout = getOption2("parallelly.makeNodePSOCK.connectTimeout", 
[10:25:40.247] |          2 * 60), timeout = getOption2("parallelly.makeNodePSOCK.timeout", 
[10:25:40.247] |          30 * 24 * 60 * 60), rscript = NULL, homogeneous = NULL, rscript_args = NULL, 
[10:25:40.247] |      rscript_envs = NULL, rscript_libs = NULL, rscript_startup = NULL, rscript_sh = c("auto", 
[10:25:40.247] |          "cmd", "sh", "none"), default_packages = c("datasets", "utils", 
[10:25:40.247] |          "grDevices", "graphics", "stats", if (methods) "methods"), methods = TRUE, 
[10:25:40.247] |      socketOptions = getOption2("parallelly.makeNodePSOCK.socketOptions", 
[10:25:40.247] |          "no-delay"), useXDR = getOption2("parallelly.makeNodePSOCK.useXDR", 
[10:25:40.247] |          FALSE), outfile = "/dev/null", renice = NA_integer_, rshcmd = getOption2("parallelly.makeNodePSOCK.rshcmd", 
[10:25:40.247] |          NULL), user = NULL, revtunnel = NA, rshlogfile = NULL, rshopts = getOption2("parallelly.makeNodePSOCK.rshopts", 
[10:25:40.247] |          NULL), rank = 1L, manual = FALSE, dryrun = FALSE, quiet = FALSE, 
[10:25:40.247] |      setup_strategy = getOption2("parallelly.makeNodePSOCK.setup_strategy", 
[10:25:40.247] |          "parallel"), calls = getOption2("parallelly.makeNodePSOCK.calls", 
[10:25:40.247] |          FALSE), action = c("launch", "options"), verbose = FALSE)  
[10:25:40.247] |    ..$ arguments       :List of 29
[10:25:40.247] |    .. ..$ worker          : chr "localhost"
[10:25:40.247] |    .. ..$ master          : NULL
[10:25:40.247] |    .. ..$ port            : int 11118
[10:25:40.247] |    .. ..$ connectTimeout  : num 120
[10:25:40.247] |    .. ..$ timeout         : num 2592000
[10:25:40.247] |    .. ..$ rscript         : NULL
[10:25:40.247] |    .. ..$ homogeneous     : NULL
[10:25:40.247] |    .. ..$ rscript_args    : NULL
[10:25:40.247] |    .. ..$ rscript_envs    : NULL
[10:25:40.247] |    .. ..$ rscript_libs    : NULL
[10:25:40.247] |    .. ..$ rscript_startup : NULL
[10:25:40.247] |    .. ..$ rscript_sh      : chr "auto"
[10:25:40.247] |    .. ..$ default_packages: chr [1:6] "datasets" "utils" "grDevices" "graphics" ...
[10:25:40.247] |    .. ..$ methods         : logi TRUE
[10:25:40.247] |    .. ..$ socketOptions   : chr "no-delay"
[10:25:40.247] |    .. ..$ useXDR          : logi FALSE
[10:25:40.247] |    .. ..$ outfile         : chr "/dev/null"
[10:25:40.247] |    .. ..$ renice          : int NA
[10:25:40.247] |    .. ..$ rshcmd          : NULL
[10:25:40.247] |    .. ..$ user            : NULL
[10:25:40.247] |    .. ..$ revtunnel       : logi NA
[10:25:40.247] |    .. ..$ rshlogfile      : NULL
[10:25:40.247] |    .. ..$ rshopts         : NULL
[10:25:40.247] |    .. ..$ rank            : int 1
[10:25:40.247] |    .. ..$ manual          : logi FALSE
[10:25:40.247] |    .. ..$ dryrun          : logi FALSE
[10:25:40.247] |    .. ..$ quiet           : logi FALSE
[10:25:40.247] |    .. ..$ setup_strategy  : chr "parallel"
[10:25:40.247] |    .. ..$ calls           : logi FALSE
[10:25:40.247] |    ..- attr(*, "class")= chr [1:2] "makeNodePSOCKOptions" "makeNodeOptions"
[10:25:40.450] |  Adding node session information
[10:25:40.451] cloneNode() for RichSOCKnode ... DONE

> print(node_asis)
RichSOCKnode of a socket cluster on local host 'localhost' with pid 103593 (R version 4.5.2 (2025-10-31), x86_64-pc-linux-gnu) using socket connection #3 ('<-localhost:11118')

> stopifnot(inherits(node_asis, "RichSOCKnode"))

> options(opts)

> node_vanilla <- cloneNode(node, method = "vanilla", 
+     setup_strategy = "sequential")

> print(node_vanilla)
RichSOCKnode of a socket cluster on local host 'localhost' with pid 103627 (R version 4.5.2 (2025-10-31), x86_64-pc-linux-gnu) using socket connection #5 ('<-localhost:11118')

> stopifnot(inherits(node_vanilla, "RichSOCKnode"))

> node_args <- cloneNode(node, method = "vanilla", setup_strategy = "sequential", 
+     user = "testuser")

> print(node_args)
RichSOCKnode of a socket cluster on local host 'localhost' with pid 103661 (R version 4.5.2 (2025-10-31), x86_64-pc-linux-gnu) using socket connection #6 ('<-localhost:11118')

> stopifnot(inherits(node_args, "RichSOCKnode"))

> parallel::stopCluster(cl)

> cl_asis <- list(node_asis)

> class(cl_asis) <- class(cl)

> parallel::stopCluster(cl_asis)

> cl_vanilla <- list(node_vanilla)

> class(cl_vanilla) <- class(cl)

> parallel::stopCluster(cl_vanilla)

> cl_args <- list(node_args)

> class(cl_args) <- class(cl)

> parallel::stopCluster(cl_args)

> message("- cloneNode.RichSOCKnode ... DONE")
- cloneNode.RichSOCKnode ... DONE

> message("- cloneNode.cluster ...")
- cloneNode.cluster ...

> cl <- makeClusterPSOCK(2)

> print(cl)
Socket cluster with 2 nodes on host ‘localhost’ (R version 4.5.2 (2025-10-31), platform x86_64-pc-linux-gnu)

> cl2 <- cloneNode(cl)

> print(cl2)
Socket cluster with 2 nodes on host ‘localhost’ (R version 4.5.2 (2025-10-31), platform x86_64-pc-linux-gnu)

> stopifnot(inherits(cl2, "cluster"), length(cl2) == 
+     length(cl))

> parallel::stopCluster(cl)

> parallel::stopCluster(cl2)

> message("- cloneNode.cluster ... DONE")
- cloneNode.cluster ... DONE

> message("- Restarting a dead node ...")
- Restarting a dead node ...

> cl <- makeClusterPSOCK(2)

> print(cl)
Socket cluster with 2 nodes on host ‘localhost’ (R version 4.5.2 (2025-10-31), platform x86_64-pc-linux-gnu)

> parallel::stopCluster(cl[2])

> Sys.sleep(1)

> print(isNodeAlive(cl))
[1] TRUE TRUE

> cl[2] <- cloneNode(cl[2])

> print(cl)
Socket cluster with 2 nodes on host ‘localhost’ (R version 4.5.2 (2025-10-31), platform x86_64-pc-linux-gnu)

> print(isNodeAlive(cl))
[1] TRUE TRUE

> stopifnot(all(isNodeAlive(cl)))

> parallel::stopCluster(cl)

> message("- Restarting a dead node ... DONE")
- Restarting a dead node ... DONE

> message("*** cloneNode() ... DONE")
*** cloneNode() ... DONE
Test time: user.self=0.1s, sys.self=0.008s, elapsed=3s, user.child=0.2s, sys.child=0.3s
Test ‘cloneNode’ ... success
> 
