
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #! /usr/bin/env Rscript
> ## This runs testme test script inst/testme/test-invalid-owner.R
> ## Don't edit - it was autogenerated by inst/testme/deploy.R
> future:::testme("invalid-owner")
Test ‘invalid-owner’ ...
 chr "none"

> library(future)
[09:47:27.178] Option 'future.startup.script': TRUE
[09:47:27.178] Future startup scripts considered: ‘.future.R’, ‘~/.future.R’
[09:47:27.179] Future startup scripts found: <none>

> options(future.debug = FALSE)

> usedNodes <- function(future) {
+     backend <- future[["backend"]]
+     workers <- backend[["workers"]]
+     reg <- backend[["reg"]]
+     c(use .... [TRUNCATED] 

> plan(multisession, workers = 2)

> message("*** future() - invalid ownership ...")
*** future() - invalid ownership ...

> session_uuid <- future:::session_uuid(attributes = TRUE)

> cat(sprintf("Main R process: %s\n", session_uuid))
Main R process: d61f1f9967580b331a8d679fdebb94ee

> message("- Asserting ownership ...")
- Asserting ownership ...

> message("Creating future #1:")
Creating future #1:

> f1 <- future({
+     future:::session_uuid(attributes = TRUE)
+ })

> stopifnot(inherits(f1, "MultisessionFuture"))

> cat(sprintf("Future #1 session: %d\n", f1$node))
Future #1 session: 1

> v1 <- value(f1)

> cat(sprintf("Future #1 R process: %s\n", v1))
Future #1 R process: 6898514d0d86facd3d4bae605b5646d7

> stopifnot(v1 != session_uuid)

> message("Creating future #2:")
Creating future #2:

> f2 <- future({
+     future:::session_uuid(attributes = TRUE)
+ })

> stopifnot(inherits(f2, "MultisessionFuture"))

> cat(sprintf("Future #2 session: %d\n", f2$node))
Future #2 session: 1

> v2 <- value(f2)

> cat(sprintf("Future #2 R process: %s\n", v2))
Future #2 R process: 6898514d0d86facd3d4bae605b5646d7

> stopifnot(v2 != session_uuid)

> message("Creating future #3:")
Creating future #3:

> f3 <- future({
+     f1$owner
+ })

> stopifnot(inherits(f3, "MultisessionFuture"))

> cat(sprintf("Future #3 session: %d\n", f3$node))
Future #3 session: 1

> v3 <- value(f3)

> cat(sprintf("Future #3 owner: %s\n", v3))
Future #3 owner: d61f1f9967580b331a8d679fdebb94ee

> stopifnot(v3 == session_uuid)

> message("Creating future #4:")
Creating future #4:

> f4 <- future({
+     f1$owner
+ })

> stopifnot(inherits(f4, "MultisessionFuture"))

> cat(sprintf("Future #4 session: %d\n", f4$node))
Future #4 session: 1

> v4 <- value(f4)

> cat(sprintf("Future #4 owner: %s\n", v4))
Future #4 owner: d61f1f9967580b331a8d679fdebb94ee

> stopifnot(v4 == session_uuid)

> message("Creating future #5:")
Creating future #5:

> f5 <- future({
+     stopifnot(f1$owner != future:::session_uuid(attributes = TRUE))
+     "not-owner"
+ })

> stopifnot(inherits(f5, "MultisessionFuture"))

> v5 <- value(f5)

> stopifnot(v5 == "not-owner")

> message("- Asserting ownership ... DONE")
- Asserting ownership ... DONE

> message("- Trying with invalid ownership ...")
- Trying with invalid ownership ...

> message("Creating future #1:")
Creating future #1:

> f1 <- future({
+     42
+ })

> cat(sprintf("Future #1 session: %d\n", f1$node))
Future #1 session: 1

> stopifnot(identical(f1$owner, session_uuid))

> print(usedNodes(f1))
 used total 
    1     2 

> message("Creating future #2:")
Creating future #2:

> f2 <- future({
+     value(f1)
+ })

> print(f2)
MultisessionFuture:
Label: <unnamed-7>
Expression:
{
    value(f1)
}
Globals: 1 objects totaling 507.71 KiB (MultisessionFuture ‘f1’ of 507.50 KiB)
Packages: 1 packages (‘future’)
L'Ecuyer-CMRG RNG seed: <none> (seed = FALSE)
Capture standard output: TRUE
Capture condition classes: ‘condition’ (excluding ‘<none>’)
Immediate condition classes: ‘immediateCondition’
Lazy evaluation: FALSE
Local evaluation: TRUE
Early signaling: FALSE
Actions: [n=1] ‘run’
State: ‘running’ ("Future is being evaluated")
Resolved: FALSE
Unique identifier: d61f1f9967580b331a8d679fdebb94ee-7
Owner process: d61f1f9967580b331a8d679fdebb94ee
Class: ‘MultisessionFuture’, ‘ClusterFuture’, ‘MultiprocessFuture’, ‘Future’
Value: <not collected>
Conditions captured: <none>

> cat(sprintf("Future #2 session: %d\n", f2$node))
Future #2 session: 2

> stopifnot(identical(f2$owner, session_uuid))

> print(usedNodes(f2))
 used total 
    2     2 

> message("Getting value of future #2:")
Getting value of future #2:

> res <- tryCatch(value(f2), error = identity)

> print(res)
<FutureError: Invalid usage of futures: A future (here ‘MultisessionFuture’) whose value has not yet been collected can only be queried by the R process (d61f1f9967580b331a8d679fdebb94ee; pid 75482 on 38bf771bf2e4) that created it, not by any other R processes (bc21ffa9c1ff830257f8b7798b3c46ed; pid 75535 on 38bf771bf2e4): {; 42L; } [future <unnamed-6> (d61f1f9967580b331a8d679fdebb94ee-6); on bc21ffa9c1ff830257f8b7798b3c46ed@38bf771bf2e4<75535>]>

Occurred on: bc21ffa9c1ff830257f8b7798b3c46ed [38bf771bf2e4; pid 75535]
Future: d61f1f9967580b331a8d679fdebb94ee-6 (<unnamed-6>)

DEBUG: BEGIN TROUBLESHOOTING HELP
MultisessionFuture:
Label: <unnamed-6>
Expression:
{
    42L
}
Globals: <none>
Packages: <none>
L'Ecuyer-CMRG RNG seed: <none> (seed = FALSE)
Capture standard output: TRUE
Capture condition classes: ‘condition’ (excluding ‘<none>’)
Immediate condition classes: ‘immediateCondition’
Lazy evaluation: FALSE
Local evaluation: TRUE
Early signaling: FALSE
Actions: [n=1] ‘run’
State: ‘running’ ("Future is being evaluated")
Resolved: FALSE
Unique identifier: d61f1f9967580b331a8d679fdebb94ee-6
Owner process: d61f1f9967580b331a8d679fdebb94ee
Class: ‘MultisessionFuture’, ‘ClusterFuture’, ‘MultiprocessFuture’, ‘Future’
Value: <not collected>
Conditions captured: <none>
DEBUG: END TROUBLESHOOTING HELP

> stopifnot(inherits(res, "error"))

> v1 <- value(f1)

> print(v1)
[1] 42

> stopifnot(v1 == 42)

> message("- Trying with invalid ownership ... DONE")
- Trying with invalid ownership ... DONE

> message("*** future() - invalid ownership ... DONE")
*** future() - invalid ownership ... DONE
Skipping, because path appears not to be an 'R CMD check' folder: ‘/tmp’
Test time: user.self=0.4s, sys.self=0.02s, elapsed=1s, user.child=0.2s, sys.child=0.3s
Test ‘invalid-owner’ ... success
> 
