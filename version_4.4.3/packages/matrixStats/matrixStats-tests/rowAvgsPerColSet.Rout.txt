
R version 4.4.3 (2025-02-28) -- "Trophy Case"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library("matrixStats")
> 
> X <- matrix(rnorm(20 * 6), nrow = 20, ncol = 6)
> rownames(X) <- LETTERS[1:nrow(X)]
> colnames(X) <- letters[1:ncol(X)]
> print(X)
            a           b           c           d           e            f
A -0.08354487 -0.86680725 -0.52623503 -0.75089263 -1.42429427 -0.308801702
B -1.66346713 -0.12502926 -0.33890467 -0.04082222  0.12230157  0.247379479
C  0.30426381  0.93648233 -0.92632625  0.26305571 -0.43030554  2.246960955
D -1.16371136 -0.35539019 -0.67975387 -1.47287123  2.38750820  0.233253808
E -1.85603731  0.13256910  0.87908387 -0.14584451 -0.75321756  0.537597284
F -0.83578142  0.74530534  1.89988818 -0.16269667 -1.65218629  1.074072895
G -0.43122956  0.17191466  0.37160072 -0.74869658 -0.04207473  1.082966906
H  1.10773027 -0.71631888 -0.14241264 -1.88068624  1.20762886 -0.276872593
I -1.89176824  1.72426103 -0.54649114  0.96043678  3.11308752  0.826592914
J -0.61301385  2.48832044 -0.01858046 -0.43936788 -0.24476253 -0.410774032
K  0.42200560  0.21878234  1.06387134 -0.77447336  0.60397409  0.658916931
L  0.51034669  0.36070528  1.18766103  0.79646465 -0.37383904 -0.147485306
M  1.85073221  1.37089819 -0.25356220 -1.63074357  0.29888214  0.503081110
N -0.52836153 -0.09457103 -1.03321505 -0.43912631  0.84689197  0.704384020
O  1.26224481  0.24322607  1.91630473  0.56386768 -0.79925899  2.488301131
P -0.99714344 -0.63217105  1.28590605  0.68132973 -0.38094505 -0.385243514
Q -0.12726229 -0.98423451 -0.44344766  0.05916653  1.44818266 -0.404413975
R  0.46234265  0.00729850  0.70874277  1.98067925  0.16721084  1.736361006
S  0.35803981 -0.54187770  1.20177667 -0.07265374 -0.32353758  0.003213181
T -1.58995969 -0.67526032  0.32390039  0.21359463 -0.44292490 -0.622596243
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Apply rowMeans() for 3 sets of 2 columns
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 3L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3
[1,]  1  3  5
[2,]  2  4  6
> 
> Z <- rowAvgsPerColSet(X, S = S)
> print(Z)
           s1         s2         s3
A -0.47517606 -0.6385638 -0.8665480
B -0.89424819 -0.1898634  0.1848405
C  0.62037307 -0.3316353  0.9083277
D -0.75955078 -1.0763125  1.3103810
E -0.86173411  0.3666197 -0.1078101
F -0.04523804  0.8685958 -0.2890567
G -0.12965745 -0.1885479  0.5204461
H  0.19570570 -1.0115494  0.4653781
I -0.08375360  0.2069728  1.9698402
J  0.93765329 -0.2289742 -0.3277683
K  0.32039397  0.1446990  0.6314455
L  0.43552598  0.9920628 -0.2606622
M  1.61081520 -0.9421529  0.4009816
N -0.31146628 -0.7361707  0.7756380
O  0.75273544  1.2400862  0.8445211
P -0.81465724  0.9836179 -0.3830943
Q -0.55574840 -0.1921406  0.5218843
R  0.23482057  1.3447110  0.9517859
S -0.09191894  0.5645615 -0.1601622
T -1.13261001  0.2687475 -0.5327606
> 
> # Validation
> Z0 <- cbind(s1 = rowMeans(X[, 1:2]), s2 = rowMeans(X[, 3:4]),
+             s3 = rowMeans(X[, 5:6]))
> stopifnot(identical(drop(Z), Z0))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Apply colMeans() for 5 sets of 4 rows
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 5L
> S <- matrix(1:nrow(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3 s4 s5
[1,]  1  5  9 13 17
[2,]  2  6 10 14 18
[3,]  3  7 11 15 19
[4,]  4  8 12 16 20
> 
> Z <- colAvgsPerRowSet(X, S = S)
> print(Z)
            a           b          c          d            e         f
s1 -0.6516149 -0.10268609 -0.6178050 -0.5003826  0.163802489 0.6046981
s2 -0.5038295  0.08336756  0.7520400 -0.7344810 -0.309962431 0.6044411
s3 -0.3931075  1.19801727  0.4216152  0.1357650  0.774615009 0.2318126
s4  0.3968680  0.22184555  0.4788584 -0.2061681 -0.008607482 0.8276307
s5 -0.2242099 -0.54851851  0.4477430  0.5451967  0.212232755 0.1781410
> 
> # Validation
> Z0 <- rbind(s1 = colMeans(X[1:4, ]), s2 = colMeans(X[5:8, ]),
+             s3 = colMeans(X[9:12, ]), s4 = colMeans(X[13:16, ]),
+             s5 = colMeans(X[17:20, ]))
> stopifnot(identical(drop(Z), Z0))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # When there is only one "complete" set
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 1L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1
[1,]  1
[2,]  2
[3,]  3
[4,]  4
[5,]  5
[6,]  6
> 
> Z <- rowAvgsPerColSet(X, S = S, FUN = rowMeans)
> print(Z)
           s1
A -0.66009596
B -0.29975704
C  0.39902183
D -0.17516077
E -0.20097485
F  0.17810034
G  0.06741357
H -0.11682187
I  0.69768648
J  0.12697028
K  0.36551282
L  0.38897555
M  0.35654798
N -0.09066632
O  0.94578091
P -0.07137788
Q -0.07533487
R  0.84377250
S  0.10416011
T -0.46554102
> 
> Z0 <- rowMeans(X)
> stopifnot(identical(drop(Z), Z0))
> 
> 
> nbr_of_sets <- 1L
> S <- matrix(1:nrow(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
      s1
 [1,]  1
 [2,]  2
 [3,]  3
 [4,]  4
 [5,]  5
 [6,]  6
 [7,]  7
 [8,]  8
 [9,]  9
[10,] 10
[11,] 11
[12,] 12
[13,] 13
[14,] 14
[15,] 15
[16,] 16
[17,] 17
[18,] 18
[19,] 19
[20,] 20
> 
> Z <- colAvgsPerRowSet(X, S = S, FUN = colMeans)
> print(Z)
            a         b         c         d         e         f
s1 -0.2751787 0.1704052 0.2964903 -0.152014 0.1664161 0.4893447
> 
> Z0 <- colMeans(X)
> stopifnot(identical(drop(Z), Z0))
> 
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Use weights
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 3L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3
[1,]  1  3  5
[2,]  2  4  6
> 
> W <- matrix(runif(length(X)), nrow = nrow(X), ncol = ncol(X))
> Z1 <- rowAvgsPerColSet(X, W = W, S = S, FUN = rowWeightedMeans)
> print(Z1)
           s1         s2         s3
A -0.47517606 -0.6385638 -0.8665480
B -0.89424819 -0.1898634  0.1848405
C  0.62037307 -0.3316353  0.9083277
D -0.75955078 -1.0763125  1.3103810
E -0.86173411  0.3666197 -0.1078101
F -0.04523804  0.8685958 -0.2890567
G -0.12965745 -0.1885479  0.5204461
H  0.19570570 -1.0115494  0.4653781
I -0.08375360  0.2069728  1.9698402
J  0.93765329 -0.2289742 -0.3277683
K  0.32039397  0.1446990  0.6314455
L  0.43552598  0.9920628 -0.2606622
M  1.61081520 -0.9421529  0.4009816
N -0.31146628 -0.7361707  0.7756380
O  0.75273544  1.2400862  0.8445211
P -0.81465724  0.9836179 -0.3830943
Q -0.55574840 -0.1921406  0.5218843
R  0.23482057  1.3447110  0.9517859
S -0.09191894  0.5645615 -0.1601622
T -1.13261001  0.2687475 -0.5327606
> Z2 <- colAvgsPerRowSet(X, W = W, S = S, FUN = colWeightedMeans)
> print(Z2)
            a          b          c          d          e           f
s1 -0.8735060 -0.4959183 -0.4325699 -0.3958574 -0.6509964 -0.03071111
s2 -0.4297238  0.2905461 -0.8030401 -0.6049078  0.9786013  1.24010738
s3 -1.3459094  0.4389372  1.3894860 -0.1542706 -1.2027019  0.80583509
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Result should always be a matrix, including when nrow(X) <= 1
> # (https://github.com/HenrikBengtsson/matrixStats/issues/108)
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> X <- matrix(1:3, nrow = 1L, ncol = 3L)
> S <- matrix(1, nrow = 1L, ncol = 1L)
> Z1 <- rowAvgsPerColSet(X, S = S)
> stopifnot(is.matrix(Z1))
> Z2 <- rowAvgsPerColSet(X, S = S, rows = 0)
> stopifnot(is.matrix(Z2))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Works with many, one or zero columns / rows
> # (https://github.com/HenrikBengtsson/matrixStats/issues/172)
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> S <- cbind(1:2, 3:4, 5:6)
> X <- matrix(rnorm(2 * 6), nrow = 6, ncol = 2)
> Z2 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z2_ref <- rbind(colSums2(X[S[,1], ,drop=FALSE]),
+                 colSums2(X[S[,2], ,drop=FALSE]),
+                 colSums2(X[S[,3], ,drop=FALSE]))
> stopifnot(identical(Z2, Z2_ref))
> X <- matrix(rnorm(6), nrow = 6, ncol = 1)
> Z1 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z1_ref <- rbind(colSums2(X[S[,1], ,drop=FALSE]),
+                 colSums2(X[S[,2], ,drop=FALSE]),
+                 colSums2(X[S[,3], ,drop=FALSE]))
> stopifnot(identical(Z1, Z1_ref))
> X <- matrix(numeric(0), nrow = 6, ncol = 0)
> Z0 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z0_ref <- matrix(numeric(0), nrow = ncol(S), ncol = 0)
> stopifnot(identical(Z0, unname(Z0_ref)))
> 
> 
> S <- rbind(1:4, 5:8)
> X <- matrix(rnorm(n = 2 * 8), nrow = 2, ncol = 8)
> Z2 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z2_ref <- cbind(rowMeans2(X[,S[,1],drop=FALSE]),
+                 rowMeans2(X[,S[,2],drop=FALSE]),
+                 rowMeans2(X[,S[,3],drop=FALSE]),
+                 rowMeans2(X[,S[,4],drop=FALSE]))
> stopifnot(identical(Z2, Z2_ref))
> X <- matrix(rnorm(n = 8), nrow = 1, ncol = 8)
> Z1 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z1_ref <- cbind(rowMeans2(X[,S[,1],drop=FALSE]),
+                 rowMeans2(X[,S[,2],drop=FALSE]),
+                 rowMeans2(X[,S[,3],drop=FALSE]),
+                 rowMeans2(X[,S[,4],drop=FALSE]))
> stopifnot(identical(Z1, Z1_ref))
> X <- matrix(numeric(0), nrow = 0, ncol = 8)
> Z0 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z0_ref <- matrix(numeric(0), nrow = 0, ncol = ncol(S))
> stopifnot(identical(Z0, Z0_ref))
> 
