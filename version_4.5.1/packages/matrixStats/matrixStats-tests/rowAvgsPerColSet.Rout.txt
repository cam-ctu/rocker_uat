
R version 4.5.1 (2025-06-13) -- "Great Square Root"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library("matrixStats")
> 
> X <- matrix(rnorm(20 * 6), nrow = 20, ncol = 6)
> rownames(X) <- LETTERS[1:nrow(X)]
> colnames(X) <- letters[1:ncol(X)]
> print(X)
             a           b            c           d           e          f
A -0.258334607  0.68291792  0.694426687 -0.47278286 -0.60867253  0.4358434
B  0.723569725 -0.90859181 -0.376658098  0.36630981 -0.09366749 -1.0475509
C -1.327408802  0.67499634 -1.920052453 -0.67536721 -0.69596942 -0.3738024
D  1.985880204  0.84678570  2.064851639 -0.74478610  0.33204376 -0.2177281
E -1.259437011  1.90203112  1.932952721  1.16371136 -0.94042284 -1.6903884
F -1.141771371 -0.49796952 -1.439166456  1.01478466 -1.56326520 -1.2696783
G  0.649997377  0.14430509  0.236044213  0.09436806 -0.76126136  0.2596465
H -1.581636786 -0.32265703 -1.588232148  0.39645746  0.12905418  1.6216509
I -0.968370869 -0.39812379 -1.014627458  1.18752101 -0.96139555 -0.6794632
J -0.487285537  0.89706813 -0.058794253 -0.35543481  1.37587727 -0.5328912
K -0.899476221 -1.41677879 -2.051983293 -0.79644252  3.33147034 -1.0121600
L -0.005046454 -0.66501409  1.195218601 -1.64833007 -0.60318673 -0.5444906
M  0.745392035  0.40255550  0.301022027 -0.64896225  0.26338280 -1.2671224
N -0.910472751 -0.40679808 -1.465064722  0.03979536 -1.19463701 -0.7844233
O  0.087783839 -0.72632565 -0.001425313 -0.48132579  0.46682609 -1.1960054
P -1.107793791 -0.59384298  1.243975728  1.21694253 -0.60213738 -0.3062489
Q -0.052759709  0.60266439 -0.516482655  1.02209435 -2.35159859  0.5978663
R  0.721360321  0.33499480 -0.273483133 -1.72989704 -0.00728705 -1.9553344
S  0.654976536  0.02965453  0.284802403  0.26436017  2.83293818  0.3185496
T -0.508095020 -0.41108556  0.466809996 -0.09800804 -0.45311477  1.0511041
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Apply rowMeans() for 3 sets of 2 columns
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 3L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3
[1,]  1  3  5
[2,]  2  4  6
> 
> Z <- rowAvgsPerColSet(X, S = S)
> print(Z)
           s1           s2          s3
A  0.21229165  0.110821913 -0.08641456
B -0.09251104 -0.005174144 -0.57060920
C -0.32620623 -1.297709832 -0.53488590
D  1.41633295  0.660032770  0.05715783
E  0.32129706  1.548332040 -1.31540564
F -0.81987045 -0.212190896 -1.41647176
G  0.39715123  0.165206136 -0.25080741
H -0.95214691 -0.595887346  0.87535256
I -0.68324733  0.086446775 -0.82042935
J  0.20489130 -0.207114532  0.42149306
K -1.15812751 -1.424212904  1.15965515
L -0.33503027 -0.226555733 -0.57383869
M  0.57397377 -0.173970111 -0.50186979
N -0.65863541 -0.712634684 -0.98953017
O -0.31927091 -0.241375553 -0.36458968
P -0.85081839  1.230459130 -0.45419314
Q  0.27495234  0.252805846 -0.87686615
R  0.52817756 -1.001690088 -0.98131072
S  0.34231553  0.274581285  1.57574389
T -0.45959029  0.184400977  0.29899467
> 
> # Validation
> Z0 <- cbind(s1 = rowMeans(X[, 1:2]), s2 = rowMeans(X[, 3:4]),
+             s3 = rowMeans(X[, 5:6]))
> stopifnot(identical(drop(Z), Z0))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Apply colMeans() for 5 sets of 4 rows
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 5L
> S <- matrix(1:nrow(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3 s4 s5
[1,]  1  5  9 13 17
[2,]  2  6 10 14 18
[3,]  3  7 11 15 19
[4,]  4  8 12 16 20
> 
> Z <- colAvgsPerRowSet(X, S = S)
> print(Z)
            a          b            c           d            e          f
s1  0.2809266  0.3240270  0.115641944 -0.38165659 -0.266566420 -0.3008095
s2 -0.8332119  0.3064274 -0.214600418  0.66733038 -0.783973803 -0.2696923
s3 -0.5900448 -0.3957121 -0.482546601 -0.40317160  0.785691331 -0.6922512
s4 -0.2962727 -0.3311028  0.019626930  0.03161246 -0.266641374 -0.8884500
s5  0.2038705  0.1390570 -0.009588347 -0.13536264  0.005234444  0.0030464
> 
> # Validation
> Z0 <- rbind(s1 = colMeans(X[1:4, ]), s2 = colMeans(X[5:8, ]),
+             s3 = colMeans(X[9:12, ]), s4 = colMeans(X[13:16, ]),
+             s5 = colMeans(X[17:20, ]))
> stopifnot(identical(drop(Z), Z0))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # When there is only one "complete" set
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 1L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1
[1,]  1
[2,]  2
[3,]  3
[4,]  4
[5,]  5
[6,]  6
> 
> Z <- rowAvgsPerColSet(X, S = S, FUN = rowMeans)
> print(Z)
            s1
A  0.078899668
B -0.222764795
C -0.719600655
D  0.711174516
E  0.184741153
F -0.816177701
G  0.103849987
H -0.224227231
I -0.472409968
J  0.139756608
K -0.474228419
L -0.378474898
M -0.033955379
N -0.786933421
O -0.308412045
P -0.024850801
Q -0.116369321
R -0.484941083
S  0.730880237
T  0.007935119
> 
> Z0 <- rowMeans(X)
> stopifnot(identical(drop(Z), Z0))
> 
> 
> nbr_of_sets <- 1L
> S <- matrix(1:nrow(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
      s1
 [1,]  1
 [2,]  2
 [3,]  3
 [4,]  4
 [5,]  5
 [6,]  6
 [7,]  7
 [8,]  8
 [9,]  9
[10,] 10
[11,] 11
[12,] 12
[13,] 13
[14,] 14
[15,] 15
[16,] 16
[17,] 17
[18,] 18
[19,] 19
[20,] 20
> 
> Z <- colAvgsPerRowSet(X, S = S, FUN = colMeans)
> print(Z)
            a           b          c          d          e          f
s1 -0.2469464 0.008539311 -0.1142933 -0.0442496 -0.1052512 -0.4296313
> 
> Z0 <- colMeans(X)
> stopifnot(identical(drop(Z), Z0))
> 
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Use weights
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> nbr_of_sets <- 3L
> S <- matrix(1:ncol(X), ncol = nbr_of_sets)
> colnames(S) <- sprintf("s%d", 1:nbr_of_sets)
> print(S)
     s1 s2 s3
[1,]  1  3  5
[2,]  2  4  6
> 
> W <- matrix(runif(length(X)), nrow = nrow(X), ncol = ncol(X))
> Z1 <- rowAvgsPerColSet(X, W = W, S = S, FUN = rowWeightedMeans)
> print(Z1)
           s1           s2          s3
A  0.21229165  0.110821913 -0.08641456
B -0.09251104 -0.005174144 -0.57060920
C -0.32620623 -1.297709832 -0.53488590
D  1.41633295  0.660032770  0.05715783
E  0.32129706  1.548332040 -1.31540564
F -0.81987045 -0.212190896 -1.41647176
G  0.39715123  0.165206136 -0.25080741
H -0.95214691 -0.595887346  0.87535256
I -0.68324733  0.086446775 -0.82042935
J  0.20489130 -0.207114532  0.42149306
K -1.15812751 -1.424212904  1.15965515
L -0.33503027 -0.226555733 -0.57383869
M  0.57397377 -0.173970111 -0.50186979
N -0.65863541 -0.712634684 -0.98953017
O -0.31927091 -0.241375553 -0.36458968
P -0.85081839  1.230459130 -0.45419314
Q  0.27495234  0.252805846 -0.87686615
R  0.52817756 -1.001690088 -0.98131072
S  0.34231553  0.274581285  1.57574389
T -0.45959029  0.184400977  0.29899467
> Z2 <- colAvgsPerRowSet(X, W = W, S = S, FUN = colWeightedMeans)
> print(Z2)
            a          b          c           d          e          f
s1  0.2326176 -0.1128369 0.15888429 -0.05323653 -0.3511700 -0.3058538
s2  0.3292357  0.7608910 0.07239959 -0.71007665 -0.1819628 -0.2957652
s3 -1.2006042  0.7020308 0.24689313  1.08924801 -1.2518440 -1.4800334
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Result should always be a matrix, including when nrow(X) <= 1
> # (https://github.com/HenrikBengtsson/matrixStats/issues/108)
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> X <- matrix(1:3, nrow = 1L, ncol = 3L)
> S <- matrix(1, nrow = 1L, ncol = 1L)
> Z1 <- rowAvgsPerColSet(X, S = S)
> stopifnot(is.matrix(Z1))
> Z2 <- rowAvgsPerColSet(X, S = S, rows = 0)
> stopifnot(is.matrix(Z2))
> 
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> # Works with many, one or zero columns / rows
> # (https://github.com/HenrikBengtsson/matrixStats/issues/172)
> # - - - - - - - - - - - - - - - - - - - - - - - - - -
> S <- cbind(1:2, 3:4, 5:6)
> X <- matrix(rnorm(2 * 6), nrow = 6, ncol = 2)
> Z2 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z2_ref <- rbind(colSums2(X[S[,1], ,drop=FALSE]),
+                 colSums2(X[S[,2], ,drop=FALSE]),
+                 colSums2(X[S[,3], ,drop=FALSE]))
> stopifnot(identical(Z2, Z2_ref))
> X <- matrix(rnorm(6), nrow = 6, ncol = 1)
> Z1 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z1_ref <- rbind(colSums2(X[S[,1], ,drop=FALSE]),
+                 colSums2(X[S[,2], ,drop=FALSE]),
+                 colSums2(X[S[,3], ,drop=FALSE]))
> stopifnot(identical(Z1, Z1_ref))
> X <- matrix(numeric(0), nrow = 6, ncol = 0)
> Z0 <- colAvgsPerRowSet(X, S = S, FUN = colSums2)
> Z0_ref <- matrix(numeric(0), nrow = ncol(S), ncol = 0)
> stopifnot(identical(Z0, unname(Z0_ref)))
> 
> 
> S <- rbind(1:4, 5:8)
> X <- matrix(rnorm(n = 2 * 8), nrow = 2, ncol = 8)
> Z2 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z2_ref <- cbind(rowMeans2(X[,S[,1],drop=FALSE]),
+                 rowMeans2(X[,S[,2],drop=FALSE]),
+                 rowMeans2(X[,S[,3],drop=FALSE]),
+                 rowMeans2(X[,S[,4],drop=FALSE]))
> stopifnot(identical(Z2, Z2_ref))
> X <- matrix(rnorm(n = 8), nrow = 1, ncol = 8)
> Z1 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z1_ref <- cbind(rowMeans2(X[,S[,1],drop=FALSE]),
+                 rowMeans2(X[,S[,2],drop=FALSE]),
+                 rowMeans2(X[,S[,3],drop=FALSE]),
+                 rowMeans2(X[,S[,4],drop=FALSE]))
> stopifnot(identical(Z1, Z1_ref))
> X <- matrix(numeric(0), nrow = 0, ncol = 8)
> Z0 <- rowAvgsPerColSet(X, S = S, FUN = rowMeans2)
> Z0_ref <- matrix(numeric(0), nrow = 0, ncol = ncol(S))
> stopifnot(identical(Z0, Z0_ref))
> 
