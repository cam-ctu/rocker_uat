
R version 4.3.3 (2024-02-29) -- "Angel Food Cake"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> require(tensorA)
Loading required package: tensorA

Attaching package: ‘tensorA’

The following object is masked from ‘package:base’:

    norm

> if(FALSE) {
+   # Commands for testing
+   debugger()
+   rm(list=objects())
+   options(error=dump.frames)
+   detach("package:tensorA")
+   dyn.unload("/home/boogaart/R/tensorA/tests/../../tensorA.Rcheck/tensorA/libs/tensorA.so")
+   library(tensorA,lib.loc="../../tensorA.Rcheck")
+ }
> 
> set.seed(23)
> 
> 
> summary.tensor <- function(x,...) {
+   n <- level.tensor(x)
+   d <- dim(x)
+   dm <- pmin(d,1)
+   dm2<- pmin(d,2)
+   print(dim(x))
+   if( !all(sapply(dimnames(x),is.null))) print(dimnames(x))
+   if( prod(dim(x)) < 10 )
+     print(x)
+   else if( n == 1 )
+     print(x[1:min(length(x),10)])
+   else if( n == 2 )
+     print(x[1:dm[1],1:dm[2]])
+   else if( n == 3 )
+     print(x[1:dm[1],1:dm[2],1:dm2[3],drop=FALSE])
+   else if( n == 4 )
+     print(x[1:(dm2[1]),1:dm[1],1,1,drop=FALSE])
+   else if( n == 5 )
+     print(x[1:(dm2[1]),1:dm[1],1,1,1,drop=FALSE])
+   else if( n == 6 )
+     print(x[1:(dm2[1]),1:dm[1],1,1,1,1,drop=FALSE])
+   else
+     print(x[1:min(length(x),10)])
+ }
> 
> checker <- function(x,y) UseMethod("checker")
> 
> checker.default <- function(x,y) {
+     cat("Wrong type\n",deparse(match.call()),"\n---------------y=\n")
+     print(y)
+     cat("\n------------x=\n")
+     print(x)
+     stop("Unkown type")
+ }
> 
> 
> checker.tensor <- function(x,y) {
+   if( !cmp(x,y) ) {
+     cat("Misfit\n",deparse(match.call()),"\n------------------y=\n")
+     print(y)
+     cat("\n-----------------------x=\n")
+     print(x)
+ #    print(summary(x))
+ #    print(summary(y))
+     stop("Missfit");
+   } else {
+     x
+   }
+ }
> 
> print.tensor <- function(x){
+   print.default(unclass(x))
+   print(dim(x))
+ }
> 
> cmp.tensor <- function(x,y) {
+   if(!is.null(names(y))) {
+     mat <- match(names(y),names(x))
+     if( any(is.na(mat)) ) {
+       print(names(y))
+       print(names(x))
+       return(FALSE)
+     }
+     else
+       x <- reorder.tensor(x,mat)
+   }
+   return( length(x)==length(y) && !any(is.na(x)) && 
+          sum(abs(c(x)-c(y))^2)<1E-10 &&
+          length(dim(x))==length(dim(y)) &&
+          !any(is.na(dim(x))) && !any(is.na(dim(y))) &&         
+          all(dim(x)==dim(y)))
+ }
>   
> cmp <- function(x,y) UseMethod("cmp")
> 
> cmp.character <- function(x,y) {
+   return( length(x)==length(y) && all(x==y) )
+ }
> 
> 
> cmp.numeric <- function(x,y){
+   if( length(x) != length(y) )
+     return(FALSE)
+   if(!is.null(names(y))) {
+     if( is.null(names(y)) || !all( names(x) %in% names(y) ) )
+       return(FALSE)
+     if( ! identical(any( x[match(names(y),names(x))]!=y ),FALSE) )
+       return(FALSE)
+     return(TRUE)
+   } else {
+     return(all(x==y))
+   }
+ }
> 
> cmp.default <- function(x,y) identical(x,y)
> 
> checker.numeric <- function(x,y) {
+   if( !cmp(x,y) ) {
+     cat("Misfit\n",deparse(match.call()),"\n-----------------y=\n")
+     print(y)
+     cat("\n-------------------------x=\n")
+     print(x)
+     stop("Missfit");
+   } else print(x)
+ }
> 
> 
> checker.character <- function(x,y) {
+   if( !cmp(x,y) ) {
+     cat("Misfit\n",deparse(match.call()),"\n-----------------y=\n")
+     print(y)
+     cat("\n----------------------------y=\n")
+     print(x)
+     stop("Missfit");
+   } else print(x)
+ }
> 
> checker.list <- function(x,y) {
+   if( length(x) != length(y) || identical(!all(mapply(cmp,x,y)),TRUE) ) {
+     cat("Misfit\n",deparse(match.call()),"\n---------------y=\n")
+     print(y)
+     cat("\n----------------------x=\n")
+     print(x)
+     stop("Missfit");
+   } else print(x)    
+ }
> 
> nn <- function(...,nn=list(...)) {
+   lapply(1:length(nn),function(i) paste(names(nn)[i],1:nn[[i]],sep=""))
+  }
> 
> 
> 
> # to.tensor
> I4 <- diag(4)
> names(dim(I4))<-c("Q","z")
> checker(to.tensor(I4,c(a=2,b=2)),
+         to.tensor(c(diag(4)),c(a=2,b=2,z=4)))
, , 1

      b
a      [,1] [,2]
  [1,]    1    0
  [2,]    0    0

, , 2

      b
a      [,1] [,2]
  [1,]    0    0
  [2,]    1    0

, , 3

      b
a      [,1] [,2]
  [1,]    0    1
  [2,]    0    0

, , 4

      b
a      [,1] [,2]
  [1,]    0    0
  [2,]    0    1

a b z 
2 2 4 
> 
> dimnames(I4) <- nn(Q=4,z=4)
> checker(to.tensor(I4,c(a=2,b=2),nn(a=2,b=2)),
+         to.tensor(c(diag(4)),c(a=2,b=2,z=4),nn(a=2,b=2,z=4)))
, , z = z1

    b
a    b1 b2
  a1  1  0
  a2  0  0

, , z = z2

    b
a    b1 b2
  a1  0  0
  a2  1  0

, , z = z3

    b
a    b1 b2
  a1  0  1
  a2  0  0

, , z = z4

    b
a    b1 b2
  a1  0  0
  a2  0  1

a b z 
2 2 4 
> 
> 
> #
> 
> KT5 <- to.tensor(rnorm(30),c(a=3,b=2,c=5),nn(a=3,b=2,c=5))
> dim(KT5[[c=2]])
a b 
3 2 
> dim(KT5[,,1:2])
a b c 
3 2 2 
> summary(KT5)
a b c 
3 2 5 
$a
[1] "a1" "a2" "a3"

$b
[1] "b1" "b2"

$c
[1] "c1" "c2" "c3" "c4" "c5"

, , 1

      b
a           [,1]
  [1,] 0.1932123

, , 2

      b
a            [,1]
  [1,] -0.2780863

a b c 
1 1 2 
> 
> KT5 <- to.tensor(rnorm(30),c(a=3,b=10,c=1),nn(a=3,b=10,c=1))
> drop(KT5)
    b
a             b1         b2        b3       b4         b5          b6
  a1 -0.55320524 -1.2499273  1.307647 0.232875  0.9459580 -1.62920594
  a2  0.09818141 -0.2021117 -1.342935 1.042257 -0.9856255  0.09231624
  a3 -1.14666586  0.1775003  0.861083 1.329098 -1.2158668 -0.02211742
    b
a            b7         b8         b9       b10
  a1  0.5134779 -0.2384356  1.2208190 0.2772344
  a2 -0.2295536 -1.9978126 -0.8509239 0.9707189
  a3  1.2615159  0.7010760 -0.5636078 0.9526308
 a  b 
 3 10 
> 
> checker(as.tensor(KT5),KT5)
, , c = c1

    b
a             b1         b2        b3       b4         b5          b6
  a1 -0.55320524 -1.2499273  1.307647 0.232875  0.9459580 -1.62920594
  a2  0.09818141 -0.2021117 -1.342935 1.042257 -0.9856255  0.09231624
  a3 -1.14666586  0.1775003  0.861083 1.329098 -1.2158668 -0.02211742
    b
a            b7         b8         b9       b10
  a1  0.5134779 -0.2384356  1.2208190 0.2772344
  a2 -0.2295536 -1.9978126 -0.8509239 0.9707189
  a3  1.2615159  0.7010760 -0.5636078 0.9526308

 a  b  c 
 3 10  1 
> checker(as.tensor.default(KT5),KT5)
, , c = c1

    b
a             b1         b2        b3       b4         b5          b6
  a1 -0.55320524 -1.2499273  1.307647 0.232875  0.9459580 -1.62920594
  a2  0.09818141 -0.2021117 -1.342935 1.042257 -0.9856255  0.09231624
  a3 -1.14666586  0.1775003  0.861083 1.329098 -1.2158668 -0.02211742
    b
a            b7         b8         b9       b10
  a1  0.5134779 -0.2384356  1.2208190 0.2772344
  a2 -0.2295536 -1.9978126 -0.8509239 0.9707189
  a3  1.2615159  0.7010760 -0.5636078 0.9526308

 a  b  c 
 3 10  1 
> checker(to.tensor(KT5),KT5)
, , c = c1

    b
a             b1         b2        b3       b4         b5          b6
  a1 -0.55320524 -1.2499273  1.307647 0.232875  0.9459580 -1.62920594
  a2  0.09818141 -0.2021117 -1.342935 1.042257 -0.9856255  0.09231624
  a3 -1.14666586  0.1775003  0.861083 1.329098 -1.2158668 -0.02211742
    b
a            b7         b8         b9       b10
  a1  0.5134779 -0.2384356  1.2208190 0.2772344
  a2 -0.2295536 -1.9978126 -0.8509239 0.9707189
  a3  1.2615159  0.7010760 -0.5636078 0.9526308

 a  b  c 
 3 10  1 
> 
> # 
> I <- to.tensor(diag(3),c(a=3,b=3),what=1:2)
> checker(to.tensor(I),I)
      b
a      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    0    1    0
  [3,]    0    0    1
a b 
3 3 
> checker(as.tensor(I),I)
      b
a      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    0    1    0
  [3,]    0    0    1
a b 
3 3 
> checker(inv.tensor(I,"a","b"),I)
      b
a      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    0    1    0
  [3,]    0    0    1
a b 
3 3 
> 
> R1  <- matrix(rnorm(9),nrow=3)
> R1i <- solve(R1)
> R2 <- to.tensor(R1,c(a=3,b=3),what=1:2)
> R2i <- to.tensor(R1i,c(b=3,a=3),what=1:2)
> 
> checker(inv.tensor(R2,"a","b"),R2i)
      b
a            [,1]       [,2]       [,3]
  [1,]  0.1790702 -0.8283566 -1.1377162
  [2,] -1.7599098  1.1013333  0.7651271
  [3,] -2.9085503  0.8895587  1.2262476
a b 
3 3 
> checker(inv.tensor(R2,"a","b",allowSingular=TRUE),R2i)
      b
a            [,1]       [,2]       [,3]
  [1,]  0.1790702 -0.8283566 -1.1377162
  [2,] -1.7599098  1.1013333  0.7651271
  [3,] -2.9085503  0.8895587  1.2262476
a b 
3 3 
> 
> checker(inv.tensor(rep(R2,4,1,"K"),"a","b",by="K"),rep(R2i,4,1,"K"))
, , 1

      b
a            [,1]       [,2]       [,3]
  [1,]  0.1790702 -0.8283566 -1.1377162
  [2,] -1.7599098  1.1013333  0.7651271
  [3,] -2.9085503  0.8895587  1.2262476

, , 2

      b
a            [,1]       [,2]       [,3]
  [1,]  0.1790702 -0.8283566 -1.1377162
  [2,] -1.7599098  1.1013333  0.7651271
  [3,] -2.9085503  0.8895587  1.2262476

, , 3

      b
a            [,1]       [,2]       [,3]
  [1,]  0.1790702 -0.8283566 -1.1377162
  [2,] -1.7599098  1.1013333  0.7651271
  [3,] -2.9085503  0.8895587  1.2262476

, , 4

      b
a            [,1]       [,2]       [,3]
  [1,]  0.1790702 -0.8283566 -1.1377162
  [2,] -1.7599098  1.1013333  0.7651271
  [3,] -2.9085503  0.8895587  1.2262476

a b K 
3 3 4 
> checker(inv.tensor(rep(R2,4,1,"K"),"a","b",by="K",allowSingular=TRUE),rep(R2i,4,3,"K"))
, , 1

      b
a            [,1]       [,2]       [,3]
  [1,]  0.1790702 -0.8283566 -1.1377162
  [2,] -1.7599098  1.1013333  0.7651271
  [3,] -2.9085503  0.8895587  1.2262476

, , 2

      b
a            [,1]       [,2]       [,3]
  [1,]  0.1790702 -0.8283566 -1.1377162
  [2,] -1.7599098  1.1013333  0.7651271
  [3,] -2.9085503  0.8895587  1.2262476

, , 3

      b
a            [,1]       [,2]       [,3]
  [1,]  0.1790702 -0.8283566 -1.1377162
  [2,] -1.7599098  1.1013333  0.7651271
  [3,] -2.9085503  0.8895587  1.2262476

, , 4

      b
a            [,1]       [,2]       [,3]
  [1,]  0.1790702 -0.8283566 -1.1377162
  [2,] -1.7599098  1.1013333  0.7651271
  [3,] -2.9085503  0.8895587  1.2262476

a b K 
3 3 4 
> 
> R3 <- to.tensor(rnorm(15),c(a=3,z=5))
> 
> checker(mul.tensor(R2i,"b",mul.tensor(R2,"a",R3)),R3)
      z
a            [,1]         [,2]      [,3]        [,4]      [,5]
  [1,] -1.2133785 -0.132575713  0.433409 -1.37265139 0.6287441
  [2,]  0.7260075  1.031495770  1.287369 -0.47939998 1.9760633
  [3,] -0.4299248  0.006971394 -2.418264  0.01101352 0.4615582
a z 
3 5 
> 
> checker(solve.tensor(R2i,R3[[z=1]],"a"),mul.tensor(R2,"a",R3[[z=1]]))
[1]  0.6378107  1.7559384 -0.1115847
b 
3 
> checker(solve.tensor(R2i,R3,"a"),mul.tensor(R2,"a",R3))
      z
b            [,1]        [,2]       [,3]       [,4]       [,5]
  [1,]  0.6378107  0.04780378  0.7124511  0.5418899 -0.4232775
  [2,]  1.7559384  1.87543054  5.0470798 -0.9446036  3.1326266
  [3,] -0.1115847 -1.24142507 -3.9435252  1.9795415 -2.9000840
b z 
3 5 
> 
> checker(solve.tensor(R2i,R3[[z=1]],"a",allowSingular=TRUE),mul.tensor(R2,"a",R3[[z=1]]))
[1]  0.6378107  1.7559384 -0.1115847
b 
3 
> checker(solve.tensor(R2i,R3,"a",allowSingular=T),mul.tensor(R2,"a",R3))
      z
b            [,1]        [,2]       [,3]       [,4]       [,5]
  [1,]  0.6378107  0.04780378  0.7124511  0.5418899 -0.4232775
  [2,]  1.7559384  1.87543054  5.0470798 -0.9446036  3.1326266
  [3,] -0.1115847 -1.24142507 -3.9435252  1.9795415 -2.9000840
b z 
3 5 
> 
> checker(solve.tensor(rep(R2i,4,1,"K"),R3[[z=1]],"a",by="K"),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b            [,1]       [,2]       [,3]       [,4]
  [1,]  0.6378107  0.6378107  0.6378107  0.6378107
  [2,]  1.7559384  1.7559384  1.7559384  1.7559384
  [3,] -0.1115847 -0.1115847 -0.1115847 -0.1115847
b K 
3 4 
> checker(solve.tensor(rep(R2i,4,1,"K"),rep(R3[[z=1]],4,1,"K"),"a",by="K"),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b            [,1]       [,2]       [,3]       [,4]
  [1,]  0.6378107  0.6378107  0.6378107  0.6378107
  [2,]  1.7559384  1.7559384  1.7559384  1.7559384
  [3,] -0.1115847 -0.1115847 -0.1115847 -0.1115847
b K 
3 4 
> checker(solve.tensor(R2i,rep(R3[[z=1]],4,1,"K"),"a",by="K"),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b            [,1]       [,2]       [,3]       [,4]
  [1,]  0.6378107  0.6378107  0.6378107  0.6378107
  [2,]  1.7559384  1.7559384  1.7559384  1.7559384
  [3,] -0.1115847 -0.1115847 -0.1115847 -0.1115847
b K 
3 4 
> 
> checker(solve.tensor(rep(R2i,4,1,"K"),R3[[z=1]],"a",by="K",allowSingular=TRUE),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b            [,1]       [,2]       [,3]       [,4]
  [1,]  0.6378107  0.6378107  0.6378107  0.6378107
  [2,]  1.7559384  1.7559384  1.7559384  1.7559384
  [3,] -0.1115847 -0.1115847 -0.1115847 -0.1115847
b K 
3 4 
> checker(solve.tensor(rep(R2i,4,1,"K"),rep(R3[[z=1]],4,1,"K"),"a",by="K",allowSingular=TRUE),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b            [,1]       [,2]       [,3]       [,4]
  [1,]  0.6378107  0.6378107  0.6378107  0.6378107
  [2,]  1.7559384  1.7559384  1.7559384  1.7559384
  [3,] -0.1115847 -0.1115847 -0.1115847 -0.1115847
b K 
3 4 
> checker(solve.tensor(R2i,rep(R3[[z=1]],4,1,"K"),"a",by="K",allowSingular=TRUE),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b            [,1]       [,2]       [,3]       [,4]
  [1,]  0.6378107  0.6378107  0.6378107  0.6378107
  [2,]  1.7559384  1.7559384  1.7559384  1.7559384
  [3,] -0.1115847 -0.1115847 -0.1115847 -0.1115847
b K 
3 4 
> 
> 
> 
> checker(solve.tensor(R2i,R3,"a"),mul.tensor(R2,"a",R3))
      z
b            [,1]        [,2]       [,3]       [,4]       [,5]
  [1,]  0.6378107  0.04780378  0.7124511  0.5418899 -0.4232775
  [2,]  1.7559384  1.87543054  5.0470798 -0.9446036  3.1326266
  [3,] -0.1115847 -1.24142507 -3.9435252  1.9795415 -2.9000840
b z 
3 5 
> 
> checker(solve.tensor(R2i,R3[[z=1]],"a",allowSingular=TRUE),mul.tensor(R2,"a",R3[[z=1]]))
[1]  0.6378107  1.7559384 -0.1115847
b 
3 
> checker(solve.tensor(R2i,R3,"a",allowSingular=TRUE),mul.tensor(R2,"a",R3))
      z
b            [,1]        [,2]       [,3]       [,4]       [,5]
  [1,]  0.6378107  0.04780378  0.7124511  0.5418899 -0.4232775
  [2,]  1.7559384  1.87543054  5.0470798 -0.9446036  3.1326266
  [3,] -0.1115847 -1.24142507 -3.9435252  1.9795415 -2.9000840
b z 
3 5 
> 
> 
> 
> summary(I)
a b 
3 3 
      b
a      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    0    1    0
  [3,]    0    0    1
a b 
3 3 
> 
> 
> A <- to.tensor(c(diag(3)),c(a=3,b=3))
> 
> A <- to.tensor(c(1,1,1,0,1,1,0,0,1),c(a=3,b=3))
> checker(mul.tensor(A,"b",A,"a"),to.tensor(c(A%*%A),c(a=3,b=3)))
      b
a      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    2    1    0
  [3,]    3    2    1
a b 
3 3 
> 
> A <- to.tensor(c(1,1,1,1,0,1,1,1,0,0,1,1),c(a=4,b=3))
> checker(mul.tensor(A,"b",A[[a=~c]],"b"),to.tensor(c(A%*%t(A)),c(a=4,c=4)))
      c
a      [,1] [,2] [,3] [,4]
  [1,]    1    1    1    1
  [2,]    1    2    2    2
  [3,]    1    2    3    3
  [4,]    1    2    3    3
a c 
4 4 
> 
> A <- to.tensor(rnorm(15),c(a=5,b=3))
> checker(mul.tensor(A,"b",A[[a=~c]],"b"),to.tensor(c(A%*%t(A)),dim=c(a=5,c=5)))
      c
a             [,1]      [,2]       [,3]       [,4]        [,5]
  [1,]  0.48487946 -1.171859 -1.0356860 -0.8487449 -0.04082473
  [2,] -1.17185878  6.672876  2.5656107  1.8814479 -1.36931153
  [3,] -1.03568604  2.565611  3.4759517  2.4724216  0.65587837
  [4,] -0.84874495  1.881448  2.4724216  1.8405402  0.44716941
  [5,] -0.04082473 -1.369312  0.6558784  0.4471694  0.84261320
a c 
5 5 
> 
> A <- to.tensor(rnorm(5*3),c(a=5,b=3))
> B <- to.tensor(rnorm(3*17),c(a=3,b=17))
> checker(mul.tensor(A,"b",B,"a"),to.tensor(c(A%*%B),c(a=5,b=17)))
      b
a            [,1]       [,2]       [,3]        [,4]       [,5]       [,6]
  [1,]  0.2835968 -0.6288554 -1.1024355  0.34856397  0.7732376 0.06690123
  [2,]  0.2026823 -0.3879932 -0.6227903  0.04338919  0.6774254 0.10935856
  [3,]  0.8389679 -0.9282417 -0.9003466 -1.76728639  3.7279537 1.04534942
  [4,] -0.2028007  1.6904408  2.8639388 -1.57998143 -1.9972133 0.43989420
  [5,]  1.0439324 -0.5872734 -1.1593335 -0.58953212  0.8631121 0.93065646
      b
a            [,7]       [,8]       [,9]       [,10]      [,11]       [,12]
  [1,]  1.1430151 -0.2139775 -1.9005751  0.04059520 -0.7037960 -0.01597474
  [2,]  0.5909542  0.1549058 -1.0788930  0.18128784 -0.3796445  0.06428319
  [3,]  0.3194522  3.2890280 -1.5114695  2.06223555 -0.4077643  1.16668904
  [4,] -2.1780750 -0.1786617  5.8810175 -0.17532620  1.2696101  2.11348215
  [5,]  2.2904873 -1.2036569 -0.6921025 -0.03172413 -1.5116327  2.86401892
      b
a          [,13]      [,14]      [,15]      [,16]      [,17]
  [1,]  2.650703 -1.2018365  1.0259026 -0.1639387 -0.6384908
  [2,]  1.236705 -0.5348833  0.1616677 -0.1887906 -0.3516245
  [3,] -1.102975  0.7174578 -4.6073088 -1.2212888 -0.2583766
  [4,] -6.130545  1.7723834 -3.2732726  1.7373403  2.9397765
  [5,]  3.797352 -3.1134537  0.1772836  1.6308589  1.1046150
 a  b 
 5 17 
> 
> A <- to.tensor(c(1,1,1,0,1,1,0,0,1),c(a=3,b=3))
> 
> # 
> A <- to.tensor(c(1,1,1,0,1,1,0,0,1),c(a=3,b=3))
> 
> solve.tensor(mul.tensor(I,"b",I,"a"),I,"a","a")
      b
b      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    0    1    0
  [3,]    0    0    1
b b 
3 3 
Warning message:
In to.tensor.default(c(EE), d, dn) :
  Tensor with duplicated names generated: b  b  
> checker(solve.tensor(mul.tensor(I,"b",I,"a"),I,"a","b"),I)
      a
b      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    0    1    0
  [3,]    0    0    1
b a 
3 3 
> mul.tensor(A,"b",I,"a")
      b
a      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    1    1    0
  [3,]    1    1    1
a b 
3 3 
> 
> 
> checker(solve.tensor(mul.tensor(A,"b",I[[a=~c]],"b"),A,"a","a",allowSingular=TRUE),I[[a=~c]])
      b
c               [,1]          [,2]          [,3]
  [1,]  1.000000e+00 -5.968098e-16 -3.113422e-16
  [2,] -3.874801e-16  1.000000e+00  2.729156e-16
  [3,]  2.701400e-16 -1.218861e-16  1.000000e+00
c b 
3 3 
> 
> B <- A[[b=~z]]
> checker(solve.tensor(B,mul.tensor(A,"a",B,"a"),"z","z",allowSingular=TRUE),A)
      b
a      [,1]          [,2]          [,3]
  [1,]    1 -6.137461e-16 -1.231722e-16
  [2,]    1  1.000000e+00 -2.820826e-16
  [3,]    1  1.000000e+00  1.000000e+00
a b 
3 3 
> checker(solve.tensor(B,mul.tensor(A,"a",B,"a"),"z","z",allowSingular=TRUE),
+         solve.tensor(B,mul.tensor(A,"a",B,"a"),"z","z"))
      b
a      [,1]          [,2]          [,3]
  [1,]    1 -6.137461e-16 -1.231722e-16
  [2,]    1  1.000000e+00 -2.820826e-16
  [3,]    1  1.000000e+00  1.000000e+00
a b 
3 3 
> 
> 
> 
> solve.tensor(mul.tensor(A,"b",A,"a"),A,"a","a")
      b
b               [,1] [,2] [,3]
  [1,]  1.000000e+00    0    0
  [2,] -1.000000e+00    1    0
  [3,] -2.220446e-16   -1    1
b b 
3 3 
Warning message:
In to.tensor.default(c(EE), d, dn) :
  Tensor with duplicated names generated: b  b  
> checker(solve.tensor(A[[b=~c]],mul.tensor(A,"b",A,"a"),"a","a"),structure(A,dim=c(c=3,b=3)))
      b
c      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    1    1    0
  [3,]    1    1    1
c b 
3 3 
> 
> A <-  to.tensor(c(1,1,1,1,0,1,1,1,0,0,1,1),c(a=4,b=3))
> A
      b
a      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    1    1    0
  [3,]    1    1    1
  [4,]    1    1    1
a b 
4 3 
> solve.tensor(A[[b=~c]],mul.tensor(A,"a",A[[b=~c]],"a"),"c",allowSingular=TRUE)
      b
a      [,1]          [,2]          [,3]
  [1,]    1 -8.998892e-17  3.159010e-16
  [2,]    1  1.000000e+00 -6.723015e-16
  [3,]    1  1.000000e+00  1.000000e+00
  [4,]    1  1.000000e+00  1.000000e+00
a b 
4 3 
> 
> 
> A <- to.tensor(rnorm(100),c(a=4,b=5,c=5))
> An <- to.tensor(rnorm(100),c(a=4,b=5,c=5),nn(a=4,b=5,c=5))
> B <- to.tensor(rnorm(100),c(d=4,e=5,f=5))
> An <- to.tensor(rnorm(100),c(a=4,b=5,c=5),nn(a=4,b=5,c=5))
> 
> mt <- mul.tensor(A,2,B,2)
> 
> 
> checker(einstein.tensor(A,b="e",B),mt)
, , 1, 1

      c
a            [,1]       [,2]       [,3]       [,4]       [,5]
  [1,] -0.1664657 -0.1735138  2.3682379 -2.6535748  0.6952208
  [2,]  0.1878986  1.4201223 -0.3116057 -1.2314339  1.0757362
  [3,] -2.0654260  1.2974278 -3.6173748 -1.8801222  1.0207638
  [4,]  0.4222110 -0.8526971  1.1852001 -0.4587169 -3.2184737

, , 2, 1

      c
a            [,1]       [,2]      [,3]       [,4]       [,5]
  [1,]  0.5453903 -1.2677778 -3.283028 3.41019974  1.4738566
  [2,] -0.4228667 -1.1547859 -0.163464 1.35697325 -1.5296280
  [3,]  2.4056515 -2.3296849  4.644448 0.74494857 -0.7015917
  [4,] -0.1622752 -0.2054522 -2.067285 0.07094618  4.2873073

, , 3, 1

      c
a            [,1]       [,2]       [,3]       [,4]        [,5]
  [1,] 0.42766435  0.2668229  1.2271464 -0.4923342 -1.65600199
  [2,] 0.57245033 -2.3972655 -0.3071815  1.5180733  1.87808719
  [3,] 0.09451645  0.4058412  1.9612444  0.9121079  0.05551148
  [4,] 1.47091586  1.2086438 -0.3562725 -0.9890887  1.47934187

, , 4, 1

      c
a             [,1]       [,2]       [,3]        [,4]       [,5]
  [1,]  0.18255527 -3.0856221 -0.3259953 -0.80431148  2.8727222
  [2,]  0.27027986  0.9022521 -2.9553908 -1.69940438 -0.1486697
  [3,] -1.49688857  0.3645903  0.2920817 -2.18856301  1.2837658
  [4,]  0.08028232 -2.0728055 -1.5449607 -0.06859168 -0.4309841

, , 1, 2

      c
a             [,1]       [,2]      [,3]      [,4]       [,5]
  [1,] -0.80194414 -1.6019015 -4.390016  2.582822 -0.1903908
  [2,]  0.07491603  0.5878298 -3.023182 -2.441964 -3.3109145
  [3,]  0.54768043  0.1791293  3.119206  1.886438 -0.7203625
  [4,] -2.97704754 -0.4543580 -2.469483  2.867940  1.4728528

, , 2, 2

      c
a            [,1]       [,2]      [,3]        [,4]       [,5]
  [1,] -0.8643788 3.54827654  3.080732 -2.65027492 -3.6787826
  [2,]  0.2884080 0.01978188  1.518399 -0.08927177  1.7754215
  [3,] -1.9732367 1.57114103 -4.102635  0.35939157 -0.2937039
  [4,]  0.2801674 2.00183340  2.764711 -0.27869770 -3.1742487

, , 3, 2

      c
a            [,1]       [,2]       [,3]       [,4]      [,5]
  [1,] -1.0857870  1.4848715 -5.3810152  4.4854287 -1.453426
  [2,] -0.7347261  0.1342419  0.1160822 -0.4267855 -3.854403
  [3,]  1.8750741 -2.1446809  3.1590033  2.4610896 -2.207166
  [4,] -2.9813032  1.2605735 -1.1710965  2.3904060  3.092980

, , 4, 2

      c
a           [,1]       [,2]       [,3]       [,4]       [,5]
  [1,] 0.6814001  0.7437529  0.1168068  1.2188632 -4.0934878
  [2,] 0.8986125 -4.7282941 -0.1623813  2.8877948  1.7805501
  [3,] 2.1545808  0.5596389  5.6793266  4.1263506 -0.8701873
  [4,] 1.3336990  2.7558654 -1.3425689 -0.3964775  4.1603521

, , 1, 3

      c
a            [,1]       [,2]       [,3]        [,4]       [,5]
  [1,] -1.1298375  3.7121590  0.3611709 -0.36881615 -0.2529230
  [2,] -1.0023713  1.9343343  2.6942489  0.07536266 -0.3350522
  [3,] -1.7758344 -2.0293572 -4.5982260 -2.48505484 -0.8026001
  [4,] -0.2670123  0.9164454  2.7893490 -0.74991283 -1.8554237

, , 2, 3

      c
a              [,1]        [,2]      [,3]       [,4]        [,5]
  [1,]  0.002837336 -2.55260672 -2.573010  1.4495271 -0.24307180
  [2,]  0.760882805 -2.14358794 -4.307825 -0.6445793 -0.47135521
  [3,] -0.248412577  0.09178334  5.492015  0.9810619  0.08362357
  [4,] -0.318557031  0.04459940 -3.388131  0.7062858  3.47306415

, , 3, 3

      c
a             [,1]       [,2]      [,3]       [,4]         [,5]
  [1,] -0.68699037 -0.7064901 -2.256882  0.8804852 0.9906013030
  [2,]  0.06042483 -1.1112301 -3.505533 -0.3678321 0.0004223756
  [3,] -2.72481282 -2.3358606  2.758863 -2.8373974 0.0188836499
  [4,]  0.49528627  0.2678766 -1.995772 -0.9753823 3.0287661438

, , 4, 3

      c
a            [,1]      [,2]       [,3]      [,4]       [,5]
  [1,] -2.1462027 1.1947097 -0.3519896 -2.056299 -2.2536148
  [2,]  0.4653544 1.9211348 -3.3894111 -4.159688 -0.8994992
  [3,] -4.5377897 1.8608204 -3.4156905 -1.004905  0.0114212
  [4,] -2.3324408 0.4955766  0.4775765  1.902725 -3.6100607

, , 1, 4

      c
a           [,1]       [,2]       [,3]       [,4]     [,5]
  [1,] 3.0007923 -2.7838243  3.4331984 -0.4828151 3.050809
  [2,] 0.1365672 -2.0323261  3.0790273  4.1597130 2.919147
  [3,] 4.1357732  0.1521197  2.1006591  0.5084960 1.392836
  [4,] 3.7732825 -1.5347227 -0.1726469 -2.7657212 1.679192

, , 2, 4

      c
a           [,1]       [,2]       [,3]        [,4]      [,5]
  [1,] 1.5865539 -0.4013158  2.0861046 -0.08309915 0.3403820
  [2,] 0.2393429 -3.0420864  1.5448143  3.72384958 2.8501549
  [3,] 1.7067734 -0.8804551  2.7405953  0.10713702 0.4017382
  [4,] 3.2372827  0.6094085 -0.2456709 -2.66173712 2.8587858

, , 3, 4

      c
a            [,1]      [,2]      [,3]       [,4]       [,5]
  [1,]  1.1764475  1.191738  2.595306 -0.5794752  4.1938603
  [2,] -1.3157299  1.033681  4.951112  3.3807109  1.8351776
  [3,]  0.5467456 -3.509342 -3.475947 -4.5163108  0.5493495
  [4,]  3.1673997 -1.006108  2.593863 -3.8350295 -0.1394232

, , 4, 4

      c
a           [,1]      [,2]      [,3]       [,4]       [,5]
  [1,] -1.699248  3.052134 -1.382195  0.5262189 -8.4136596
  [2,]  1.297020 -2.970095 -2.455244 -1.2366065 -0.3989992
  [3,] -0.549665  2.985687  3.044206  6.0612430 -1.8853647
  [4,] -2.417202  4.199904 -0.695813  3.0512333  0.8168829

, , 1, 5

      c
a            [,1]      [,2]       [,3]      [,4]        [,5]
  [1,] -1.9523992 1.7001105 -3.7568711  1.874232 -4.56323930
  [2,]  0.3411858 0.1426824 -2.3987577 -2.872542 -3.08097225
  [3,] -0.4574765 1.3578968  1.5336655  3.827166 -1.76109449
  [4,] -3.9466844 1.9374514 -0.9600955  3.822500  0.08426608

, , 2, 5

      c
a            [,1]       [,2]        [,3]       [,4]       [,5]
  [1,] -0.4884867  0.2715609 -3.76991562  3.0922066  2.7085028
  [2,] -1.3027509  2.0748355  1.08167715 -0.3181959 -3.1210841
  [3,]  0.8950942 -3.2827972  0.09681537 -1.5292215 -0.9519058
  [4,] -1.5770076 -0.8929450 -0.26033938  0.5836015  1.4617001

, , 3, 5

      c
a            [,1]       [,2]      [,3]       [,4]       [,5]
  [1,] -0.8172528  0.3459001 -0.426368 -0.4419827 -5.6346489
  [2,]  1.6239619 -3.6899878 -4.293140 -0.8050815  1.1326296
  [3,] -1.4484553  2.6387717  4.356360  3.6643178 -0.5062724
  [4,] -0.5038483  2.7509440 -2.018184  1.3582959  1.8074412

, , 4, 5

      c
a            [,1]      [,2]       [,3]      [,4]       [,5]
  [1,] -1.4312235 -3.417183 -7.7603495  4.154755  5.4150506
  [2,] -1.2891194  5.312822 -3.4375819 -5.215400 -7.0956976
  [3,] -0.2138048 -2.249400  0.4036211 -2.051051 -0.4447401
  [4,] -5.2062100 -3.719768 -2.7716127  3.879017  0.0698682

a c d f 
4 5 4 5 
> 
> 
> G <- to.tensor(rnorm(20*20*3),c(a=4,b=5,a1=4,b1=5,I=3))
> mul.tensor(A,c("a","b"),G,c("a","b"))
, , 1, 1

      a1
c            [,1]      [,2]       [,3]       [,4]
  [1,] -4.9160721 -1.723116  3.1344688  2.3590173
  [2,]  1.5210764  1.926843 -0.2071013  1.5865098
  [3,]  1.4196044 -6.785355  3.1785261 -0.8568046
  [4,] -0.8708781 -2.585428 -6.2388113 -3.2546285
  [5,] -5.2566360 -2.184446 -1.9477836 -1.8105832

, , 2, 1

      a1
c             [,1]      [,2]      [,3]      [,4]
  [1,] -1.01294063  0.481706 -1.282652  1.618568
  [2,] -3.31353456  4.836402 -4.430307 -1.707034
  [3,] -1.82680096  3.415630 -6.897968  5.301271
  [4,]  0.03703797  1.215010 -1.978326  3.908937
  [5,]  0.30849625 -6.146003  3.245114 -4.837900

, , 3, 1

      a1
c           [,1]        [,2]      [,3]        [,4]
  [1,] -4.700143  2.74125048 -4.365630  2.90847464
  [2,] -3.320153  4.33641319 -2.280506  4.05000108
  [3,] -7.206831 -2.55037470 -1.002285  4.17916989
  [4,] -5.348353  4.19974883  2.569026  0.09905949
  [5,] -3.691877 -0.01453547 -4.061927 -3.88339643

, , 4, 1

      a1
c           [,1]      [,2]       [,3]      [,4]
  [1,] 1.7392852 -5.001167 -2.2350489  4.257032
  [2,] 0.1181369  3.057290 -4.1693774 -4.584761
  [3,] 3.4983241  4.535508 -8.5922870  3.228034
  [4,] 3.4707759  4.995333  5.9143055 -1.567897
  [5,] 1.7255907 -4.703328 -0.7070128 -1.266183

, , 5, 1

      a1
c            [,1]       [,2]      [,3]       [,4]
  [1,]  0.7507208  0.1441032 -1.475236  4.8025327
  [2,]  0.4468442  2.1466639 -3.260027 -6.1556623
  [3,] -5.9376256  7.4312306 -6.731992 -2.4167834
  [4,] -0.9061706  6.7962766 -4.357772  0.1934279
  [5,]  4.7216772 -1.4221077 -3.067015  6.4601642

, , 1, 2

      a1
c            [,1]       [,2]       [,3]       [,4]
  [1,] -4.7717774 -1.0494534  2.2896404  0.3092118
  [2,]  3.8397016 -0.1127951 -0.8335418 -6.3967417
  [3,] -0.8100704 -4.2972564  1.1073823  4.6080585
  [4,]  3.4766291  1.3770775  1.6511925  2.6574728
  [5,] -2.7626556  4.9611957  4.7837919  0.8523948

, , 2, 2

      a1
c            [,1]      [,2]        [,3]       [,4]
  [1,]  5.1069172  3.441578  1.36410161 -1.2914202
  [2,] -0.5080645  1.760376 -4.87917619 -0.6830125
  [3,]  7.7449907  7.015620  0.90922501 -4.2703954
  [4,] -5.2977927 -9.397718  0.08209162 -1.6213990
  [5,] -6.4533850 -1.356973 -7.99994560 -4.1932487

, , 3, 2

      a1
c            [,1]        [,2]       [,3]       [,4]
  [1,] -2.1180089 -1.56157657 -3.0444540  4.2419811
  [2,]  2.9981322 -0.03294657  2.2035226  0.2996967
  [3,]  1.5836696 -2.21068021 -7.7859515  2.6942964
  [4,] -0.1582774 -0.87203400  0.7638035 -3.7604290
  [5,]  1.3188926 -2.06083892  2.5351664 -2.7974677

, , 4, 2

      a1
c            [,1]      [,2]      [,3]       [,4]
  [1,]  2.4736368  2.066592  2.183554  3.7139112
  [2,] -0.8914545 -5.822417 -4.559295  0.4679584
  [3,]  0.4946849 -1.972233 -6.448038 -0.9158920
  [4,]  1.2484854 -5.451237  2.068878 -5.9095896
  [5,]  5.8790355  6.998398  2.950649 -2.9567472

, , 5, 2

      a1
c            [,1]      [,2]      [,3]      [,4]
  [1,]  1.7962685  3.245443 -3.766613  1.349804
  [2,] -4.4878560  8.978860  4.920742 -1.087291
  [3,] -3.2783405 -3.926046  2.485509 -7.064981
  [4,]  0.4119418  3.988261 -3.722817  1.768493
  [5,] -1.4537835  6.484509 -5.459598  3.736263

, , 1, 3

      a1
c           [,1]        [,2]       [,3]      [,4]
  [1,] -3.635395 -0.06259169 -1.1735570 0.2423941
  [2,]  1.423165 -7.43245512 -0.6383191 4.4453820
  [3,] -1.665444 12.31114805  9.6365427 7.2993935
  [4,] -1.463782 -2.17594642  1.9621656 0.6039105
  [5,]  2.714725  6.71116834 -1.7466223 4.3896150

, , 2, 3

      a1
c           [,1]       [,2]      [,3]      [,4]
  [1,] -1.795694 -5.2264583  1.012156 -3.549915
  [2,] -2.967193  1.8139114  6.061017  5.878039
  [3,] -4.677186 -0.4598026  1.701504 -4.065478
  [4,] -6.980607  5.1463264 -1.353597 -2.251123
  [5,]  2.980398 -1.8570672  4.114319 -4.473137

, , 3, 3

      a1
c           [,1]       [,2]      [,3]      [,4]
  [1,] -3.984483 -5.1501280 -2.256806 -1.702531
  [2,]  1.140526 -1.4480626 -4.329763  6.968992
  [3,] -4.562724 -0.5055382  6.449451  3.054127
  [4,]  7.246401  2.6268994 -2.994583  1.515928
  [5,]  5.080812 -7.7338589 -5.677535 -2.415891

, , 4, 3

      a1
c            [,1]      [,2]      [,3]       [,4]
  [1,]  0.3559434  2.606566  4.020425 -1.5594805
  [2,] -2.7415992 -6.098343 -7.192729  5.3145753
  [3,] -1.6320014  3.789132 -1.993286  9.8074484
  [4,] -4.0828060  1.382317 -6.610842  0.2613842
  [5,] -3.0323068  5.376626 -6.334314 -8.6589163

, , 5, 3

      a1
c            [,1]        [,2]        [,3]       [,4]
  [1,]  0.9203480  2.04598302  -0.6174551  2.0158551
  [2,]  4.9986726  3.00100208  -4.8412744 -0.6807395
  [3,]  7.4715170 -2.01476935 -11.4160423 -2.3368010
  [4,] -0.5567231  0.04055137  -0.5709127 -5.3202880
  [5,] -8.2461295 -1.79988534  -9.6717668  1.4865820

 c a1 b1  I 
 5  4  5  3 
> 
> 
> 
> checker(einstein.tensor(A,G),einstein.tensor(G,A))
, , 1, 1

      a1
c            [,1]      [,2]       [,3]       [,4]
  [1,] -4.9160721 -1.723116  3.1344688  2.3590173
  [2,]  1.5210764  1.926843 -0.2071013  1.5865098
  [3,]  1.4196044 -6.785355  3.1785261 -0.8568046
  [4,] -0.8708781 -2.585428 -6.2388113 -3.2546285
  [5,] -5.2566360 -2.184446 -1.9477836 -1.8105832

, , 2, 1

      a1
c             [,1]      [,2]      [,3]      [,4]
  [1,] -1.01294063  0.481706 -1.282652  1.618568
  [2,] -3.31353456  4.836402 -4.430307 -1.707034
  [3,] -1.82680096  3.415630 -6.897968  5.301271
  [4,]  0.03703797  1.215010 -1.978326  3.908937
  [5,]  0.30849625 -6.146003  3.245114 -4.837900

, , 3, 1

      a1
c           [,1]        [,2]      [,3]        [,4]
  [1,] -4.700143  2.74125048 -4.365630  2.90847464
  [2,] -3.320153  4.33641319 -2.280506  4.05000108
  [3,] -7.206831 -2.55037470 -1.002285  4.17916989
  [4,] -5.348353  4.19974883  2.569026  0.09905949
  [5,] -3.691877 -0.01453547 -4.061927 -3.88339643

, , 4, 1

      a1
c           [,1]      [,2]       [,3]      [,4]
  [1,] 1.7392852 -5.001167 -2.2350489  4.257032
  [2,] 0.1181369  3.057290 -4.1693774 -4.584761
  [3,] 3.4983241  4.535508 -8.5922870  3.228034
  [4,] 3.4707759  4.995333  5.9143055 -1.567897
  [5,] 1.7255907 -4.703328 -0.7070128 -1.266183

, , 5, 1

      a1
c            [,1]       [,2]      [,3]       [,4]
  [1,]  0.7507208  0.1441032 -1.475236  4.8025327
  [2,]  0.4468442  2.1466639 -3.260027 -6.1556623
  [3,] -5.9376256  7.4312306 -6.731992 -2.4167834
  [4,] -0.9061706  6.7962766 -4.357772  0.1934279
  [5,]  4.7216772 -1.4221077 -3.067015  6.4601642

, , 1, 2

      a1
c            [,1]       [,2]       [,3]       [,4]
  [1,] -4.7717774 -1.0494534  2.2896404  0.3092118
  [2,]  3.8397016 -0.1127951 -0.8335418 -6.3967417
  [3,] -0.8100704 -4.2972564  1.1073823  4.6080585
  [4,]  3.4766291  1.3770775  1.6511925  2.6574728
  [5,] -2.7626556  4.9611957  4.7837919  0.8523948

, , 2, 2

      a1
c            [,1]      [,2]        [,3]       [,4]
  [1,]  5.1069172  3.441578  1.36410161 -1.2914202
  [2,] -0.5080645  1.760376 -4.87917619 -0.6830125
  [3,]  7.7449907  7.015620  0.90922501 -4.2703954
  [4,] -5.2977927 -9.397718  0.08209162 -1.6213990
  [5,] -6.4533850 -1.356973 -7.99994560 -4.1932487

, , 3, 2

      a1
c            [,1]        [,2]       [,3]       [,4]
  [1,] -2.1180089 -1.56157657 -3.0444540  4.2419811
  [2,]  2.9981322 -0.03294657  2.2035226  0.2996967
  [3,]  1.5836696 -2.21068021 -7.7859515  2.6942964
  [4,] -0.1582774 -0.87203400  0.7638035 -3.7604290
  [5,]  1.3188926 -2.06083892  2.5351664 -2.7974677

, , 4, 2

      a1
c            [,1]      [,2]      [,3]       [,4]
  [1,]  2.4736368  2.066592  2.183554  3.7139112
  [2,] -0.8914545 -5.822417 -4.559295  0.4679584
  [3,]  0.4946849 -1.972233 -6.448038 -0.9158920
  [4,]  1.2484854 -5.451237  2.068878 -5.9095896
  [5,]  5.8790355  6.998398  2.950649 -2.9567472

, , 5, 2

      a1
c            [,1]      [,2]      [,3]      [,4]
  [1,]  1.7962685  3.245443 -3.766613  1.349804
  [2,] -4.4878560  8.978860  4.920742 -1.087291
  [3,] -3.2783405 -3.926046  2.485509 -7.064981
  [4,]  0.4119418  3.988261 -3.722817  1.768493
  [5,] -1.4537835  6.484509 -5.459598  3.736263

, , 1, 3

      a1
c           [,1]        [,2]       [,3]      [,4]
  [1,] -3.635395 -0.06259169 -1.1735570 0.2423941
  [2,]  1.423165 -7.43245512 -0.6383191 4.4453820
  [3,] -1.665444 12.31114805  9.6365427 7.2993935
  [4,] -1.463782 -2.17594642  1.9621656 0.6039105
  [5,]  2.714725  6.71116834 -1.7466223 4.3896150

, , 2, 3

      a1
c           [,1]       [,2]      [,3]      [,4]
  [1,] -1.795694 -5.2264583  1.012156 -3.549915
  [2,] -2.967193  1.8139114  6.061017  5.878039
  [3,] -4.677186 -0.4598026  1.701504 -4.065478
  [4,] -6.980607  5.1463264 -1.353597 -2.251123
  [5,]  2.980398 -1.8570672  4.114319 -4.473137

, , 3, 3

      a1
c           [,1]       [,2]      [,3]      [,4]
  [1,] -3.984483 -5.1501280 -2.256806 -1.702531
  [2,]  1.140526 -1.4480626 -4.329763  6.968992
  [3,] -4.562724 -0.5055382  6.449451  3.054127
  [4,]  7.246401  2.6268994 -2.994583  1.515928
  [5,]  5.080812 -7.7338589 -5.677535 -2.415891

, , 4, 3

      a1
c            [,1]      [,2]      [,3]       [,4]
  [1,]  0.3559434  2.606566  4.020425 -1.5594805
  [2,] -2.7415992 -6.098343 -7.192729  5.3145753
  [3,] -1.6320014  3.789132 -1.993286  9.8074484
  [4,] -4.0828060  1.382317 -6.610842  0.2613842
  [5,] -3.0323068  5.376626 -6.334314 -8.6589163

, , 5, 3

      a1
c            [,1]        [,2]        [,3]       [,4]
  [1,]  0.9203480  2.04598302  -0.6174551  2.0158551
  [2,]  4.9986726  3.00100208  -4.8412744 -0.6807395
  [3,]  7.4715170 -2.01476935 -11.4160423 -2.3368010
  [4,] -0.5567231  0.04055137  -0.5709127 -5.3202880
  [5,] -8.2461295 -1.79988534  -9.6717668  1.4865820

 c a1 b1  I 
 5  4  5  3 
> 
> checker(einstein.tensor(A,G),einstein.tensor(G,A))
, , 1, 1

      a1
c            [,1]      [,2]       [,3]       [,4]
  [1,] -4.9160721 -1.723116  3.1344688  2.3590173
  [2,]  1.5210764  1.926843 -0.2071013  1.5865098
  [3,]  1.4196044 -6.785355  3.1785261 -0.8568046
  [4,] -0.8708781 -2.585428 -6.2388113 -3.2546285
  [5,] -5.2566360 -2.184446 -1.9477836 -1.8105832

, , 2, 1

      a1
c             [,1]      [,2]      [,3]      [,4]
  [1,] -1.01294063  0.481706 -1.282652  1.618568
  [2,] -3.31353456  4.836402 -4.430307 -1.707034
  [3,] -1.82680096  3.415630 -6.897968  5.301271
  [4,]  0.03703797  1.215010 -1.978326  3.908937
  [5,]  0.30849625 -6.146003  3.245114 -4.837900

, , 3, 1

      a1
c           [,1]        [,2]      [,3]        [,4]
  [1,] -4.700143  2.74125048 -4.365630  2.90847464
  [2,] -3.320153  4.33641319 -2.280506  4.05000108
  [3,] -7.206831 -2.55037470 -1.002285  4.17916989
  [4,] -5.348353  4.19974883  2.569026  0.09905949
  [5,] -3.691877 -0.01453547 -4.061927 -3.88339643

, , 4, 1

      a1
c           [,1]      [,2]       [,3]      [,4]
  [1,] 1.7392852 -5.001167 -2.2350489  4.257032
  [2,] 0.1181369  3.057290 -4.1693774 -4.584761
  [3,] 3.4983241  4.535508 -8.5922870  3.228034
  [4,] 3.4707759  4.995333  5.9143055 -1.567897
  [5,] 1.7255907 -4.703328 -0.7070128 -1.266183

, , 5, 1

      a1
c            [,1]       [,2]      [,3]       [,4]
  [1,]  0.7507208  0.1441032 -1.475236  4.8025327
  [2,]  0.4468442  2.1466639 -3.260027 -6.1556623
  [3,] -5.9376256  7.4312306 -6.731992 -2.4167834
  [4,] -0.9061706  6.7962766 -4.357772  0.1934279
  [5,]  4.7216772 -1.4221077 -3.067015  6.4601642

, , 1, 2

      a1
c            [,1]       [,2]       [,3]       [,4]
  [1,] -4.7717774 -1.0494534  2.2896404  0.3092118
  [2,]  3.8397016 -0.1127951 -0.8335418 -6.3967417
  [3,] -0.8100704 -4.2972564  1.1073823  4.6080585
  [4,]  3.4766291  1.3770775  1.6511925  2.6574728
  [5,] -2.7626556  4.9611957  4.7837919  0.8523948

, , 2, 2

      a1
c            [,1]      [,2]        [,3]       [,4]
  [1,]  5.1069172  3.441578  1.36410161 -1.2914202
  [2,] -0.5080645  1.760376 -4.87917619 -0.6830125
  [3,]  7.7449907  7.015620  0.90922501 -4.2703954
  [4,] -5.2977927 -9.397718  0.08209162 -1.6213990
  [5,] -6.4533850 -1.356973 -7.99994560 -4.1932487

, , 3, 2

      a1
c            [,1]        [,2]       [,3]       [,4]
  [1,] -2.1180089 -1.56157657 -3.0444540  4.2419811
  [2,]  2.9981322 -0.03294657  2.2035226  0.2996967
  [3,]  1.5836696 -2.21068021 -7.7859515  2.6942964
  [4,] -0.1582774 -0.87203400  0.7638035 -3.7604290
  [5,]  1.3188926 -2.06083892  2.5351664 -2.7974677

, , 4, 2

      a1
c            [,1]      [,2]      [,3]       [,4]
  [1,]  2.4736368  2.066592  2.183554  3.7139112
  [2,] -0.8914545 -5.822417 -4.559295  0.4679584
  [3,]  0.4946849 -1.972233 -6.448038 -0.9158920
  [4,]  1.2484854 -5.451237  2.068878 -5.9095896
  [5,]  5.8790355  6.998398  2.950649 -2.9567472

, , 5, 2

      a1
c            [,1]      [,2]      [,3]      [,4]
  [1,]  1.7962685  3.245443 -3.766613  1.349804
  [2,] -4.4878560  8.978860  4.920742 -1.087291
  [3,] -3.2783405 -3.926046  2.485509 -7.064981
  [4,]  0.4119418  3.988261 -3.722817  1.768493
  [5,] -1.4537835  6.484509 -5.459598  3.736263

, , 1, 3

      a1
c           [,1]        [,2]       [,3]      [,4]
  [1,] -3.635395 -0.06259169 -1.1735570 0.2423941
  [2,]  1.423165 -7.43245512 -0.6383191 4.4453820
  [3,] -1.665444 12.31114805  9.6365427 7.2993935
  [4,] -1.463782 -2.17594642  1.9621656 0.6039105
  [5,]  2.714725  6.71116834 -1.7466223 4.3896150

, , 2, 3

      a1
c           [,1]       [,2]      [,3]      [,4]
  [1,] -1.795694 -5.2264583  1.012156 -3.549915
  [2,] -2.967193  1.8139114  6.061017  5.878039
  [3,] -4.677186 -0.4598026  1.701504 -4.065478
  [4,] -6.980607  5.1463264 -1.353597 -2.251123
  [5,]  2.980398 -1.8570672  4.114319 -4.473137

, , 3, 3

      a1
c           [,1]       [,2]      [,3]      [,4]
  [1,] -3.984483 -5.1501280 -2.256806 -1.702531
  [2,]  1.140526 -1.4480626 -4.329763  6.968992
  [3,] -4.562724 -0.5055382  6.449451  3.054127
  [4,]  7.246401  2.6268994 -2.994583  1.515928
  [5,]  5.080812 -7.7338589 -5.677535 -2.415891

, , 4, 3

      a1
c            [,1]      [,2]      [,3]       [,4]
  [1,]  0.3559434  2.606566  4.020425 -1.5594805
  [2,] -2.7415992 -6.098343 -7.192729  5.3145753
  [3,] -1.6320014  3.789132 -1.993286  9.8074484
  [4,] -4.0828060  1.382317 -6.610842  0.2613842
  [5,] -3.0323068  5.376626 -6.334314 -8.6589163

, , 5, 3

      a1
c            [,1]        [,2]        [,3]       [,4]
  [1,]  0.9203480  2.04598302  -0.6174551  2.0158551
  [2,]  4.9986726  3.00100208  -4.8412744 -0.6807395
  [3,]  7.4715170 -2.01476935 -11.4160423 -2.3368010
  [4,] -0.5567231  0.04055137  -0.5709127 -5.3202880
  [5,] -8.2461295 -1.79988534  -9.6717668  1.4865820

 c a1 b1  I 
 5  4  5  3 
> 
> checker(einstein.tensor(einstein.tensor(A,G),inv.tensor(G,c("a","b"),by="I"),by=c("I")),rep(A,dim(G)["I"],1,"I"))
, , 1, 1

      a
c             [,1]        [,2]       [,3]        [,4]
  [1,] -0.59416575  0.37849947 -0.6851564 -0.98508098
  [2,]  0.52469868  0.04378833  1.3868142  0.61678028
  [3,] -0.01769231 -0.94697786 -0.4022124  0.05612025
  [4,] -0.52031683 -1.17733344  1.2292765  1.12002683
  [5,] -1.89485633 -0.26303828 -0.2078783 -1.04187663

, , 2, 1

      a
c            [,1]       [,2]       [,3]       [,4]
  [1,] -0.4003801  0.3255066 -1.1684364  0.4212993
  [2,]  0.7556916 -1.4186397 -0.2730597  1.2176170
  [3,] -0.1562948 -1.1885058  1.2822683 -0.4260943
  [4,] -0.0753744  0.2932872 -0.0288957 -0.3978164
  [5,] -1.5422206  0.7527781 -0.2653699  1.2066058

, , 3, 1

      a
c            [,1]        [,2]       [,3]        [,4]
  [1,]  0.3486553  0.34934077  1.0807408  0.06253499
  [2,] -0.6696680 -1.29577102  0.4952249  0.35056369
  [3,] -0.4371484 -0.58263237  2.3616330 -0.98172868
  [4,]  0.6554814  0.49138467  1.6429060  0.32859100
  [5,] -0.7979686  0.09586926 -0.1305040  1.38843020

, , 4, 1

      a
c            [,1]       [,2]       [,3]       [,4]
  [1,] -0.7560774 -0.4021343 -0.4444302 -0.9993098
  [2,]  0.9606657  0.3254006 -1.4676450  0.5462929
  [3,] -2.1371789 -0.3241383  0.5531834 -0.2679333
  [4,]  1.4613930 -0.3980795 -0.3555964  0.5035616
  [5,] -0.2500193 -1.3640832 -0.8105675  1.0824382

, , 5, 1

      a
c            [,1]       [,2]      [,3]       [,4]
  [1,]  0.2020531  0.2279937 0.2075888 -0.5953352
  [2,] -2.2326815  0.2882842 0.5438345 -1.1919848
  [3,] -1.0955978 -1.8981084 1.4605549 -1.5107880
  [4,]  0.4008347 -1.0983184 0.1305792  0.7646588
  [5,]  1.2946636 -0.8166615 0.4759993  0.3731633

, , 1, 2

      a
c             [,1]        [,2]       [,3]        [,4]
  [1,] -0.59416575  0.37849947 -0.6851564 -0.98508098
  [2,]  0.52469868  0.04378833  1.3868142  0.61678028
  [3,] -0.01769231 -0.94697786 -0.4022124  0.05612025
  [4,] -0.52031683 -1.17733344  1.2292765  1.12002683
  [5,] -1.89485633 -0.26303828 -0.2078783 -1.04187663

, , 2, 2

      a
c            [,1]       [,2]       [,3]       [,4]
  [1,] -0.4003801  0.3255066 -1.1684364  0.4212993
  [2,]  0.7556916 -1.4186397 -0.2730597  1.2176170
  [3,] -0.1562948 -1.1885058  1.2822683 -0.4260943
  [4,] -0.0753744  0.2932872 -0.0288957 -0.3978164
  [5,] -1.5422206  0.7527781 -0.2653699  1.2066058

, , 3, 2

      a
c            [,1]        [,2]       [,3]        [,4]
  [1,]  0.3486553  0.34934077  1.0807408  0.06253499
  [2,] -0.6696680 -1.29577102  0.4952249  0.35056369
  [3,] -0.4371484 -0.58263237  2.3616330 -0.98172868
  [4,]  0.6554814  0.49138467  1.6429060  0.32859100
  [5,] -0.7979686  0.09586926 -0.1305040  1.38843020

, , 4, 2

      a
c            [,1]       [,2]       [,3]       [,4]
  [1,] -0.7560774 -0.4021343 -0.4444302 -0.9993098
  [2,]  0.9606657  0.3254006 -1.4676450  0.5462929
  [3,] -2.1371789 -0.3241383  0.5531834 -0.2679333
  [4,]  1.4613930 -0.3980795 -0.3555964  0.5035616
  [5,] -0.2500193 -1.3640832 -0.8105675  1.0824382

, , 5, 2

      a
c            [,1]       [,2]      [,3]       [,4]
  [1,]  0.2020531  0.2279937 0.2075888 -0.5953352
  [2,] -2.2326815  0.2882842 0.5438345 -1.1919848
  [3,] -1.0955978 -1.8981084 1.4605549 -1.5107880
  [4,]  0.4008347 -1.0983184 0.1305792  0.7646588
  [5,]  1.2946636 -0.8166615 0.4759993  0.3731633

, , 1, 3

      a
c             [,1]        [,2]       [,3]        [,4]
  [1,] -0.59416575  0.37849947 -0.6851564 -0.98508098
  [2,]  0.52469868  0.04378833  1.3868142  0.61678028
  [3,] -0.01769231 -0.94697786 -0.4022124  0.05612025
  [4,] -0.52031683 -1.17733344  1.2292765  1.12002683
  [5,] -1.89485633 -0.26303828 -0.2078783 -1.04187663

, , 2, 3

      a
c            [,1]       [,2]       [,3]       [,4]
  [1,] -0.4003801  0.3255066 -1.1684364  0.4212993
  [2,]  0.7556916 -1.4186397 -0.2730597  1.2176170
  [3,] -0.1562948 -1.1885058  1.2822683 -0.4260943
  [4,] -0.0753744  0.2932872 -0.0288957 -0.3978164
  [5,] -1.5422206  0.7527781 -0.2653699  1.2066058

, , 3, 3

      a
c            [,1]        [,2]       [,3]        [,4]
  [1,]  0.3486553  0.34934077  1.0807408  0.06253499
  [2,] -0.6696680 -1.29577102  0.4952249  0.35056369
  [3,] -0.4371484 -0.58263237  2.3616330 -0.98172868
  [4,]  0.6554814  0.49138467  1.6429060  0.32859100
  [5,] -0.7979686  0.09586926 -0.1305040  1.38843020

, , 4, 3

      a
c            [,1]       [,2]       [,3]       [,4]
  [1,] -0.7560774 -0.4021343 -0.4444302 -0.9993098
  [2,]  0.9606657  0.3254006 -1.4676450  0.5462929
  [3,] -2.1371789 -0.3241383  0.5531834 -0.2679333
  [4,]  1.4613930 -0.3980795 -0.3555964  0.5035616
  [5,] -0.2500193 -1.3640832 -0.8105675  1.0824382

, , 5, 3

      a
c            [,1]       [,2]      [,3]       [,4]
  [1,]  0.2020531  0.2279937 0.2075888 -0.5953352
  [2,] -2.2326815  0.2882842 0.5438345 -1.1919848
  [3,] -1.0955978 -1.8981084 1.4605549 -1.5107880
  [4,]  0.4008347 -1.0983184 0.1305792  0.7646588
  [5,]  1.2946636 -0.8166615 0.4759993  0.3731633

c a b I 
5 4 5 3 
> 
> einstein.tensor(A,G)
, , 1, 1

      a1
c            [,1]      [,2]       [,3]       [,4]
  [1,] -4.9160721 -1.723116  3.1344688  2.3590173
  [2,]  1.5210764  1.926843 -0.2071013  1.5865098
  [3,]  1.4196044 -6.785355  3.1785261 -0.8568046
  [4,] -0.8708781 -2.585428 -6.2388113 -3.2546285
  [5,] -5.2566360 -2.184446 -1.9477836 -1.8105832

, , 2, 1

      a1
c             [,1]      [,2]      [,3]      [,4]
  [1,] -1.01294063  0.481706 -1.282652  1.618568
  [2,] -3.31353456  4.836402 -4.430307 -1.707034
  [3,] -1.82680096  3.415630 -6.897968  5.301271
  [4,]  0.03703797  1.215010 -1.978326  3.908937
  [5,]  0.30849625 -6.146003  3.245114 -4.837900

, , 3, 1

      a1
c           [,1]        [,2]      [,3]        [,4]
  [1,] -4.700143  2.74125048 -4.365630  2.90847464
  [2,] -3.320153  4.33641319 -2.280506  4.05000108
  [3,] -7.206831 -2.55037470 -1.002285  4.17916989
  [4,] -5.348353  4.19974883  2.569026  0.09905949
  [5,] -3.691877 -0.01453547 -4.061927 -3.88339643

, , 4, 1

      a1
c           [,1]      [,2]       [,3]      [,4]
  [1,] 1.7392852 -5.001167 -2.2350489  4.257032
  [2,] 0.1181369  3.057290 -4.1693774 -4.584761
  [3,] 3.4983241  4.535508 -8.5922870  3.228034
  [4,] 3.4707759  4.995333  5.9143055 -1.567897
  [5,] 1.7255907 -4.703328 -0.7070128 -1.266183

, , 5, 1

      a1
c            [,1]       [,2]      [,3]       [,4]
  [1,]  0.7507208  0.1441032 -1.475236  4.8025327
  [2,]  0.4468442  2.1466639 -3.260027 -6.1556623
  [3,] -5.9376256  7.4312306 -6.731992 -2.4167834
  [4,] -0.9061706  6.7962766 -4.357772  0.1934279
  [5,]  4.7216772 -1.4221077 -3.067015  6.4601642

, , 1, 2

      a1
c            [,1]       [,2]       [,3]       [,4]
  [1,] -4.7717774 -1.0494534  2.2896404  0.3092118
  [2,]  3.8397016 -0.1127951 -0.8335418 -6.3967417
  [3,] -0.8100704 -4.2972564  1.1073823  4.6080585
  [4,]  3.4766291  1.3770775  1.6511925  2.6574728
  [5,] -2.7626556  4.9611957  4.7837919  0.8523948

, , 2, 2

      a1
c            [,1]      [,2]        [,3]       [,4]
  [1,]  5.1069172  3.441578  1.36410161 -1.2914202
  [2,] -0.5080645  1.760376 -4.87917619 -0.6830125
  [3,]  7.7449907  7.015620  0.90922501 -4.2703954
  [4,] -5.2977927 -9.397718  0.08209162 -1.6213990
  [5,] -6.4533850 -1.356973 -7.99994560 -4.1932487

, , 3, 2

      a1
c            [,1]        [,2]       [,3]       [,4]
  [1,] -2.1180089 -1.56157657 -3.0444540  4.2419811
  [2,]  2.9981322 -0.03294657  2.2035226  0.2996967
  [3,]  1.5836696 -2.21068021 -7.7859515  2.6942964
  [4,] -0.1582774 -0.87203400  0.7638035 -3.7604290
  [5,]  1.3188926 -2.06083892  2.5351664 -2.7974677

, , 4, 2

      a1
c            [,1]      [,2]      [,3]       [,4]
  [1,]  2.4736368  2.066592  2.183554  3.7139112
  [2,] -0.8914545 -5.822417 -4.559295  0.4679584
  [3,]  0.4946849 -1.972233 -6.448038 -0.9158920
  [4,]  1.2484854 -5.451237  2.068878 -5.9095896
  [5,]  5.8790355  6.998398  2.950649 -2.9567472

, , 5, 2

      a1
c            [,1]      [,2]      [,3]      [,4]
  [1,]  1.7962685  3.245443 -3.766613  1.349804
  [2,] -4.4878560  8.978860  4.920742 -1.087291
  [3,] -3.2783405 -3.926046  2.485509 -7.064981
  [4,]  0.4119418  3.988261 -3.722817  1.768493
  [5,] -1.4537835  6.484509 -5.459598  3.736263

, , 1, 3

      a1
c           [,1]        [,2]       [,3]      [,4]
  [1,] -3.635395 -0.06259169 -1.1735570 0.2423941
  [2,]  1.423165 -7.43245512 -0.6383191 4.4453820
  [3,] -1.665444 12.31114805  9.6365427 7.2993935
  [4,] -1.463782 -2.17594642  1.9621656 0.6039105
  [5,]  2.714725  6.71116834 -1.7466223 4.3896150

, , 2, 3

      a1
c           [,1]       [,2]      [,3]      [,4]
  [1,] -1.795694 -5.2264583  1.012156 -3.549915
  [2,] -2.967193  1.8139114  6.061017  5.878039
  [3,] -4.677186 -0.4598026  1.701504 -4.065478
  [4,] -6.980607  5.1463264 -1.353597 -2.251123
  [5,]  2.980398 -1.8570672  4.114319 -4.473137

, , 3, 3

      a1
c           [,1]       [,2]      [,3]      [,4]
  [1,] -3.984483 -5.1501280 -2.256806 -1.702531
  [2,]  1.140526 -1.4480626 -4.329763  6.968992
  [3,] -4.562724 -0.5055382  6.449451  3.054127
  [4,]  7.246401  2.6268994 -2.994583  1.515928
  [5,]  5.080812 -7.7338589 -5.677535 -2.415891

, , 4, 3

      a1
c            [,1]      [,2]      [,3]       [,4]
  [1,]  0.3559434  2.606566  4.020425 -1.5594805
  [2,] -2.7415992 -6.098343 -7.192729  5.3145753
  [3,] -1.6320014  3.789132 -1.993286  9.8074484
  [4,] -4.0828060  1.382317 -6.610842  0.2613842
  [5,] -3.0323068  5.376626 -6.334314 -8.6589163

, , 5, 3

      a1
c            [,1]        [,2]        [,3]       [,4]
  [1,]  0.9203480  2.04598302  -0.6174551  2.0158551
  [2,]  4.9986726  3.00100208  -4.8412744 -0.6807395
  [3,]  7.4715170 -2.01476935 -11.4160423 -2.3368010
  [4,] -0.5567231  0.04055137  -0.5709127 -5.3202880
  [5,] -8.2461295 -1.79988534  -9.6717668  1.4865820

 c a1 b1  I 
 5  4  5  3 
> 
> ## chol
> 
> A <- to.tensor(rnorm(15),c(a=3,b=5))
> AAt <- einstein.tensor(A,mark(A,i="a"))
> ch <- chol.tensor(AAt,"a","a'",name="lambda")
> #names(ch)[1]<-"lambda"
> checker(einstein.tensor(ch,mark(ch,i="a")),AAt)
      a'
a           [,1]       [,2]       [,3]
  [1,]  6.984947 -2.9030232  1.4581482
  [2,] -2.903023  6.8345200 -0.2415085
  [3,]  1.458148 -0.2415085  2.2585281
 a a' 
 3  3 
> 
> A <- to.tensor(rnorm(30),c(a=3,b=5,c=2))
> AAt <- einstein.tensor(A,mark(A,i="a"),by="c")
> ch <- chol.tensor(AAt,"a","a'",name="lambda")
> checker(einstein.tensor(ch,mark(ch,i="a"),by="c"),AAt)
, , 1

      a'
a            [,1]       [,2]       [,3]
  [1,]  0.4804315 -0.4854377 -0.7160533
  [2,] -0.4854377  2.3300375 -1.5928575
  [3,] -0.7160533 -1.5928575  5.2261142

, , 2

      a'
a           [,1]        [,2]        [,3]
  [1,]  2.039175 -0.39424904 -1.77979967
  [2,] -0.394249  1.07048922  0.06254919
  [3,] -1.779800  0.06254919  7.61912388

 a a'  c 
 3  3  2 
> 
> ftable(A)
      c          c1          c2
a  b                           
a1 b1   -0.09784599  1.34761937
   b2    0.09225565  0.32222796
   b3   -0.55385608 -0.05096052
   b4   -0.19364675  0.32350045
   b5    0.34364361  0.10962258
a2 b1    0.10041272 -0.22494352
   b2   -0.94165174  0.13085593
   b3    0.54406156  0.26990205
   b4    1.01756980 -0.61980277
   b5    0.31905404  0.73875826
a3 b1    0.09202849 -1.45734359
   b2    1.44132363  1.41735358
   b3    1.45227763  1.35317178
   b4   -0.83674732 -0.19863919
   b5   -0.57530405 -1.27116127
> 
> # norm
> 
> A <- to.tensor(c(1,1,1,1,0,1,1,1,0,0,1,1),c(a=4,b=3))
> checker(norm.tensor(A),sqrt(9))
[1] 3
> checker(norm.tensor(A,c(1,2)),sqrt(9))
[1] 3
> checker(norm.tensor(A,"b"),to.tensor(sqrt(c(1,2,3,3)),c(a=4)))
[1] 1.000000 1.414214 1.732051 1.732051
a 
4 
> checker(norm.tensor(A,"a"),to.tensor(sqrt(c(4,3,2)),c(b=3)))
[1] 2.000000 1.732051 1.414214
b 
3 
> checker(norm.tensor(A,by="a"),to.tensor(sqrt(c(1,2,3,3)),c(a=4)))
[1] 1.000000 1.414214 1.732051 1.732051
a 
4 
> checker(norm.tensor(A,by="b"),to.tensor(sqrt(c(4,3,2)),c(b=3)))
[1] 2.000000 1.732051 1.414214
b 
3 
> 
> # opnorm
> 
> A <- to.tensor(c(1,0,0,0,1,0,0,1),c(a=2,b=2,s=2))
> checker(opnorm(A,"a",by="s"),to.tensor(c(1,1),c(s=2)))
[1] 1 1
s 
2 
> 
> 
> # margin
> 
> 
> A <- to.tensor(rnorm(30),c(a=3,b=2,c=5))
> checker( margin.tensor(A,c("a","c")),einstein.tensor(A,one.tensor(c(a=3,c=5))))
[1]  1.489604 -2.001261
b 
2 
> checker( margin.tensor(A,by=c("a","c")),einstein.tensor(A,one.tensor(c(b=2))))
      c
a            [,1]        [,2]       [,3]       [,4]       [,5]
  [1,] -0.5769965 -0.20187122 -0.3721776 -0.9407186 -0.3738240
  [2,]  2.6281710  0.02626197 -0.2817764  0.5209827  0.1161373
  [3,] -0.3472123 -2.10653371  0.9159899  1.5840502 -1.1021397
a c 
3 5 
> checker(one.tensor(c(a=3,c=5)),to.tensor(rep(1,15),c(a=3,c=5)))
      c
a      [,1] [,2] [,3] [,4] [,5]
  [1,]    1    1    1    1    1
  [2,]    1    1    1    1    1
  [3,]    1    1    1    1    1
a c 
3 5 
> 
> # diagmul
> 
> A <- to.tensor(rnorm(30),c(a=3,b=2,c=5))
> B <- to.tensor(rnorm(6),c(a=3,b=2))
> 
> checker(einstein.tensor(A,diag.tensor(B,mark="m")),
+         diagmul.tensor(A,B,i=c("a","b"))[[a=~am,b=~bm]])
, , 1

      am
c             [,1]       [,2]         [,3]
  [1,] -0.09234645  0.7680490 -0.146947930
  [2,] -0.69025880 -1.4953515  0.128088503
  [3,]  1.52252439  1.0115641  0.028617422
  [4,]  1.88231190  0.6671632  0.006614462
  [5,]  0.32903062 -1.6450917 -0.022248073

, , 2

      am
c            [,1]        [,2]        [,3]
  [1,]  0.4613362 -0.03444576  0.05528349
  [2,] -0.5728777 -0.52175024  0.02677008
  [3,] -0.3521745  0.16717339 -0.18994383
  [4,] -0.1400363  0.62922790 -0.72614126
  [5,] -0.1624029 -0.41876036  0.29378116

 c am bm 
 5  3  2 
> 
> # is.tensor
> if( !identical(c(
+ is.tensor(FALSE),
+ is.tensor(TRUE),
+ is.tensor(matrix(1:3)),
+ is.tensor(as.tensor(matrix(1:3))),
+ is.tensor(A)),c(FALSE,FALSE,FALSE,TRUE,TRUE)))
+   stop("Fehler")
> 
> #
> 
> A <- to.tensor(rnorm(30),c(a=3,b=2,c=5))
> checker(reorder.tensor(reorder.tensor(reorder.tensor(A,c("c","b","a")),c(1,3,2)),c("a","b","c")),A)
, , 1

      b
a            [,1]      [,2]
  [1,]  1.3608712 0.1388678
  [2,] -0.2778444 1.0647286
  [3,] -0.5903549 1.2437371

, , 2

      b
a           [,1]        [,2]
  [1,] 0.7501802 -0.23673761
  [2,] 1.0943480  0.25025069
  [3,] 0.4039253  0.03963538

, , 3

      b
a             [,1]        [,2]
  [1,]  0.03815099 -1.05704346
  [2,]  1.75624450 -0.59121518
  [3,] -2.27214495 -0.02258944

, , 4

      b
a            [,1]         [,2]
  [1,] -0.5508356  0.001771953
  [2,] -1.9457278 -1.331896909
  [3,] -0.6734224  0.163766168

, , 5

      b
a             [,1]      [,2]
  [1,] -0.81027860 -1.018249
  [2,]  0.07552993  0.431965
  [3,]  2.13937238 -1.398020

a b c 
3 2 5 
> 
> 
> 
> 
> mul.tensor(A,c(),B,c(),by=c("a","b"))
, , 1

      a
c             [,1]        [,2]        [,3]
  [1,]  1.18625583 -0.35781610  0.06050369
  [2,]  0.65392346  1.40933301 -0.04139709
  [3,]  0.03325578  2.26174256  0.23286527
  [4,] -0.48015703 -2.50576470  0.06901703
  [5,] -0.70631056  0.09726964 -0.21925781

, , 2

      a
c               [,1]       [,2]        [,3]
  [1,]  0.0388051044  0.4709735  0.76548188
  [2,] -0.0661537646  0.1106962  0.02439436
  [3,] -0.2953793650 -0.2615189 -0.01390311
  [4,]  0.0004951532 -0.5891531  0.10079303
  [5,] -0.2845387527  0.1910760 -0.86043835

c a b 
5 3 2 
> #### complex
> 
> A <- to.tensor( c(1+1i,1,0,2-13i) , c(a=2,b=2) )
> B <- to.tensor( c(1+1i,1,0,2-13i) , c(a=2,b=2) )
> A
      b
a      [,1]  [,2]
  [1,] 1+1i 0+ 0i
  [2,] 1+0i 2-13i
a b 
2 2 
> Am <- matrix(c(A),nrow=nrow(A))
> Bm <- matrix(c(B),nrow=nrow(B))
> checker(mul.tensor(A,"b",B,"a"),to.tensor(c(Am%*%Bm),c(nrow(A),ncol(B))))
      b
a       [,1]     [,2]
  [1,] 0+ 2i    0+ 0i
  [2,] 3-12i -165-52i
a b 
2 2 
> 
> 
> R1  <- matrix(rnorm(9)+rnorm(9)*1i,nrow=3)
> R1i <- solve(R1)
> R2 <- to.tensor(R1,c(a=3,b=3),what=1:2)
> R2i <- to.tensor(R1i,c(b=3,a=3),what=1:2)
> 
> checker(inv.tensor(R2,"a","b"),R2i)
      b
a                        [,1]                  [,2]                [,3]
  [1,]  0.26891751+0.7628924i -0.7687779+0.8888999i  0.150048-1.282899i
  [2,] -0.04531925-0.0322484i -0.2363306+1.5599185i -0.778443-0.658758i
  [3,]  0.44526602-0.8088347i  1.5938597+0.4511647i -0.908303+1.221015i
a b 
3 3 
> checker(inv.tensor(R2,"a","b",allowSingular=TRUE),R2i)
      b
a                        [,1]                  [,2]                [,3]
  [1,]  0.26891751+0.7628924i -0.7687779+0.8888999i  0.150048-1.282899i
  [2,] -0.04531925-0.0322484i -0.2363306+1.5599185i -0.778443-0.658758i
  [3,]  0.44526602-0.8088347i  1.5938597+0.4511647i -0.908303+1.221015i
a b 
3 3 
> 
> checker(inv.tensor(rep(R2,4,1,"K"),"a","b",by="K"),rep(R2i,4,1,"K"))
, , 1

      b
a                        [,1]                  [,2]                [,3]
  [1,]  0.26891751+0.7628924i -0.7687779+0.8888999i  0.150048-1.282899i
  [2,] -0.04531925-0.0322484i -0.2363306+1.5599185i -0.778443-0.658758i
  [3,]  0.44526602-0.8088347i  1.5938597+0.4511647i -0.908303+1.221015i

, , 2

      b
a                        [,1]                  [,2]                [,3]
  [1,]  0.26891751+0.7628924i -0.7687779+0.8888999i  0.150048-1.282899i
  [2,] -0.04531925-0.0322484i -0.2363306+1.5599185i -0.778443-0.658758i
  [3,]  0.44526602-0.8088347i  1.5938597+0.4511647i -0.908303+1.221015i

, , 3

      b
a                        [,1]                  [,2]                [,3]
  [1,]  0.26891751+0.7628924i -0.7687779+0.8888999i  0.150048-1.282899i
  [2,] -0.04531925-0.0322484i -0.2363306+1.5599185i -0.778443-0.658758i
  [3,]  0.44526602-0.8088347i  1.5938597+0.4511647i -0.908303+1.221015i

, , 4

      b
a                        [,1]                  [,2]                [,3]
  [1,]  0.26891751+0.7628924i -0.7687779+0.8888999i  0.150048-1.282899i
  [2,] -0.04531925-0.0322484i -0.2363306+1.5599185i -0.778443-0.658758i
  [3,]  0.44526602-0.8088347i  1.5938597+0.4511647i -0.908303+1.221015i

a b K 
3 3 4 
> checker(inv.tensor(rep(R2,4,1,"K"),"a","b",by="K",allowSingular=TRUE),rep(R2i,4,3,"K"))
, , 1

      b
a                        [,1]                  [,2]                [,3]
  [1,]  0.26891751+0.7628924i -0.7687779+0.8888999i  0.150048-1.282899i
  [2,] -0.04531925-0.0322484i -0.2363306+1.5599185i -0.778443-0.658758i
  [3,]  0.44526602-0.8088347i  1.5938597+0.4511647i -0.908303+1.221015i

, , 2

      b
a                        [,1]                  [,2]                [,3]
  [1,]  0.26891751+0.7628924i -0.7687779+0.8888999i  0.150048-1.282899i
  [2,] -0.04531925-0.0322484i -0.2363306+1.5599185i -0.778443-0.658758i
  [3,]  0.44526602-0.8088347i  1.5938597+0.4511647i -0.908303+1.221015i

, , 3

      b
a                        [,1]                  [,2]                [,3]
  [1,]  0.26891751+0.7628924i -0.7687779+0.8888999i  0.150048-1.282899i
  [2,] -0.04531925-0.0322484i -0.2363306+1.5599185i -0.778443-0.658758i
  [3,]  0.44526602-0.8088347i  1.5938597+0.4511647i -0.908303+1.221015i

, , 4

      b
a                        [,1]                  [,2]                [,3]
  [1,]  0.26891751+0.7628924i -0.7687779+0.8888999i  0.150048-1.282899i
  [2,] -0.04531925-0.0322484i -0.2363306+1.5599185i -0.778443-0.658758i
  [3,]  0.44526602-0.8088347i  1.5938597+0.4511647i -0.908303+1.221015i

a b K 
3 3 4 
> 
> R3 <- to.tensor(rnorm(15),c(a=3,z=5))
> 
> checker(mul.tensor(R2i,"b",mul.tensor(R2,"a",R3)),R3)
      z
a               [,1]          [,2]          [,3]          [,4]          [,5]
  [1,] -0.2019466+0i -0.2347215+0i  1.7048268+0i  0.2304638+0i -0.5519107+0i
  [2,] -1.0496095+0i -0.8950220+0i -1.8930449+0i -0.6858668+0i  1.0463292+0i
  [3,]  0.4888999+0i -0.3455552+0i  0.2676867+0i -0.1873279+0i -0.1284069+0i
a z 
3 5 
> 
> 
> 
> checker(solve.tensor(R2i,R3[[z=1]],"a"),mul.tensor(R2,"a",R3[[z=1]]))
[1]  1.3713638-0.4742725i -0.2140516+0.0970410i  0.4118275-0.8361075i
b 
3 
> checker(solve.tensor(R2i,R3,"a"),mul.tensor(R2,"a",R3))
      z
b                       [,1]                  [,2]               [,3]
  [1,]  1.3713638-0.4742725i  0.3899320-0.6974421i 3.501221-1.056582i
  [2,] -0.2140516+0.0970410i -0.2465436+0.7832036i 1.137403-0.661693i
  [3,]  0.4118275-0.8361075i -0.5798237-0.2166972i 3.025978-0.164146i
      z
b                      [,4]                  [,5]
  [1,] 0.6935974-0.4980503i -1.6115079+0.5978944i
  [2,] 0.1177914+0.2619836i -0.3381057+0.0907991i
  [3,] 0.2284069-0.0365227i -1.0922744+0.2511951i
b z 
3 5 
> 
> checker(solve.tensor(R2i,R3[[z=1]],"a",allowSingular=TRUE),mul.tensor(R2,"a",R3[[z=1]]))
[1]  1.3713638-0.4742725i -0.2140516+0.0970410i  0.4118275-0.8361075i
b 
3 
> checker(solve.tensor(R2i,R3,"a",allowSingular=T),mul.tensor(R2,"a",R3))
      z
b                       [,1]                  [,2]               [,3]
  [1,]  1.3713638-0.4742725i  0.3899320-0.6974421i 3.501221-1.056582i
  [2,] -0.2140516+0.0970410i -0.2465436+0.7832036i 1.137403-0.661693i
  [3,]  0.4118275-0.8361075i -0.5798237-0.2166972i 3.025978-0.164146i
      z
b                      [,4]                  [,5]
  [1,] 0.6935974-0.4980503i -1.6115079+0.5978944i
  [2,] 0.1177914+0.2619836i -0.3381057+0.0907991i
  [3,] 0.2284069-0.0365227i -1.0922744+0.2511951i
b z 
3 5 
> 
> checker(solve.tensor(rep(R2i,4,1,"K"),R3[[z=1]],"a",by="K"),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b                       [,1]                  [,2]                  [,3]
  [1,]  1.3713638-0.4742725i  1.3713638-0.4742725i  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i -0.2140516+0.0970410i -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i  0.4118275-0.8361075i  0.4118275-0.8361075i
      K
b                       [,4]
  [1,]  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i
b K 
3 4 
> checker(solve.tensor(rep(R2i,4,1,"K"),rep(R3[[z=1]],4,1,"K"),"a",by="K"),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b                       [,1]                  [,2]                  [,3]
  [1,]  1.3713638-0.4742725i  1.3713638-0.4742725i  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i -0.2140516+0.0970410i -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i  0.4118275-0.8361075i  0.4118275-0.8361075i
      K
b                       [,4]
  [1,]  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i
b K 
3 4 
> checker(solve.tensor(R2i,rep(R3[[z=1]],4,1,"K"),"a",by="K"),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b                       [,1]                  [,2]                  [,3]
  [1,]  1.3713638-0.4742725i  1.3713638-0.4742725i  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i -0.2140516+0.0970410i -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i  0.4118275-0.8361075i  0.4118275-0.8361075i
      K
b                       [,4]
  [1,]  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i
b K 
3 4 
> 
> checker(solve.tensor(rep(R2i,4,1,"K"),R3[[z=1]],"a",by="K",allowSingular=T),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b                       [,1]                  [,2]                  [,3]
  [1,]  1.3713638-0.4742725i  1.3713638-0.4742725i  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i -0.2140516+0.0970410i -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i  0.4118275-0.8361075i  0.4118275-0.8361075i
      K
b                       [,4]
  [1,]  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i
b K 
3 4 
> checker(solve.tensor(rep(R2i,4,1,"K"),rep(R3[[z=1]],4,1,"K"),"a",by="K",allowSingular=T),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b                       [,1]                  [,2]                  [,3]
  [1,]  1.3713638-0.4742725i  1.3713638-0.4742725i  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i -0.2140516+0.0970410i -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i  0.4118275-0.8361075i  0.4118275-0.8361075i
      K
b                       [,4]
  [1,]  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i
b K 
3 4 
> checker(solve.tensor(R2i,rep(R3[[z=1]],4,1,"K"),"a",by="K",allowSingular=T),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
      K
b                       [,1]                  [,2]                  [,3]
  [1,]  1.3713638-0.4742725i  1.3713638-0.4742725i  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i -0.2140516+0.0970410i -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i  0.4118275-0.8361075i  0.4118275-0.8361075i
      K
b                       [,4]
  [1,]  1.3713638-0.4742725i
  [2,] -0.2140516+0.0970410i
  [3,]  0.4118275-0.8361075i
b K 
3 4 
> 
> # trace.tensor
> 
> A <- to.tensor(rep(1,16),c(a=4,b=4))
> checker(trace.tensor(A,"a","b"),4)
[1] 4
> 
> A <- to.tensor(rep(1,16*3),c(a=4,c=3,b=4))
> checker(trace.tensor(A,"a","b"),to.tensor(rep(4,3),c(c=3)))
[1] 4 4 4
c 
3 
> 
> A <- to.tensor(1:(2*2*3*3*5),c(a=2,b=3,c=2,d=3,e=5))
> erg <- sapply(1:5,function(e) sum(diag(matrix(A[[e=e]],nrow=6))))
> checker(trace.tensor(reorder(A,c(3,4,1,5,2)),c("a","b"),c("c","d")),to.tensor(c(erg),c(e=5)))
[1] 111 327 543 759 975
e 
5 
> 
> # delta.tensor
> 
> checker(delta.tensor(c(a=2,b=3)),to.tensor(c(diag(6)),c(a=2,b=3,"a'"=2,"b'"=3)))
, , 1, 1

      b
a      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    0    0    0

, , 2, 1

      b
a      [,1] [,2] [,3]
  [1,]    0    0    0
  [2,]    1    0    0

, , 1, 2

      b
a      [,1] [,2] [,3]
  [1,]    0    1    0
  [2,]    0    0    0

, , 2, 2

      b
a      [,1] [,2] [,3]
  [1,]    0    0    0
  [2,]    0    1    0

, , 1, 3

      b
a      [,1] [,2] [,3]
  [1,]    0    0    1
  [2,]    0    0    0

, , 2, 3

      b
a      [,1] [,2] [,3]
  [1,]    0    0    0
  [2,]    0    0    1

 a  b a' b' 
 2  3  2  3 
> # diag.tensor
> 
> A <- to.tensor(1:6,c(a=2,b=3))
> checker(diag.tensor(A),to.tensor(c(diag(c(A))),c(a=2,b=3,"a'"=2,"b'"=3)))
, , 1, 1

      b
a      [,1] [,2] [,3]
  [1,]    1    0    0
  [2,]    0    0    0

, , 2, 1

      b
a      [,1] [,2] [,3]
  [1,]    0    0    0
  [2,]    2    0    0

, , 1, 2

      b
a      [,1] [,2] [,3]
  [1,]    0    3    0
  [2,]    0    0    0

, , 2, 2

      b
a      [,1] [,2] [,3]
  [1,]    0    0    0
  [2,]    0    4    0

, , 1, 3

      b
a      [,1] [,2] [,3]
  [1,]    0    0    5
  [2,]    0    0    0

, , 2, 3

      b
a      [,1] [,2] [,3]
  [1,]    0    0    0
  [2,]    0    0    6

 a  b a' b' 
 2  3  2  3 
> A <- to.tensor(1:6,c(a=2,b=3))
> checker(diag.tensor(A,by="b"),to.tensor(c(1,0,0,2,3,0,0,4,5,0,0,6),c(a=2,"a'"=2,b=3)))
, , 1

      a'
a      [,1] [,2]
  [1,]    1    0
  [2,]    0    2

, , 2

      a'
a      [,1] [,2]
  [1,]    3    0
  [2,]    0    4

, , 3

      a'
a      [,1] [,2]
  [1,]    5    0
  [2,]    0    6

 a a'  b 
 2  2  3 
> 
> # tripledelta.tensor
> checker(tripledelta.tensor(c(a=2)),to.tensor(c(1,0,0,0,0,0,0,1),c(a=2,"a'"=2,"a*"=2)))
, , 1

      a'
a      [,1] [,2]
  [1,]    1    0
  [2,]    0    0

, , 2

      a'
a      [,1] [,2]
  [1,]    0    0
  [2,]    0    1

 a a' a* 
 2  2  2 
> 
> checker(tripledelta.tensor(c(a=2,b=4)),
+         einstein.tensor(tripledelta.tensor(c(a=2)),tripledelta.tensor(c(b=4)) )
+         )
, , 1, 1, 1, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    1    0    0    0
  [2,]    0    0    0    0

, , 2, 1, 1, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 2, 1, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 2, 1, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 3, 1, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 3, 1, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 4, 1, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 4, 1, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 1, 2, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 1, 2, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    1    0    0    0

, , 1, 2, 2, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 2, 2, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 3, 2, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 3, 2, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 4, 2, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 4, 2, 1

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 1, 1, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 1, 1, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 2, 1, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    1    0    0
  [2,]    0    0    0    0

, , 2, 2, 1, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 3, 1, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 3, 1, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 4, 1, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 4, 1, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 1, 2, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 1, 2, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 2, 2, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 2, 2, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    1    0    0

, , 1, 3, 2, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 3, 2, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 4, 2, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 4, 2, 2

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 1, 1, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 1, 1, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 2, 1, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 2, 1, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 3, 1, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    1    0
  [2,]    0    0    0    0

, , 2, 3, 1, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 4, 1, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 4, 1, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 1, 2, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 1, 2, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 2, 2, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 2, 2, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 3, 2, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 3, 2, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    1    0

, , 1, 4, 2, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 4, 2, 3

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 1, 1, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 1, 1, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 2, 1, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 2, 1, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 3, 1, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 3, 1, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 4, 1, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    1
  [2,]    0    0    0    0

, , 2, 4, 1, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 1, 2, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 1, 2, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 2, 2, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 2, 2, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 3, 2, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 3, 2, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 1, 4, 2, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0

, , 2, 4, 2, 4

      b
a      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    1

 a  b a' b' a* b* 
 2  4  2  4  2  4 
> 
> 
> # one.tensor
> checker( one.tensor(c(a=3,b=4)), to.tensor(rep(1,12),c(a=3,b=4)))
      b
a      [,1] [,2] [,3] [,4]
  [1,]    1    1    1    1
  [2,]    1    1    1    1
  [3,]    1    1    1    1
a b 
3 4 
> 
> 
> checker(level.tensor(A),length(dim(A)))
[1] 2
> 
> 
> # svd.tensor
> 
> A <- to.tensor(rnorm(120),c(a=2,b=2,c=5,d=3,e=2))
> 
> SVD <- svd.tensor(A,c("a","d"),c("b","c"),by="e")
> dim(SVD$v)
     b      c lambda      e 
     2      5      6      2 
> # Kompositionseigenschaft
> checker(einstein.tensor(SVD$v,diag=SVD$d,SVD$u,by="e"),A)
, , 1, 1, 1

      c
b           [,1]       [,2]       [,3]       [,4]       [,5]
  [1,] 0.2112292  0.7759068 0.97572551 -0.1328569 -0.1943283
  [2,] 0.5981027 -0.9267507 0.06261686  0.9219106  0.8307256

, , 2, 1, 1

      c
b            [,1]     [,2]       [,3]       [,4]        [,5]
  [1,]  1.0684566 1.639471 -0.6603836 -0.7860032 -0.65244160
  [2,] -0.5017716 1.019933 -0.2536954 -1.9145964  0.07667319

, , 1, 2, 1

      c
b            [,1]      [,2]        [,3]      [,4]       [,5]
  [1,] -0.6888744 0.8835670  0.07474311 -1.012417 -2.2309244
  [2,] -0.3056343 0.2124523 -1.67399869  1.310477  0.7927635

, , 2, 2, 1

      c
b            [,1]       [,2]        [,3]       [,4]        [,5]
  [1,] -0.4605972 -0.8995181 -0.80537324 -0.8127535 -0.06055193
  [2,] -0.6757943  0.4972475  0.09451003  0.9750504 -0.50655995

, , 1, 3, 1

      c
b           [,1]      [,2]       [,3]       [,4]      [,5]
  [1,] 0.3400059 1.8128928  0.7341105  0.6316314  0.944529
  [2,] 0.2744991 0.8242147 -0.1377282 -1.3227240 -1.086170

, , 2, 3, 1

      c
b          [,1]       [,2]      [,3]       [,4]       [,5]
  [1,] 1.004712  0.6011503 0.9578005  1.2750765  0.1063853
  [2,] 1.233143 -0.1252803 0.4062820 -0.0449864 -0.3107619

, , 1, 1, 2

      c
b            [,1]       [,2]       [,3]       [,4]      [,5]
  [1,] -0.3765514  0.9475483 -0.3644304 -1.4059050 -1.163764
  [2,] -0.5754314 -1.2223459  0.7700514 -0.2438532 -1.241059

, , 2, 1, 2

      c
b           [,1]       [,2]       [,3]      [,4]        [,5]
  [1,] 0.1925301 -0.4369719 -2.0351162  1.683047 -0.06070507
  [2,] 1.3538781  0.2187095  0.3870477 -2.399088  1.99051402

, , 1, 2, 2

      c
b            [,1]      [,2]       [,3]        [,4]      [,5]
  [1,]  0.3442121  1.121962 -0.2164293  0.02356194 -1.367544
  [2,] -0.6138355 -3.011622 -0.1302661 -1.71615896 -1.055192

, , 2, 2, 2

      c
b            [,1]       [,2]      [,3]     [,4]      [,5]
  [1,]  0.4971773 -0.5085932 0.7124882 1.863717 0.3616040
  [2,] -0.6028935  1.3156760 0.2127373 1.447884 0.3875377

, , 1, 3, 2

      c
b           [,1]      [,2]      [,3]       [,4]       [,5]
  [1,] -0.832771 -1.341818 0.6410505 -0.8590950 -1.4214650
  [2,] -1.676125 -1.501852 0.4983737  0.8741259 -0.2354345

, , 2, 3, 2

      c
b            [,1]      [,2]      [,3]      [,4]       [,5]
  [1,]  0.4488534 0.6525507 0.6579515 0.5440174  0.5178252
  [2,] -0.8388363 0.4649224 0.7277738 0.1535633 -0.3644996

b c a d e 
2 5 2 3 2 
> # Orthogonalitaet:
> checker( SVD$v %e% SVD$v[[lambda=~"lambda'"]],2*delta.tensor(c(lambda=6)))
      lambda'
lambda          [,1]          [,2]          [,3]          [,4]          [,5]
  [1,]  2.000000e+00 -1.804112e-16  3.608225e-16 -2.567391e-16  3.764350e-16
  [2,] -1.804112e-16  2.000000e+00 -1.249001e-16 -7.632783e-17 -2.155394e-16
  [3,]  3.608225e-16 -1.249001e-16  2.000000e+00 -2.081668e-17 -6.938894e-18
  [4,] -2.567391e-16 -7.632783e-17 -2.081668e-17  2.000000e+00 -3.315490e-16
  [5,]  3.764350e-16 -2.155394e-16 -6.938894e-18 -3.315490e-16  2.000000e+00
  [6,] -2.081668e-16  8.326673e-17 -3.885781e-16 -2.914335e-16 -8.365704e-16
      lambda'
lambda          [,6]
  [1,] -2.081668e-16
  [2,]  8.326673e-17
  [3,] -3.885781e-16
  [4,] -2.914335e-16
  [5,] -8.365704e-16
  [6,]  2.000000e+00
 lambda lambda' 
      6       6 
> checker( SVD$u %e% SVD$u[[lambda=~"lambda'"]],2*delta.tensor(c(lambda=6)))
      lambda'
lambda          [,1]          [,2]          [,3]          [,4]         [,5]
  [1,]  2.000000e+00 -3.885781e-16  2.237793e-16  1.457168e-16 1.804112e-16
  [2,] -3.885781e-16  2.000000e+00 -2.012279e-16  3.469447e-16 1.526557e-16
  [3,]  2.237793e-16 -2.012279e-16  2.000000e+00  4.163336e-16 5.551115e-17
  [4,]  1.457168e-16  3.469447e-16  4.163336e-16  2.000000e+00 0.000000e+00
  [5,]  1.804112e-16  1.526557e-16  5.551115e-17  0.000000e+00 2.000000e+00
  [6,] -3.469447e-18 -2.081668e-16  1.387779e-16 -1.665335e-16 1.110223e-16
      lambda'
lambda          [,6]
  [1,] -3.469447e-18
  [2,] -2.081668e-16
  [3,]  1.387779e-16
  [4,] -1.665335e-16
  [5,]  1.110223e-16
  [6,]  2.000000e+00
 lambda lambda' 
      6       6 
> checker( SVD$u %e% mark(SVD$u,"'",c("a","d")),2*delta.tensor(c(a=2,d=3)))
, , 1, 1

      d
a               [,1]          [,2]          [,3]
  [1,]  2.000000e+00  3.538836e-16  2.498002e-16
  [2,] -1.491862e-16 -1.665335e-16 -4.440892e-16

, , 2, 1

      d
a               [,1]          [,2]          [,3]
  [1,] -1.491862e-16  8.671449e-16  6.609296e-16
  [2,]  2.000000e+00 -2.463307e-16 -2.775558e-17

, , 1, 2

      d
a              [,1]         [,2]          [,3]
  [1,] 3.538836e-16 2.000000e+00  3.469447e-17
  [2,] 8.671449e-16 3.122502e-16 -7.979728e-17

, , 2, 2

      d
a               [,1]         [,2]          [,3]
  [1,] -1.665335e-16 3.122502e-16 -4.718448e-16
  [2,] -2.463307e-16 2.000000e+00  2.220446e-16

, , 1, 3

      d
a              [,1]          [,2]          [,3]
  [1,] 2.498002e-16  3.469447e-17  2.000000e+00
  [2,] 6.609296e-16 -4.718448e-16 -8.326673e-17

, , 2, 3

      d
a               [,1]          [,2]          [,3]
  [1,] -4.440892e-16 -7.979728e-17 -8.326673e-17
  [2,] -2.775558e-17  2.220446e-16  2.000000e+00

 a  d a' d' 
 2  3  2  3 
> 
> 
> # power.tensor
> A <- to.tensor(rnorm(120),c(a=2,b=2,c=5,d=3,e=2))
> AAt <- A %e% mark(A,"'",c("a","b"))
> 
> checker(power.tensor(AAt,c("a","b"),c("a'","b'"),-1),inv.tensor(AAt,c("a","b")))
, , 1, 1

      b
a              [,1]          [,2]
  [1,]  0.029776814 -0.0057611829
  [2,] -0.003357243 -0.0002404374

, , 2, 1

      b
a              [,1]         [,2]
  [1,] -0.003357243 -0.014490212
  [2,]  0.036252940  0.003610196

, , 1, 2

      b
a              [,1]         [,2]
  [1,] -0.005761183  0.057998097
  [2,] -0.014490212 -0.008216186

, , 2, 2

      b
a               [,1]         [,2]
  [1,] -0.0002404374 -0.008216186
  [2,]  0.0036101963  0.037018942

 a  b a' b' 
 2  2  2  2 
> checker(power.tensor(AAt,c("a","b"),c("a'","b'"),2),
+         mul.tensor(AAt,c("a","b"),AAt,c("a'","b'")))
, , 1, 1

      b
a           [,1]      [,2]
  [1,] 1283.5851 315.59043
  [2,]  380.0011  63.26164

, , 2, 1

      b
a           [,1]      [,2]
  [1,]  380.0011 444.64969
  [2,] 1084.2964 -37.41947

, , 1, 2

      b
a          [,1]     [,2]
  [1,] 315.5904 517.2407
  [2,] 444.6497 174.4848

, , 2, 2

      b
a           [,1]     [,2]
  [1,]  63.26164 174.4848
  [2,] -37.41947 798.2598

 a  b a' b' 
 2  2  2  2 
> 
> checker(power.tensor(power.tensor(AAt,c("a","b"),c("a'","b'"),1/pi),
+                      c("a","b"),c("a'","b'"),pi),AAt)
, , 1, 1

      b
a           [,1]     [,2]
  [1,] 35.111935 4.882610
  [2,]  5.122266 0.812186

, , 2, 1

      b
a           [,1]      [,2]
  [1,]  5.122266  8.195341
  [2,] 31.455015 -1.215398

, , 1, 2

      b
a          [,1]     [,2]
  [1,] 4.882610 20.30414
  [2,] 8.195341  3.73889

, , 2, 2

      b
a           [,1]     [,2]
  [1,]  0.812186  3.73889
  [2,] -1.215398 27.96683

 a  b a' b' 
 2  2  2  2 
> 
> 
> AAt <- einstein.tensor(A , mark(A,"'",c("a","b")),by="e")
> 
> checker(power.tensor(AAt,c("a","b"),c("a'","b'"),-1,by="e"),
+         inv.tensor(AAt,c("a","b"),by="e"))
, , 1, 1, 1

      b
a             [,1]        [,2]
  [1,] 0.071705710 -0.03510685
  [2,] 0.002243432  0.01581457

, , 2, 1, 1

      b
a             [,1]         [,2]
  [1,] 0.002243432 -0.025451260
  [2,] 0.118310356 -0.007846876

, , 1, 2, 1

      b
a             [,1]        [,2]
  [1,] -0.03510685  0.12372711
  [2,] -0.02545126 -0.02939372

, , 2, 2, 1

      b
a              [,1]        [,2]
  [1,]  0.015814566 -0.02939372
  [2,] -0.007846876  0.07902494

, , 1, 1, 2

      b
a             [,1]         [,2]
  [1,]  0.05905232  0.007024127
  [2,] -0.01577288 -0.014094059

, , 2, 1, 2

      b
a             [,1]        [,2]
  [1,] -0.01577288 -0.03519319
  [2,]  0.05916315  0.01658679

, , 1, 2, 2

      b
a              [,1]        [,2]
  [1,]  0.007024127  0.12435313
  [2,] -0.035193187 -0.01272061

, , 2, 2, 2

      b
a             [,1]        [,2]
  [1,] -0.01409406 -0.01272061
  [2,]  0.01658679  0.08002825

 a  b a' b'  e 
 2  2  2  2  2 
> checker(power.tensor(AAt,c("a","b"),c("a'","b'"),2,by="e"),
+         mul.tensor(AAt,c("a","b"),AAt,c("a'","b'"),by="e"))
, , 1, 1, 1

      b
a           [,1]      [,2]
  [1,] 292.14163 114.69087
  [2,]  21.32936 -33.97464

, , 2, 1, 1

      b
a          [,1]     [,2]
  [1,] 21.32936 55.54338
  [2,] 91.36279 46.91888

, , 1, 2, 1

      b
a           [,1]     [,2]
  [1,] 114.69087 148.6765
  [2,]  55.54338  79.7332

, , 2, 2, 1

      b
a           [,1]     [,2]
  [1,] -33.97464  79.7332
  [2,]  46.91888 223.0088

, , 1, 1, 2

      b
a          [,1]     [,2]
  [1,] 376.1259 41.56311
  [2,] 184.5156 64.78743

, , 2, 1, 2

      b
a          [,1]      [,2]
  [1,] 184.5156 186.27286
  [2,] 563.8173 -91.12751

, , 1, 2, 2

      b
a           [,1]       [,2]
  [1,]  41.56311 127.739594
  [2,] 186.27286  -5.607508

, , 2, 2, 2

      b
a           [,1]       [,2]
  [1,]  64.78743  -5.607508
  [2,] -91.12751 199.254576

 a  b a' b'  e 
 2  2  2  2  2 
> 
> checker(power.tensor(power.tensor(AAt,c("a","b"),c("a'","b'"),1/pi,by="e"),
+                      c("a","b"),c("a'","b'"),pi,by="e"),AAt)
, , 1, 1, 1

      b
a            [,1]      [,2]
  [1,] 16.4323449  4.389979
  [2,]  0.5264515 -1.603311

, , 2, 1, 1

      b
a           [,1]     [,2]
  [1,] 0.5264515 2.418997
  [2,] 9.0751998 1.695537

, , 1, 2, 1

      b
a          [,1]      [,2]
  [1,] 4.389979 10.611578
  [2,] 2.418997  3.308699

, , 2, 2, 1

      b
a           [,1]      [,2]
  [1,] -1.603311  3.308699
  [2,]  1.695537 14.374137

, , 1, 1, 2

      b
a           [,1]      [,2]
  [1,] 18.679590 0.4926303
  [2,]  4.595814 2.4154973

, , 2, 1, 2

      b
a           [,1]      [,2]
  [1,]  4.595814  5.776345
  [2,] 22.379815 -2.910934

, , 1, 2, 2

      b
a           [,1]      [,2]
  [1,] 0.4926303 9.6925583
  [2,] 5.7763447 0.4301909

, , 2, 2, 2

      b
a           [,1]       [,2]
  [1,]  2.415497  0.4301909
  [2,] -2.910934 13.5926946

 a  b a' b'  e 
 2  2  2  2  2 
> 
> 
> # to.matrix.tensor                               # 
> A <- reorder.tensor(to.tensor(1:30,c(a=2,b=3,c=5)),c("c","a","b"))
> 
> checker(to.matrix.tensor(A,"a",c("b","c")),matrix(1:30,nrow=2))
      
       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
  [1,]    1    3    5    7    9   11   13   15   17    19    21    23    25
  [2,]    2    4    6    8   10   12   14   16   18    20    22    24    26
      
       [,14] [,15]
  [1,]    27    29
  [2,]    28    30
> 
> checker(to.matrix.tensor(A,c("a","b"),c("c")),matrix(1:30,nrow=6))
      
       [,1] [,2] [,3] [,4] [,5]
  [1,]    1    7   13   19   25
  [2,]    2    8   14   20   26
  [3,]    3    9   15   21   27
  [4,]    4   10   16   22   28
  [5,]    5   11   17   23   29
  [6,]    6   12   18   24   30
> 
> checker(to.matrix.tensor(A,c("a","b"),by=c("c")),structure(1:30,dim=c(6,1,5)))
, , 1

      
       [,1]
  [1,]    1
  [2,]    2
  [3,]    3
  [4,]    4
  [5,]    5
  [6,]    6

, , 2

      
       [,1]
  [1,]    7
  [2,]    8
  [3,]    9
  [4,]   10
  [5,]   11
  [6,]   12

, , 3

      
       [,1]
  [1,]   13
  [2,]   14
  [3,]   15
  [4,]   16
  [5,]   17
  [6,]   18

, , 4

      
       [,1]
  [1,]   19
  [2,]   20
  [3,]   21
  [4,]   22
  [5,]   23
  [6,]   24

, , 5

      
       [,1]
  [1,]   25
  [2,]   26
  [3,]   27
  [4,]   28
  [5,]   29
  [6,]   30

> checker(to.matrix.tensor(A,c("a"),by=c("c")),structure(1:30,dim=c(2,3,5)))
, , 1

      
       [,1] [,2] [,3]
  [1,]    1    3    5
  [2,]    2    4    6

, , 2

      
       [,1] [,2] [,3]
  [1,]    7    9   11
  [2,]    8   10   12

, , 3

      
       [,1] [,2] [,3]
  [1,]   13   15   17
  [2,]   14   16   18

, , 4

      
       [,1] [,2] [,3]
  [1,]   19   21   23
  [2,]   20   22   24

, , 5

      
       [,1] [,2] [,3]
  [1,]   25   27   29
  [2,]   26   28   30

> 
> # untensor
> 
> A <- reorder.tensor(to.tensor(1:30,c(a=2,b=3,c=5)),c("c","a","b"))
> 
> checker(untensor(A,c("a","b"),pos=1),to.tensor(1:30,c(I1=6,c=5)))
      c
I1     [,1] [,2] [,3] [,4] [,5]
  [1,]    1    7   13   19   25
  [2,]    2    8   14   20   26
  [3,]    3    9   15   21   27
  [4,]    4   10   16   22   28
  [5,]    5   11   17   23   29
  [6,]    6   12   18   24   30
I1  c 
 6  5 
> checker(untensor(A,c("a","b"),"new",pos=2),reorder(to.tensor(1:30,c(new=6,c=5)),2:1))
      new
c      [,1] [,2] [,3] [,4] [,5] [,6]
  [1,]    1    2    3    4    5    6
  [2,]    7    8    9   10   11   12
  [3,]   13   14   15   16   17   18
  [4,]   19   20   21   22   23   24
  [5,]   25   26   27   28   29   30
  c new 
  5   6 
> checker(untensor(A,list(u=c("a","b"),v=c(c="c"))),to.tensor(1:30,c(u=6,v=5)))
      u
v      [,1] [,2] [,3] [,4] [,5] [,6]
  [1,]    1    2    3    4    5    6
  [2,]    7    8    9   10   11   12
  [3,]   13   14   15   16   17   18
  [4,]   19   20   21   22   23   24
  [5,]   25   26   27   28   29   30
v u 
5 6 
> 
> 
> # as.tensor
> 
> checker(as.tensor(diag(5)),to.tensor(c(diag(5)),c(I1=5,I2=5)))
      I2
I1     [,1] [,2] [,3] [,4] [,5]
  [1,]    1    0    0    0    0
  [2,]    0    1    0    0    0
  [3,]    0    0    1    0    0
  [4,]    0    0    0    1    0
  [5,]    0    0    0    0    1
I1 I2 
 5  5 
> 
> # Slice tensor
> 
> A <- reorder.tensor(to.tensor(1:30,c(a=2,b=3,c=5)),c("c","a","b"))
> checker(slice.tensor(A,"c",1:2),to.tensor(1:12,c(a=2,b=3,c=2)))
, , 1

      a
c      [,1] [,2]
  [1,]    1    2
  [2,]    7    8

, , 2

      a
c      [,1] [,2]
  [1,]    3    4
  [2,]    9   10

, , 3

      a
c      [,1] [,2]
  [1,]    5    6
  [2,]   11   12

c a b 
2 2 3 
> checker(slice.tensor(A,"c",1,drop=TRUE),to.tensor(1:6,c(a=2,b=3)))
      b
a      [,1] [,2] [,3]
  [1,]    1    3    5
  [2,]    2    4    6
a b 
2 3 
> checker(slice.tensor(A,"c",1,drop=FALSE),to.tensor(1:6,c(a=2,b=3,c=1)))
, , 1

      a
c      [,1] [,2]
  [1,]    1    2

, , 2

      a
c      [,1] [,2]
  [1,]    3    4

, , 3

      a
c      [,1] [,2]
  [1,]    5    6

c a b 
1 2 3 
> 
> # Indexing with [[]]
> 
> A <- reorder.tensor(to.tensor(1:30,c(a=2,b=3,c=5)),c("c","a","b"))
> checker(A[[b=2]],slice.tensor(A,"b",2,drop=TRUE))
      a
c      [,1] [,2]
  [1,]    3    4
  [2,]    9   10
  [3,]   15   16
  [4,]   21   22
  [5,]   27   28
c a 
5 2 
> checker(A[[b=2:3]],slice.tensor(A,"b",2:3))
, , 1

      a
c      [,1] [,2]
  [1,]    3    4
  [2,]    9   10
  [3,]   15   16
  [4,]   21   22
  [5,]   27   28

, , 2

      a
c      [,1] [,2]
  [1,]    5    6
  [2,]   11   12
  [3,]   17   18
  [4,]   23   24
  [5,]   29   30

c a b 
5 2 2 
> checker(A[[b=2:3,c=3:4]],slice.tensor(slice.tensor(A,"b",2:3),"c",3:4))
, , 1

      a
c      [,1] [,2]
  [1,]   15   16
  [2,]   21   22

, , 2

      a
c      [,1] [,2]
  [1,]   17   18
  [2,]   23   24

c a b 
2 2 2 
> checker(A[[b=~q]],to.tensor(1:30,c(a=2,q=3,c=5)))
, , 1

      a
c      [,1] [,2]
  [1,]    1    2
  [2,]    7    8
  [3,]   13   14
  [4,]   19   20
  [5,]   25   26

, , 2

      a
c      [,1] [,2]
  [1,]    3    4
  [2,]    9   10
  [3,]   15   16
  [4,]   21   22
  [5,]   27   28

, , 3

      a
c      [,1] [,2]
  [1,]    5    6
  [2,]   11   12
  [3,]   17   18
  [4,]   23   24
  [5,]   29   30

c a q 
5 2 3 
> 
> #undrop.tensor
> 
> checker(undrop.tensor(slice.tensor(A,"c",2,drop=TRUE),"c"),
+         slice.tensor(A,"c",2,drop=FALSE))
, , 1

      b
a      [,1] [,2] [,3]
  [1,]    7    9   11
  [2,]    8   10   12

a b c 
2 3 1 
> 
> # bind.tensor
> 
> A <- to.tensor(1:6,c(a=2,b=3))
> checker( bind.tensor(A,"a",A), to.tensor(c(1,2,1,2,3,4,3,4,5,6,5,6),c(a=4,b=3)))
      a
b      [,1] [,2] [,3] [,4]
  [1,]    1    2    1    2
  [2,]    3    4    3    4
  [3,]    5    6    5    6
b a 
3 4 
> checker( bind.tensor(A,"b",A), to.tensor(c(1:6,1:6),c(a=2,b=6)))
      b
a      [,1] [,2] [,3] [,4] [,5] [,6]
  [1,]    1    3    5    1    3    5
  [2,]    2    4    6    2    4    6
a b 
2 6 
> 
> 
> 
> 
> # einstein.tensor
> A <- to.tensor(1:6,c(a=2,b=3))
> checker( einstein.tensor(A,A), mul.tensor(A,c("a","b"),A))
[1] 91
> checker( einstein.tensor(A,A,by="b"), mul.tensor(A,c("a"),A,by="b"))
[1]  5 25 61
b 
3 
> checker( einstein.tensor(A,diag=A,by="b"), diagmul.tensor(A,c("a"),A,by="b"))
      b
a      [,1] [,2] [,3]
  [1,]    1    9   25
  [2,]    4   16   36
a b 
2 3 
> 
> 
> # adding
> A <- to.tensor(1:30,c(a=2,b=3,c=5))
> 
> checker(A + reorder(A,c("b","a","c")),2*A)
, , 1

      b
a      [,1] [,2] [,3]
  [1,]    2    6   10
  [2,]    4    8   12

, , 2

      b
a      [,1] [,2] [,3]
  [1,]   14   18   22
  [2,]   16   20   24

, , 3

      b
a      [,1] [,2] [,3]
  [1,]   26   30   34
  [2,]   28   32   36

, , 4

      b
a      [,1] [,2] [,3]
  [1,]   38   42   46
  [2,]   40   44   48

, , 5

      b
a      [,1] [,2] [,3]
  [1,]   50   54   58
  [2,]   52   56   60

a b c 
2 3 5 
> checker(A - reorder(A,c("b","a","c")),to.tensor(rep(0,30),c(a=2,b=3,c=5)))
, , 1

      b
a      [,1] [,2] [,3]
  [1,]    0    0    0
  [2,]    0    0    0

, , 2

      b
a      [,1] [,2] [,3]
  [1,]    0    0    0
  [2,]    0    0    0

, , 3

      b
a      [,1] [,2] [,3]
  [1,]    0    0    0
  [2,]    0    0    0

, , 4

      b
a      [,1] [,2] [,3]
  [1,]    0    0    0
  [2,]    0    0    0

, , 5

      b
a      [,1] [,2] [,3]
  [1,]    0    0    0
  [2,]    0    0    0

a b c 
2 3 5 
> 
> B <- to.tensor(rnorm(6),c(b=3,a=2))
> 
> checker( A + B , rep.tensor(B,5,name="c") + A ) 
, , 1

      b
a            [,1]     [,2]     [,3]
  [1,] -0.8562447 3.055444 4.462506
  [2,]  0.3844367 5.017177 6.275817

, , 2

      b
a          [,1]      [,2]     [,3]
  [1,] 5.143755  9.055444 10.46251
  [2,] 6.384437 11.017177 12.27582

, , 3

      b
a          [,1]     [,2]     [,3]
  [1,] 11.14376 15.05544 16.46251
  [2,] 12.38444 17.01718 18.27582

, , 4

      b
a          [,1]     [,2]     [,3]
  [1,] 17.14376 21.05544 22.46251
  [2,] 18.38444 23.01718 24.27582

, , 5

      b
a          [,1]     [,2]     [,3]
  [1,] 23.14376 27.05544 28.46251
  [2,] 24.38444 29.01718 30.27582

a b c 
2 3 5 
> checker( B + A , rep.tensor(B,5,name="c") + A ) 
, , 1

      a
b            [,1]      [,2]
  [1,] -0.8562447 0.3844367
  [2,]  3.0554444 5.0171771
  [3,]  4.4625059 6.2758165

, , 2

      a
b           [,1]      [,2]
  [1,]  5.143755  6.384437
  [2,]  9.055444 11.017177
  [3,] 10.462506 12.275817

, , 3

      a
b          [,1]     [,2]
  [1,] 11.14376 12.38444
  [2,] 15.05544 17.01718
  [3,] 16.46251 18.27582

, , 4

      a
b          [,1]     [,2]
  [1,] 17.14376 18.38444
  [2,] 21.05544 23.01718
  [3,] 22.46251 24.27582

, , 5

      a
b          [,1]     [,2]
  [1,] 23.14376 24.38444
  [2,] 27.05544 29.01718
  [3,] 28.46251 30.27582

b a c 
3 2 5 
> checker( A + (B - A),  rep.tensor(B,5,name="c") ) 
, , 1

      b
a           [,1]      [,2]       [,3]
  [1,] -1.856245 0.0554444 -0.5374941
  [2,] -1.615563 1.0171771  0.2758165

, , 2

      b
a           [,1]      [,2]       [,3]
  [1,] -1.856245 0.0554444 -0.5374941
  [2,] -1.615563 1.0171771  0.2758165

, , 3

      b
a           [,1]      [,2]       [,3]
  [1,] -1.856245 0.0554444 -0.5374941
  [2,] -1.615563 1.0171771  0.2758165

, , 4

      b
a           [,1]      [,2]       [,3]
  [1,] -1.856245 0.0554444 -0.5374941
  [2,] -1.615563 1.0171771  0.2758165

, , 5

      b
a           [,1]      [,2]       [,3]
  [1,] -1.856245 0.0554444 -0.5374941
  [2,] -1.615563 1.0171771  0.2758165

a b c 
2 3 5 
> checker( B + (A - B),  A ) 
, , 1

      a
b      [,1] [,2]
  [1,]    1    2
  [2,]    3    4
  [3,]    5    6

, , 2

      a
b      [,1] [,2]
  [1,]    7    8
  [2,]    9   10
  [3,]   11   12

, , 3

      a
b      [,1] [,2]
  [1,]   13   14
  [2,]   15   16
  [3,]   17   18

, , 4

      a
b      [,1] [,2]
  [1,]   19   20
  [2,]   21   22
  [3,]   23   24

, , 5

      a
b      [,1] [,2]
  [1,]   25   26
  [2,]   27   28
  [3,]   29   30

b a c 
3 2 5 
> 
> C <- to.tensor(1:42,c(a=2,b=3,d=7))
> 
> checker( A+C , rep.tensor(A,7,name="d") + rep.tensor(C,5,name="c")) 
, , 1, 1

      b
a      [,1] [,2] [,3]
  [1,]    2    6   10
  [2,]    4    8   12

, , 2, 1

      b
a      [,1] [,2] [,3]
  [1,]    8   12   16
  [2,]   10   14   18

, , 3, 1

      b
a      [,1] [,2] [,3]
  [1,]   14   18   22
  [2,]   16   20   24

, , 4, 1

      b
a      [,1] [,2] [,3]
  [1,]   20   24   28
  [2,]   22   26   30

, , 5, 1

      b
a      [,1] [,2] [,3]
  [1,]   26   30   34
  [2,]   28   32   36

, , 1, 2

      b
a      [,1] [,2] [,3]
  [1,]    8   12   16
  [2,]   10   14   18

, , 2, 2

      b
a      [,1] [,2] [,3]
  [1,]   14   18   22
  [2,]   16   20   24

, , 3, 2

      b
a      [,1] [,2] [,3]
  [1,]   20   24   28
  [2,]   22   26   30

, , 4, 2

      b
a      [,1] [,2] [,3]
  [1,]   26   30   34
  [2,]   28   32   36

, , 5, 2

      b
a      [,1] [,2] [,3]
  [1,]   32   36   40
  [2,]   34   38   42

, , 1, 3

      b
a      [,1] [,2] [,3]
  [1,]   14   18   22
  [2,]   16   20   24

, , 2, 3

      b
a      [,1] [,2] [,3]
  [1,]   20   24   28
  [2,]   22   26   30

, , 3, 3

      b
a      [,1] [,2] [,3]
  [1,]   26   30   34
  [2,]   28   32   36

, , 4, 3

      b
a      [,1] [,2] [,3]
  [1,]   32   36   40
  [2,]   34   38   42

, , 5, 3

      b
a      [,1] [,2] [,3]
  [1,]   38   42   46
  [2,]   40   44   48

, , 1, 4

      b
a      [,1] [,2] [,3]
  [1,]   20   24   28
  [2,]   22   26   30

, , 2, 4

      b
a      [,1] [,2] [,3]
  [1,]   26   30   34
  [2,]   28   32   36

, , 3, 4

      b
a      [,1] [,2] [,3]
  [1,]   32   36   40
  [2,]   34   38   42

, , 4, 4

      b
a      [,1] [,2] [,3]
  [1,]   38   42   46
  [2,]   40   44   48

, , 5, 4

      b
a      [,1] [,2] [,3]
  [1,]   44   48   52
  [2,]   46   50   54

, , 1, 5

      b
a      [,1] [,2] [,3]
  [1,]   26   30   34
  [2,]   28   32   36

, , 2, 5

      b
a      [,1] [,2] [,3]
  [1,]   32   36   40
  [2,]   34   38   42

, , 3, 5

      b
a      [,1] [,2] [,3]
  [1,]   38   42   46
  [2,]   40   44   48

, , 4, 5

      b
a      [,1] [,2] [,3]
  [1,]   44   48   52
  [2,]   46   50   54

, , 5, 5

      b
a      [,1] [,2] [,3]
  [1,]   50   54   58
  [2,]   52   56   60

, , 1, 6

      b
a      [,1] [,2] [,3]
  [1,]   32   36   40
  [2,]   34   38   42

, , 2, 6

      b
a      [,1] [,2] [,3]
  [1,]   38   42   46
  [2,]   40   44   48

, , 3, 6

      b
a      [,1] [,2] [,3]
  [1,]   44   48   52
  [2,]   46   50   54

, , 4, 6

      b
a      [,1] [,2] [,3]
  [1,]   50   54   58
  [2,]   52   56   60

, , 5, 6

      b
a      [,1] [,2] [,3]
  [1,]   56   60   64
  [2,]   58   62   66

, , 1, 7

      b
a      [,1] [,2] [,3]
  [1,]   38   42   46
  [2,]   40   44   48

, , 2, 7

      b
a      [,1] [,2] [,3]
  [1,]   44   48   52
  [2,]   46   50   54

, , 3, 7

      b
a      [,1] [,2] [,3]
  [1,]   50   54   58
  [2,]   52   56   60

, , 4, 7

      b
a      [,1] [,2] [,3]
  [1,]   56   60   64
  [2,]   58   62   66

, , 5, 7

      b
a      [,1] [,2] [,3]
  [1,]   62   66   70
  [2,]   64   68   72

a b c d 
2 3 5 7 
> 
> # Einstein 
> 
> checker( C %e% A , einstein.tensor(C,A))
      c
d      [,1] [,2] [,3] [,4] [,5]
  [1,]   91  217  343  469  595
  [2,]  217  559  901 1243 1585
  [3,]  343  901 1459 2017 2575
  [4,]  469 1243 2017 2791 3565
  [5,]  595 1585 2575 3565 4555
  [6,]  721 1927 3133 4339 5545
  [7,]  847 2269 3691 5113 6535
d c 
7 5 
> 
> # Riemann + drag
> checker( C %r% mark(A), mul.tensor(C,c(),mark(A),c()))
, , 1, 1, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]    1    3    5
  [2,]    2    4    6

, , 2, 1, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]    7    9   11
  [2,]    8   10   12

, , 3, 1, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]   13   15   17
  [2,]   14   16   18

, , 4, 1, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]   19   21   23
  [2,]   20   22   24

, , 5, 1, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]   25   27   29
  [2,]   26   28   30

, , 6, 1, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]   31   33   35
  [2,]   32   34   36

, , 7, 1, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]   37   39   41
  [2,]   38   40   42

, , 1, 2, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]    2    6   10
  [2,]    4    8   12

, , 2, 2, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]   14   18   22
  [2,]   16   20   24

, , 3, 2, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]   26   30   34
  [2,]   28   32   36

, , 4, 2, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]   38   42   46
  [2,]   40   44   48

, , 5, 2, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]   50   54   58
  [2,]   52   56   60

, , 6, 2, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]   62   66   70
  [2,]   64   68   72

, , 7, 2, 1, 1

      b
a      [,1] [,2] [,3]
  [1,]   74   78   82
  [2,]   76   80   84

, , 1, 1, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]    3    9   15
  [2,]    6   12   18

, , 2, 1, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]   21   27   33
  [2,]   24   30   36

, , 3, 1, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]   39   45   51
  [2,]   42   48   54

, , 4, 1, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]   57   63   69
  [2,]   60   66   72

, , 5, 1, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]   75   81   87
  [2,]   78   84   90

, , 6, 1, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]   93   99  105
  [2,]   96  102  108

, , 7, 1, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]  111  117  123
  [2,]  114  120  126

, , 1, 2, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]    4   12   20
  [2,]    8   16   24

, , 2, 2, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]   28   36   44
  [2,]   32   40   48

, , 3, 2, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]   52   60   68
  [2,]   56   64   72

, , 4, 2, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]   76   84   92
  [2,]   80   88   96

, , 5, 2, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]  100  108  116
  [2,]  104  112  120

, , 6, 2, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]  124  132  140
  [2,]  128  136  144

, , 7, 2, 2, 1

      b
a      [,1] [,2] [,3]
  [1,]  148  156  164
  [2,]  152  160  168

, , 1, 1, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]    5   15   25
  [2,]   10   20   30

, , 2, 1, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]   35   45   55
  [2,]   40   50   60

, , 3, 1, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]   65   75   85
  [2,]   70   80   90

, , 4, 1, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]   95  105  115
  [2,]  100  110  120

, , 5, 1, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]  125  135  145
  [2,]  130  140  150

, , 6, 1, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]  155  165  175
  [2,]  160  170  180

, , 7, 1, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]  185  195  205
  [2,]  190  200  210

, , 1, 2, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]    6   18   30
  [2,]   12   24   36

, , 2, 2, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]   42   54   66
  [2,]   48   60   72

, , 3, 2, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]   78   90  102
  [2,]   84   96  108

, , 4, 2, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]  114  126  138
  [2,]  120  132  144

, , 5, 2, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]  150  162  174
  [2,]  156  168  180

, , 6, 2, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]  186  198  210
  [2,]  192  204  216

, , 7, 2, 3, 1

      b
a      [,1] [,2] [,3]
  [1,]  222  234  246
  [2,]  228  240  252

, , 1, 1, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]    7   21   35
  [2,]   14   28   42

, , 2, 1, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]   49   63   77
  [2,]   56   70   84

, , 3, 1, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]   91  105  119
  [2,]   98  112  126

, , 4, 1, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]  133  147  161
  [2,]  140  154  168

, , 5, 1, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]  175  189  203
  [2,]  182  196  210

, , 6, 1, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]  217  231  245
  [2,]  224  238  252

, , 7, 1, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]  259  273  287
  [2,]  266  280  294

, , 1, 2, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]    8   24   40
  [2,]   16   32   48

, , 2, 2, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]   56   72   88
  [2,]   64   80   96

, , 3, 2, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]  104  120  136
  [2,]  112  128  144

, , 4, 2, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]  152  168  184
  [2,]  160  176  192

, , 5, 2, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]  200  216  232
  [2,]  208  224  240

, , 6, 2, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]  248  264  280
  [2,]  256  272  288

, , 7, 2, 1, 2

      b
a      [,1] [,2] [,3]
  [1,]  296  312  328
  [2,]  304  320  336

, , 1, 1, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]    9   27   45
  [2,]   18   36   54

, , 2, 1, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]   63   81   99
  [2,]   72   90  108

, , 3, 1, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]  117  135  153
  [2,]  126  144  162

, , 4, 1, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]  171  189  207
  [2,]  180  198  216

, , 5, 1, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]  225  243  261
  [2,]  234  252  270

, , 6, 1, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]  279  297  315
  [2,]  288  306  324

, , 7, 1, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]  333  351  369
  [2,]  342  360  378

, , 1, 2, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]   10   30   50
  [2,]   20   40   60

, , 2, 2, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]   70   90  110
  [2,]   80  100  120

, , 3, 2, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]  130  150  170
  [2,]  140  160  180

, , 4, 2, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]  190  210  230
  [2,]  200  220  240

, , 5, 2, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]  250  270  290
  [2,]  260  280  300

, , 6, 2, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]  310  330  350
  [2,]  320  340  360

, , 7, 2, 2, 2

      b
a      [,1] [,2] [,3]
  [1,]  370  390  410
  [2,]  380  400  420

, , 1, 1, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]   11   33   55
  [2,]   22   44   66

, , 2, 1, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]   77   99  121
  [2,]   88  110  132

, , 3, 1, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]  143  165  187
  [2,]  154  176  198

, , 4, 1, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]  209  231  253
  [2,]  220  242  264

, , 5, 1, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]  275  297  319
  [2,]  286  308  330

, , 6, 1, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]  341  363  385
  [2,]  352  374  396

, , 7, 1, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]  407  429  451
  [2,]  418  440  462

, , 1, 2, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]   12   36   60
  [2,]   24   48   72

, , 2, 2, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]   84  108  132
  [2,]   96  120  144

, , 3, 2, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]  156  180  204
  [2,]  168  192  216

, , 4, 2, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]  228  252  276
  [2,]  240  264  288

, , 5, 2, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]  300  324  348
  [2,]  312  336  360

, , 6, 2, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]  372  396  420
  [2,]  384  408  432

, , 7, 2, 3, 2

      b
a      [,1] [,2] [,3]
  [1,]  444  468  492
  [2,]  456  480  504

, , 1, 1, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]   13   39   65
  [2,]   26   52   78

, , 2, 1, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]   91  117  143
  [2,]  104  130  156

, , 3, 1, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]  169  195  221
  [2,]  182  208  234

, , 4, 1, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]  247  273  299
  [2,]  260  286  312

, , 5, 1, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]  325  351  377
  [2,]  338  364  390

, , 6, 1, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]  403  429  455
  [2,]  416  442  468

, , 7, 1, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]  481  507  533
  [2,]  494  520  546

, , 1, 2, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]   14   42   70
  [2,]   28   56   84

, , 2, 2, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]   98  126  154
  [2,]  112  140  168

, , 3, 2, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]  182  210  238
  [2,]  196  224  252

, , 4, 2, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]  266  294  322
  [2,]  280  308  336

, , 5, 2, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]  350  378  406
  [2,]  364  392  420

, , 6, 2, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]  434  462  490
  [2,]  448  476  504

, , 7, 2, 1, 3

      b
a      [,1] [,2] [,3]
  [1,]  518  546  574
  [2,]  532  560  588

, , 1, 1, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]   15   45   75
  [2,]   30   60   90

, , 2, 1, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  105  135  165
  [2,]  120  150  180

, , 3, 1, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  195  225  255
  [2,]  210  240  270

, , 4, 1, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  285  315  345
  [2,]  300  330  360

, , 5, 1, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  375  405  435
  [2,]  390  420  450

, , 6, 1, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  465  495  525
  [2,]  480  510  540

, , 7, 1, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  555  585  615
  [2,]  570  600  630

, , 1, 2, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]   16   48   80
  [2,]   32   64   96

, , 2, 2, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  112  144  176
  [2,]  128  160  192

, , 3, 2, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  208  240  272
  [2,]  224  256  288

, , 4, 2, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  304  336  368
  [2,]  320  352  384

, , 5, 2, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  400  432  464
  [2,]  416  448  480

, , 6, 2, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  496  528  560
  [2,]  512  544  576

, , 7, 2, 2, 3

      b
a      [,1] [,2] [,3]
  [1,]  592  624  656
  [2,]  608  640  672

, , 1, 1, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]   17   51   85
  [2,]   34   68  102

, , 2, 1, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  119  153  187
  [2,]  136  170  204

, , 3, 1, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  221  255  289
  [2,]  238  272  306

, , 4, 1, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  323  357  391
  [2,]  340  374  408

, , 5, 1, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  425  459  493
  [2,]  442  476  510

, , 6, 1, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  527  561  595
  [2,]  544  578  612

, , 7, 1, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  629  663  697
  [2,]  646  680  714

, , 1, 2, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]   18   54   90
  [2,]   36   72  108

, , 2, 2, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  126  162  198
  [2,]  144  180  216

, , 3, 2, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  234  270  306
  [2,]  252  288  324

, , 4, 2, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  342  378  414
  [2,]  360  396  432

, , 5, 2, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  450  486  522
  [2,]  468  504  540

, , 6, 2, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  558  594  630
  [2,]  576  612  648

, , 7, 2, 3, 3

      b
a      [,1] [,2] [,3]
  [1,]  666  702  738
  [2,]  684  720  756

, , 1, 1, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]   19   57   95
  [2,]   38   76  114

, , 2, 1, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  133  171  209
  [2,]  152  190  228

, , 3, 1, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  247  285  323
  [2,]  266  304  342

, , 4, 1, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  361  399  437
  [2,]  380  418  456

, , 5, 1, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  475  513  551
  [2,]  494  532  570

, , 6, 1, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  589  627  665
  [2,]  608  646  684

, , 7, 1, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  703  741  779
  [2,]  722  760  798

, , 1, 2, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]   20   60  100
  [2,]   40   80  120

, , 2, 2, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  140  180  220
  [2,]  160  200  240

, , 3, 2, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  260  300  340
  [2,]  280  320  360

, , 4, 2, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  380  420  460
  [2,]  400  440  480

, , 5, 2, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  500  540  580
  [2,]  520  560  600

, , 6, 2, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  620  660  700
  [2,]  640  680  720

, , 7, 2, 1, 4

      b
a      [,1] [,2] [,3]
  [1,]  740  780  820
  [2,]  760  800  840

, , 1, 1, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]   21   63  105
  [2,]   42   84  126

, , 2, 1, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  147  189  231
  [2,]  168  210  252

, , 3, 1, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  273  315  357
  [2,]  294  336  378

, , 4, 1, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  399  441  483
  [2,]  420  462  504

, , 5, 1, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  525  567  609
  [2,]  546  588  630

, , 6, 1, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  651  693  735
  [2,]  672  714  756

, , 7, 1, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  777  819  861
  [2,]  798  840  882

, , 1, 2, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]   22   66  110
  [2,]   44   88  132

, , 2, 2, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  154  198  242
  [2,]  176  220  264

, , 3, 2, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  286  330  374
  [2,]  308  352  396

, , 4, 2, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  418  462  506
  [2,]  440  484  528

, , 5, 2, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  550  594  638
  [2,]  572  616  660

, , 6, 2, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  682  726  770
  [2,]  704  748  792

, , 7, 2, 2, 4

      b
a      [,1] [,2] [,3]
  [1,]  814  858  902
  [2,]  836  880  924

, , 1, 1, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]   23   69  115
  [2,]   46   92  138

, , 2, 1, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  161  207  253
  [2,]  184  230  276

, , 3, 1, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  299  345  391
  [2,]  322  368  414

, , 4, 1, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  437  483  529
  [2,]  460  506  552

, , 5, 1, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  575  621  667
  [2,]  598  644  690

, , 6, 1, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  713  759  805
  [2,]  736  782  828

, , 7, 1, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  851  897  943
  [2,]  874  920  966

, , 1, 2, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]   24   72  120
  [2,]   48   96  144

, , 2, 2, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  168  216  264
  [2,]  192  240  288

, , 3, 2, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  312  360  408
  [2,]  336  384  432

, , 4, 2, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  456  504  552
  [2,]  480  528  576

, , 5, 2, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  600  648  696
  [2,]  624  672  720

, , 6, 2, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  744  792  840
  [2,]  768  816  864

, , 7, 2, 3, 4

      b
a      [,1] [,2] [,3]
  [1,]  888  936  984
  [2,]  912  960 1008

, , 1, 1, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]   25   75  125
  [2,]   50  100  150

, , 2, 1, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  175  225  275
  [2,]  200  250  300

, , 3, 1, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  325  375  425
  [2,]  350  400  450

, , 4, 1, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  475  525  575
  [2,]  500  550  600

, , 5, 1, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  625  675  725
  [2,]  650  700  750

, , 6, 1, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  775  825  875
  [2,]  800  850  900

, , 7, 1, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  925  975 1025
  [2,]  950 1000 1050

, , 1, 2, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]   26   78  130
  [2,]   52  104  156

, , 2, 2, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  182  234  286
  [2,]  208  260  312

, , 3, 2, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  338  390  442
  [2,]  364  416  468

, , 4, 2, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  494  546  598
  [2,]  520  572  624

, , 5, 2, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  650  702  754
  [2,]  676  728  780

, , 6, 2, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  806  858  910
  [2,]  832  884  936

, , 7, 2, 1, 5

      b
a      [,1] [,2] [,3]
  [1,]  962 1014 1066
  [2,]  988 1040 1092

, , 1, 1, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]   27   81  135
  [2,]   54  108  162

, , 2, 1, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]  189  243  297
  [2,]  216  270  324

, , 3, 1, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]  351  405  459
  [2,]  378  432  486

, , 4, 1, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]  513  567  621
  [2,]  540  594  648

, , 5, 1, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]  675  729  783
  [2,]  702  756  810

, , 6, 1, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]  837  891  945
  [2,]  864  918  972

, , 7, 1, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]  999 1053 1107
  [2,] 1026 1080 1134

, , 1, 2, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]   28   84  140
  [2,]   56  112  168

, , 2, 2, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]  196  252  308
  [2,]  224  280  336

, , 3, 2, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]  364  420  476
  [2,]  392  448  504

, , 4, 2, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]  532  588  644
  [2,]  560  616  672

, , 5, 2, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]  700  756  812
  [2,]  728  784  840

, , 6, 2, 2, 5

      b
a      [,1] [,2] [,3]
  [1,]  868  924  980
  [2,]  896  952 1008

, , 7, 2, 2, 5

      b
a      [,1] [,2] [,3]
  [1,] 1036 1092 1148
  [2,] 1064 1120 1176

, , 1, 1, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]   29   87  145
  [2,]   58  116  174

, , 2, 1, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]  203  261  319
  [2,]  232  290  348

, , 3, 1, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]  377  435  493
  [2,]  406  464  522

, , 4, 1, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]  551  609  667
  [2,]  580  638  696

, , 5, 1, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]  725  783  841
  [2,]  754  812  870

, , 6, 1, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]  899  957 1015
  [2,]  928  986 1044

, , 7, 1, 3, 5

      b
a      [,1] [,2] [,3]
  [1,] 1073 1131 1189
  [2,] 1102 1160 1218

, , 1, 2, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]   30   90  150
  [2,]   60  120  180

, , 2, 2, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]  210  270  330
  [2,]  240  300  360

, , 3, 2, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]  390  450  510
  [2,]  420  480  540

, , 4, 2, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]  570  630  690
  [2,]  600  660  720

, , 5, 2, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]  750  810  870
  [2,]  780  840  900

, , 6, 2, 3, 5

      b
a      [,1] [,2] [,3]
  [1,]  930  990 1050
  [2,]  960 1020 1080

, , 7, 2, 3, 5

      b
a      [,1] [,2] [,3]
  [1,] 1110 1170 1230
  [2,] 1140 1200 1260

 a  b  d a' b' c' 
 2  3  7  2  3  5 
> 
> A <- to.tensor(1:16,c(a=2,b=2,c=2,d=2))
> gij <- to.tensor(c(1,0.5,0.5,1),c(i=2,j=2))
> 
> ginv <- c(solve(matrix(c(1,0.5,0.5,1),2)))
> gij1 <- to.tensor(ginv,c("^a"=2,a=2))
> gij2 <- to.tensor(ginv ,c("^b"=2,b=2))
> is.covariate(gij)
[1] TRUE TRUE
> 
> checker( drag.tensor(gij,gij,c("i")) , to.tensor(c(1,0,0,1),c("^i"=2,"j"=2)))
      ^i
j      [,1] [,2]
  [1,]    1    0
  [2,]    0    1
 j ^i 
 2  2 
> checker( drag.tensor(gij,gij,c("j")) , to.tensor(c(1,0,0,1),c("i"=2,"^j"=2)))
      ^j
i      [,1] [,2]
  [1,]    1    0
  [2,]    0    1
 i ^j 
 2  2 
> checker( drag.tensor(gij,gij,c("i","j")), to.tensor(ginv,c("^i"=2,"^j"=2)))
      ^j
^i           [,1]       [,2]
  [1,]  1.3333333 -0.6666667
  [2,] -0.6666667  1.3333333
^i ^j 
 2  2 
> checker( drag.tensor(gij,gij,c("i","j"))[["^i"=~a,"^j"=~b]], riemann.tensor(gij[[i=~a,j=~b]],gij1,gij2))
      b
a            [,1]       [,2]
  [1,]  1.3333333 -0.6666667
  [2,] -0.6666667  1.3333333
a b 
2 2 
> 
> checker( drag.tensor(A,gij,c("a","b")), einstein.tensor(A,gij1,gij2) )
, , 1, 1

      d
c            [,1]     [,2]
  [1,] -0.8888889 2.666667
  [2,]  0.8888889 4.444444

, , 2, 1

      d
c           [,1]     [,2]
  [1,] 0.4444444 4.000000
  [2,] 2.2222222 5.777778

, , 1, 2

      d
c          [,1]     [,2]
  [1,] 1.777778 5.333333
  [2,] 3.555556 7.111111

, , 2, 2

      d
c          [,1]     [,2]
  [1,] 3.111111 6.666667
  [2,] 4.888889 8.444444

 c  d ^a ^b 
 2  2  2  2 
> ###########################################################################
> ### Names
> 
> 
> 
> 
> 
> 
> ##########################################################################
> 
> # 
> I <- to.tensor(diag(3),c(a=3,b=3),nn(a=3,b=3),what=1:2)
> checker(to.tensor(I),I)
    b
a    b1 b2 b3
  a1  1  0  0
  a2  0  1  0
  a3  0  0  1
a b 
3 3 
> checker(as.tensor(I),I)
    b
a    b1 b2 b3
  a1  1  0  0
  a2  0  1  0
  a3  0  0  1
a b 
3 3 
> checker(inv.tensor(I,"a","b"),I)
    b
a    b1 b2 b3
  a1  1  0  0
  a2  0  1  0
  a3  0  0  1
a b 
3 3 
> 
> R1  <- matrix(rnorm(9),nrow=3)
> R1i <- solve(R1)
> R2 <- to.tensor(R1,c(a=3,b=3),nn(a=3,b=3),what=1:2)
> R2i <- to.tensor(R1i,c(b=3,a=3),nn(b=3,a=3),what=1:2)
> 
> checker(inv.tensor(R2,"a","b"),R2i)
    b
a            b1         b2        b3
  a1  1.3545115  -1.536721  1.581124
  a2  0.6374175   9.477398 -6.440188
  a3 -1.8180201 -45.234574 29.223512
a b 
3 3 
> checker(inv.tensor(R2,"a","b",allowSingular=TRUE),R2i)
    b
a            b1         b2        b3
  a1  1.3545115  -1.536721  1.581124
  a2  0.6374175   9.477398 -6.440188
  a3 -1.8180201 -45.234574 29.223512
a b 
3 3 
> 
> 
> R3 <- to.tensor(rnorm(15),c(a=3,z=5),nn(a=3,z=5))
> 
> checker(mul.tensor(R2i,"b",mul.tensor(R2,"a",R3)),R3)
    z
a            z1        z2         z3         z4          z5
  a1 -0.8953954  1.134311 -2.1651420  0.7238549 -0.01731484
  a2 -0.3222050 -0.826831  1.5151313 -1.3050957 -0.59587376
  a3  0.3591246 -1.437899 -0.4997368 -0.2023622 -1.64688035
a z 
3 5 
> 
> checker(solve.tensor(R2i,R3[[z=1]],"a"),mul.tensor(R2,"a",R3[[z=1]]))
b
        b1         b2         b3 
-0.7217544  0.1469166  0.1947976 
b 
3 
> checker(solve.tensor(R2i,R3,"a"),mul.tensor(R2,"a",R3))
    z
b            z1        z2         z3         z4         z5
  b1 -0.7217544 -0.479997  0.2465513 -0.9341408 -0.9015859
  b2  0.1469166  2.096782 -2.7411728  2.2971945  1.5172076
  b3  0.1947976  3.166509 -4.2447767  3.4907497  2.2360166
b z 
3 5 
> 
> checker(solve.tensor(R2i,R3[[z=1]],"a",allowSingular=TRUE),mul.tensor(R2,"a",R3[[z=1]]))
b
        b1         b2         b3 
-0.7217544  0.1469166  0.1947976 
b 
3 
> checker(solve.tensor(R2i,R3,"a",allowSingular=TRUE),mul.tensor(R2,"a",R3))
    z
b            z1        z2         z3         z4         z5
  b1 -0.7217544 -0.479997  0.2465513 -0.9341408 -0.9015859
  b2  0.1469166  2.096782 -2.7411728  2.2971945  1.5172076
  b3  0.1947976  3.166509 -4.2447767  3.4907497  2.2360166
b z 
3 5 
> 
> checker(solve.tensor(rep(R2i,4,1,"K"),R3[[z=1]],"a",by="K"),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
    K
b          [,1]       [,2]       [,3]       [,4]
  b1 -0.7217544 -0.7217544 -0.7217544 -0.7217544
  b2  0.1469166  0.1469166  0.1469166  0.1469166
  b3  0.1947976  0.1947976  0.1947976  0.1947976
b K 
3 4 
> checker(solve.tensor(rep(R2i,4,1,"K"),rep(R3[[z=1]],4,1,"K"),"a",by="K"),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
    K
b          [,1]       [,2]       [,3]       [,4]
  b1 -0.7217544 -0.7217544 -0.7217544 -0.7217544
  b2  0.1469166  0.1469166  0.1469166  0.1469166
  b3  0.1947976  0.1947976  0.1947976  0.1947976
b K 
3 4 
> checker(solve.tensor(R2i,rep(R3[[z=1]],4,1,"K"),"a",by="K"),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
    K
b          [,1]       [,2]       [,3]       [,4]
  b1 -0.7217544 -0.7217544 -0.7217544 -0.7217544
  b2  0.1469166  0.1469166  0.1469166  0.1469166
  b3  0.1947976  0.1947976  0.1947976  0.1947976
b K 
3 4 
> 
> checker(solve.tensor(rep(R2i,4,1,"K"),R3[[z=1]],"a",by="K",allowSingular=TRUE),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
    K
b          [,1]       [,2]       [,3]       [,4]
  b1 -0.7217544 -0.7217544 -0.7217544 -0.7217544
  b2  0.1469166  0.1469166  0.1469166  0.1469166
  b3  0.1947976  0.1947976  0.1947976  0.1947976
b K 
3 4 
> checker(solve.tensor(rep(R2i,4,1,"K"),rep(R3[[z=1]],4,1,"K"),"a",by="K",allowSingular=TRUE),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
    K
b          [,1]       [,2]       [,3]       [,4]
  b1 -0.7217544 -0.7217544 -0.7217544 -0.7217544
  b2  0.1469166  0.1469166  0.1469166  0.1469166
  b3  0.1947976  0.1947976  0.1947976  0.1947976
b K 
3 4 
> checker(solve.tensor(R2i,rep(R3[[z=1]],4,1,"K"),"a",by="K",allowSingular=TRUE),rep(mul.tensor(R2,"a",R3[[z=1]]),4,1,"K"))
    K
b          [,1]       [,2]       [,3]       [,4]
  b1 -0.7217544 -0.7217544 -0.7217544 -0.7217544
  b2  0.1469166  0.1469166  0.1469166  0.1469166
  b3  0.1947976  0.1947976  0.1947976  0.1947976
b K 
3 4 
> 
> 
> 
> checker(solve.tensor(R2i,R3,"a"),mul.tensor(R2,"a",R3))
    z
b            z1        z2         z3         z4         z5
  b1 -0.7217544 -0.479997  0.2465513 -0.9341408 -0.9015859
  b2  0.1469166  2.096782 -2.7411728  2.2971945  1.5172076
  b3  0.1947976  3.166509 -4.2447767  3.4907497  2.2360166
b z 
3 5 
> 
> checker(solve.tensor(R2i,R3[[z=1]],"a",allowSingular=TRUE),mul.tensor(R2,"a",R3[[z=1]]))
b
        b1         b2         b3 
-0.7217544  0.1469166  0.1947976 
b 
3 
> checker(solve.tensor(R2i,R3,"a",allowSingular=TRUE),mul.tensor(R2,"a",R3))
    z
b            z1        z2         z3         z4         z5
  b1 -0.7217544 -0.479997  0.2465513 -0.9341408 -0.9015859
  b2  0.1469166  2.096782 -2.7411728  2.2971945  1.5172076
  b3  0.1947976  3.166509 -4.2447767  3.4907497  2.2360166
b z 
3 5 
> 
> 
> 
> summary(I)
a b 
3 3 
$a
[1] "a1" "a2" "a3"

$b
[1] "b1" "b2" "b3"

    b
a    b1 b2 b3
  a1  1  0  0
  a2  0  1  0
  a3  0  0  1
a b 
3 3 
> 
> 
> A <- to.tensor(c(diag(3)),c(a=3,b=3),nn(a=3,b=3))
> 
> A <- to.tensor(c(1,1,1,0,1,1,0,0,1),c(a=3,b=3),nn(a=3,b=3))
> checker(mul.tensor(A,"b",A,"a"),to.tensor(c(A%*%A),c(a=3,b=3),nn(a=3,b=3)))
    b
a    b1 b2 b3
  a1  1  0  0
  a2  2  1  0
  a3  3  2  1
a b 
3 3 
> 
> A <- to.tensor(c(1,1,1,1,0,1,1,1,0,0,1,1),c(a=4,b=3),nn(a=4,b=3))
> checker(mul.tensor(A,"b",A[[a=~c]],"b"),
+         to.tensor(c(A%*%t(A)),dim=c(a=4,c=4),nn(a=4,a=4)))
    c
a    a1 a2 a3 a4
  a1  1  1  1  1
  a2  1  2  2  2
  a3  1  2  3  3
  a4  1  2  3  3
a c 
4 4 
> 
> A <- to.tensor(rnorm(15),c(a=5,b=3),nn(a=5,b=3))
> checker(mul.tensor(A,"b",A[[a=~c]],"b"),
+         to.tensor(c(A%*%t(A)),dim=c(a=5,c=5),nn(a=5,a=5)))
    c
a            a1         a2         a3         a4         a5
  a1  2.0411789  0.9713976  0.5001267  1.5129363 -0.2202321
  a2  0.9713976  1.4931326  0.9861560  0.1418050 -0.3591459
  a3  0.5001267  0.9861560  3.6559484 -2.6034072  0.5042811
  a4  1.5129363  0.1418050 -2.6034072  3.6277751 -0.6551148
  a5 -0.2202321 -0.3591459  0.5042811 -0.6551148  0.2710343
a c 
5 5 
> 
> # 
> A <- to.tensor(c(1,1,1,0,1,1,0,0,1),c(a=3,b=3))
> 
> solve.tensor(mul.tensor(I,"b",I,"a"),I,"a","a")
    b
b    b1 b2 b3
  b1  1  0  0
  b2  0  1  0
  b3  0  0  1
b b 
3 3 
Warning message:
In to.tensor.default(c(EE), d, dn) :
  Tensor with duplicated names generated: b  b  
> checker(solve.tensor(mul.tensor(I,"b",I,"a"),I,"a","b"),I)
    a
b    a1 a2 a3
  b1  1  0  0
  b2  0  1  0
  b3  0  0  1
b a 
3 3 
> mul.tensor(A,"b",I,"a")
      b
a      b1 b2 b3
  [1,]  1  0  0
  [2,]  1  1  0
  [3,]  1  1  1
a b 
3 3 
> 
> # + - * /
> A <- to.tensor(1:4,c(i=4))
> B <- to.tensor(1:4,c(j=4))
> 
> checker((A+B-A-B),0*(A %e% B))
      j
i      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0
  [3,]    0    0    0    0
  [4,]    0    0    0    0
i j 
4 4 
> checker((A-B-A+B),0*(A %e% B))
      j
i      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0
  [3,]    0    0    0    0
  [4,]    0    0    0    0
i j 
4 4 
> checker((A+B-B-A),0*(A %e% B))
      j
i      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0
  [3,]    0    0    0    0
  [4,]    0    0    0    0
i j 
4 4 
> checker((A-B+B-A),0*(A %e% B))
      j
i      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0
  [3,]    0    0    0    0
  [4,]    0    0    0    0
i j 
4 4 
> checker((A-A+B-B),0*(A %e% B))
      j
i      [,1] [,2] [,3] [,4]
  [1,]    0    0    0    0
  [2,]    0    0    0    0
  [3,]    0    0    0    0
  [4,]    0    0    0    0
i j 
4 4 
> checker((A*B/A/B),one.tensor(c(dim(A),dim(B))))
      j
i      [,1] [,2] [,3] [,4]
  [1,]    1    1    1    1
  [2,]    1    1    1    1
  [3,]    1    1    1    1
  [4,]    1    1    1    1
i j 
4 4 
> checker((A/B/A*B),one.tensor(c(dim(A),dim(B))))
      j
i      [,1] [,2] [,3] [,4]
  [1,]    1    1    1    1
  [2,]    1    1    1    1
  [3,]    1    1    1    1
  [4,]    1    1    1    1
i j 
4 4 
> checker((A*B/B/A),one.tensor(c(dim(A),dim(B))))
      j
i      [,1] [,2] [,3] [,4]
  [1,]    1    1    1    1
  [2,]    1    1    1    1
  [3,]    1    1    1    1
  [4,]    1    1    1    1
i j 
4 4 
> checker((A/B*B/A),one.tensor(c(dim(A),dim(B))))
      j
i      [,1] [,2] [,3] [,4]
  [1,]    1    1    1    1
  [2,]    1    1    1    1
  [3,]    1    1    1    1
  [4,]    1    1    1    1
i j 
4 4 
> checker((A/A*B/B),one.tensor(c(dim(A),dim(B))))
      j
i      [,1] [,2] [,3] [,4]
  [1,]    1    1    1    1
  [2,]    1    1    1    1
  [3,]    1    1    1    1
  [4,]    1    1    1    1
i j 
4 4 
> 
> # $,|,^
> 
> A <- to.tensor(1:6,c(a=1,b=2,c=3))
> checker( names(A$ijk) , c("i","j","k") )
[1] "i" "j" "k"
> checker( names(A$i.j.k) , c("i","j","k") )
[1] "i" "j" "k"
> checker( A$ijk^c("a","b","c") , A )
, , 1

      b
a      [,1] [,2]
  [1,]    1    2

, , 2

      b
a      [,1] [,2]
  [1,]    3    4

, , 3

      b
a      [,1] [,2]
  [1,]    5    6

a b c 
1 2 3 
> checker( A$ijk^"a.b.c" , A )
, , 1

      b
a      [,1] [,2]
  [1,]    1    2

, , 2

      b
a      [,1] [,2]
  [1,]    3    4

, , 3

      b
a      [,1] [,2]
  [1,]    5    6

a b c 
1 2 3 
> checker( A$ijk^"$abc" , A )
, , 1

      b
a      [,1] [,2]
  [1,]    1    2

, , 2

      b
a      [,1] [,2]
  [1,]    3    4

, , 3

      b
a      [,1] [,2]
  [1,]    5    6

a b c 
1 2 3 
> checker( names(A|"$bca"), c("b","c","a"))
[1] "b" "c" "a"
> checker( names(A|"b.c.a"), c("b","c","a"))
[1] "b" "c" "a"
> checker( names(A|"$b.c.a"), c("b","c","a"))
[1] "b" "c" "a"
> checker( names(A|c("$b","c.a")), c("b","c","a"))
[1] "b" "c" "a"
> checker( names(A|c("$b","c","a")), c("b","c","a"))
[1] "b" "c" "a"
> checker( names(A|c("$","b","c","a")), c("b","c","a"))
[1] "b" "c" "a"
> checker( names(A|c("b.c.a")), c("b","c","a"))
[1] "b" "c" "a"
> 
> 
> # slice.tensor<-
> #A <- to.tensor(1:24,c(a=2,b=3,c=4))
> #B <- to.tensor(25:48,c(a=2,b=3,c=4))
> #slice.tensor(A,"c",1:2)<- slice.tensor(B,"c",1:2)
> #checker(slice.tensor(A,"c",1:2),slice.tensor(B,"c",1:2))
> #slice.tensor(A,"b",2)<- slice.tensor(B,"b",2)
> #checker(slice.tensor(A,"b",2),slice.tensor(B,"b",2))
> 
