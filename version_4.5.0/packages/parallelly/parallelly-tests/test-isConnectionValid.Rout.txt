
R version 4.5.0 (2025-04-11) -- "How About a Twenty-Six"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ## This runs testme test script inst/testme/test-isConnectionValid.R
> ## Don't edit - it was autogenerated by inst/testme/deploy.R
> parallelly:::testme("isConnectionValid")
Test ‘isConnectionValid’ ...
Sourcing 7 prologue scripts ...
01/07 prologue script ‘/usr/local/lib/R/site-library/parallelly/testme/_prologue/001.load.R’
02/07 prologue script ‘/usr/local/lib/R/site-library/parallelly/testme/_prologue/002.record-state.R’
03/07 prologue script ‘/usr/local/lib/R/site-library/parallelly/testme/_prologue/030.imports.R’
04/07 prologue script ‘/usr/local/lib/R/site-library/parallelly/testme/_prologue/050.utils.R’
05/07 prologue script ‘/usr/local/lib/R/site-library/parallelly/testme/_prologue/090.context.R’
06/07 prologue script ‘/usr/local/lib/R/site-library/parallelly/testme/_prologue/090.options.R’
07/07 prologue script ‘/usr/local/lib/R/site-library/parallelly/testme/_prologue/091.envvars.R’
Sourcing 7 prologue scripts ... done
Running test script: ‘/usr/local/lib/R/site-library/parallelly/testme/test-isConnectionValid.R’

> library(parallelly)

> stopCluster <- parallel::stopCluster

> message("*** Connections ...")
*** Connections ...

> con <- stdin()

> idx <- as.integer(con)

> id <- connectionId(con)

> valid <- isConnectionValid(con)

> stopifnot(inherits(con, "connection"), idx == 0, id == 
+     0, isTRUE(valid))

> con <- stdout()

> idx <- as.integer(con)

> id <- connectionId(con)

> valid <- isConnectionValid(con)

> stopifnot(inherits(con, "connection"), idx == 1, id == 
+     1, isTRUE(valid))

> con <- stderr()

> idx <- as.integer(con)

> id <- connectionId(con)

> valid <- isConnectionValid(con)

> stopifnot(inherits(con, "connection"), idx == 2, id == 
+     2, isTRUE(valid))

> message("- Connections cannot be serialized")
- Connections cannot be serialized

> con <- file(tempfile(), open = "w")

> x <- list(value = 42, stderr = stderr(), con = con)

> y <- unserialize(serialize(x, connection = NULL))

> print(connectionId(x$stderr))
[1] 2

> print(connectionId(x$con))
[1] 80
attr(,"raw_id")
[1] "<pointer: 0x50>"

> print(isConnectionValid(x$stderr))
[1] TRUE

> print(isConnectionValid(x$con))
[1] TRUE

> print(connectionId(y$stderr))
[1] 2

> print(connectionId(y$con))
[1] -1

> print(isConnectionValid(y$stderr))
[1] TRUE

> print(isConnectionValid(y$con))
[1] FALSE
attr(,"reason")
[1] "Connection (connection: index=3, description=\"/tmp/Rtmpz8dPMD/file184cc7572497\", class=\"file\", mode=\"w\", text=\"text\", opened=\"opened\", can read=\"no\", can write=\"yes\", id=-1) is no longer valid. It differ from the currently registered R connection with the same index 3 (connection: index=3, description=\"/tmp/Rtmpz8dPMD/file184cc7572497\", class=\"file\", mode=\"w\", text=\"text\", opened=\"opened\", can read=\"no\", can write=\"yes\", id=80, raw_id=\"<pointer: 0x50>\")"

> stopifnot(identical(y$value, x$value), connectionId(x$stderr) == 
+     2, isConnectionValid(x$stderr), isConnectionValid(y$stderr), 
+     identica .... [TRUNCATED] 

> close(con)

> message("*** Connections ... DONE")
*** Connections ... DONE
Sourcing 4 epilogue scripts ...
01/04 epilogue script ‘/usr/local/lib/R/site-library/parallelly/testme/_epilogue/002.undo-state.R’
02/04 epilogue script ‘/usr/local/lib/R/site-library/parallelly/testme/_epilogue/090.gc.R’
03/04 epilogue script ‘/usr/local/lib/R/site-library/parallelly/testme/_epilogue/099.session_info.R’
04/04 epilogue script ‘/usr/local/lib/R/site-library/parallelly/testme/_epilogue/999.detritus.R’
Looking for detritus files generated by test ‘isConnectionValid’:
Skipping, because path appears not to be an 'R CMD check' folder: ‘/tmp’
Sourcing 4 epilogue scripts ... done
Test time: user.self=0.02s, sys.self=0.005s, elapsed=0.02s, user.child=0s, sys.child=0s
Test ‘isConnectionValid’ ... success
> 
